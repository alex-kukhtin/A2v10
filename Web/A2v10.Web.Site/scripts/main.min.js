"use strict";!function(){window.app={modules:{},components:{},nextToken:function(){return""+currentToken++}},window.require=require,window.component=function(name,noerror){if(name in app.components)return app.components[name];if(noerror)return{};throw new Error('component "'+name+'" not found')},window.define=function(args,factory){let exports={default:void 0};return factory(require,exports),exports.default};let rootElem=document.querySelector("meta[name=rootUrl]");function require(module,noerror){if(module in app.modules){let am=app.modules[module];return"function"==typeof am&&(am=am(),app.modules[module]=am),am}if(noerror)return null;throw new Error('module "'+module+'" not found')}window.$$rootUrl=rootElem&&rootElem.content||"";let currentToken=1603}(),app.modules["std:locale"]=function(){return window.$$locale},function(elem){elem.closest=elem.closest||function(css){let node=this;for(;node;){if(node.matches(css))return node;node=node.parentElement}return null},elem.scrollIntoViewCheck=elem.scrollIntoViewCheck||function(){let el=this,elRect=el.getBoundingClientRect(),pElem=el.parentElement;for(;pElem&&!(pElem.offsetHeight<pElem.scrollHeight);)pElem=pElem.parentElement;if(!pElem)return;let parentRect=pElem.getBoundingClientRect();(elRect.top<parentRect.top||elRect.bottom>parentRect.bottom)&&el.scrollIntoView({block:"nearest"})}}(Element.prototype),function(date){date.isZero=date.isZero||function(){let td=new Date(0,0,1,0,0,0,0);return td.setHours(0,-td.getTimezoneOffset(),0,0),this.getTime()===td.getTime()}}(Date.prototype),app.modules["std:platform"]={set:function(target,prop,value){Vue.set(target,prop,value)},defer:function(func){Vue.nextTick(func)},print:function(){window.print()},File,performance},app.modules["std:eventBus"]=new Vue({}),app.modules["std:const"]=function(){return{SEVERITY:{ERROR:"error",WARNING:"warning",INFO:"info"}}},app.modules["std:utils"]=function(){const locale=require("std:locale"),platform=require("std:platform"),dateLocale=locale.$Locale,numLocale=locale.$Locale,dateOptsDate={timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"},dateOptsTime={timeZone:"UTC",hour:"2-digit",minute:"2-digit"},formatDate=new Intl.DateTimeFormat(dateLocale,dateOptsDate).format,formatTime=new Intl.DateTimeFormat(dateLocale,dateOptsTime).format,currencyFormat=new Intl.NumberFormat(numLocale,{minimumFractionDigits:2,maximumFractionDigits:6,useGrouping:!0}).format,numberFormat=new Intl.NumberFormat(numLocale,{minimumFractionDigits:0,maximumFractionDigits:6,useGrouping:!0}).format,utcdatRegEx=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?Z$/;let numFormatCache={};return{isArray:Array.isArray,isFunction:function(value){return"function"==typeof value},isDefined,isObject,isObjectExact,isDate,isString,isNumber,isBoolean:function(value){return"boolean"==typeof value},toString:function(obj){if(!isDefined(obj))return"";if(null===obj)return"";if(isObject(obj))return toJson(obj);return""+obj},defaultValue:function(type){switch(type){case void 0:return;case Number:return 0;case String:return"";case Boolean:return!1;case Date:return dateZero();case Object:return null;default:if("function"==typeof type)return null;throw new Error("There is no default value for type "+type)}},notBlank:function(val){if(!val)return!1;if(isDate(val))return!dateIsZero(val);switch(typeof val){case"string":return""!==val;case"date":return!1;case"object":if("$id"in val)return!!val.$id}return""!==(val||"")},toJson,fromJson:JSON.parse,isPrimitiveCtor:function(ctor){return ctor===String||ctor===Number||ctor===Boolean||ctor===Date||ctor===platform.File||ctor===Object},isDateCtor:function(ctor){return ctor===Date},isEmptyObject:function(obj){return!obj||0===Object.keys(obj).length&&obj.constructor===Object},defineProperty:function(trg,prop,get,set){Object.defineProperty(trg,prop,{enumerable:!0,configurable:!0,get})},eval:function(obj,path,dataType,opts,skipFormat){let r=simpleEval(obj,path);if(skipFormat)return r;return isDate(r)?format(r,dataType):isObject(r)?toJson(r):format(r,dataType,opts)},simpleEval,format,toNumber,parse:function(obj,dataType){switch(dataType){case"Currency":case"Number":return toNumber(obj);case"Date":return dateParse(obj)}return obj},getStringId:function(obj){if(!obj)return"0";if(isNumber(obj))return obj;if(isObjectExact(obj)){if("$id"in obj)return obj.$id||0;if("Id"in obj)return obj.Id||0;console.error("Id or @id not found in object")}return"0"},isEqual:function(o1,o2){if(o1===o2)return!0;if(isDate(o1)&&isDate(o2))return o1.getTime()===o2.getTime();if(isObjectExact(o1)&&isObjectExact(o2))return JSON.stringify(o1)===JSON.stringify(o2);return!1},date:{today:dateToday,now:function(second){let td=new Date,sec=second?td.getSeconds():0;return new Date(Date.UTC(td.getFullYear(),td.getMonth(),td.getDate(),td.getHours(),td.getMinutes(),sec,0))},zero:dateZero,parse:dateParse,tryParse:function(str){if(!str)return dateZero();if(isDate(str))return str;if(utcdatRegEx.test(str))return new Date(str);let dt;dt=8===str.length?new Date(+str.substring(0,4),+str.substring(4,6)-1,+str.substring(6,8),0,0,0,0):str.startsWith('"\\/"')?new Date(str.substring(4,str.length-4)):new Date(str);if(!isNaN(dt.getTime()))return new Date(Date.UTC(dt.getFullYear(),dt.getMonth(),dt.getDate(),0,0,0,0));return str},equal:dateEqual,isZero:dateIsZero,formatDate,format:formatDate,add:function(dt,nm,unit){if(!isDate(dt))return null;var du=0;switch(unit){case"year":return new Date(Date.UTC(dt.getFullYear()+nm,dt.getMonth(),dt.getDate(),0,0,0,0));case"month":let newMonth=dt.getMonth()+nm,day=dt.getDate();var ldm=new Date(Date.UTC(dt.getFullYear(),newMonth+1,0,0,0)).getDate();return day>ldm&&(day=ldm),new Date(Date.UTC(dt.getFullYear(),newMonth,day,0,0,0));case"day":du=864e5;break;case"hour":du=36e5;break;case"minute":du=6e4;break;case"second":du=1e3;break;default:throw new Error("Invalid unit value for utils.date.add")}return new Date(dt.getTime()+nm*du)},diff:function(unit,d1,d2){d1.getTime()>d2.getTime()&&([d1,d2]=[d2,d1]);switch(unit){case"second":return(d2-d1)/1e3;case"minute":return+((d2-d1)/1e3/60).toFixed(0);case"month":let delta=0;if(d2.getDate()<d1.getDate()&&(delta=-1),d1.getFullYear()===d2.getFullYear())return d2.getMonth()-d1.getMonth()+delta;let month=0,year=d1.getFullYear();for(;year<d2.getFullYear();){let day=d2.getDate(),dayOfMonth=endOfMonth(new Date(year+1,d1.getMonth(),1,0,0,0,0)).getDate();day>dayOfMonth&&(day=dayOfMonth),d1=new Date(year+1,d1.getMonth(),day,0,0,0,0),year=d1.getFullYear(),month+=12}return month+=d2.getMonth()-d1.getMonth(),month+delta;case"day":let du=864e5;return Math.floor((d2-d1)/du);case"year":let dy=new Date(d1.getFullYear(),d2.getMonth(),d2.getDate(),d2.getHours(),d2.getMinutes(),d2.getSeconds(),d2.getMilliseconds())<d1?d2>d1?-1:0:d2<d1?1:0;return d2.getFullYear()-d1.getFullYear()+dy}throw new Error("Invalid unit value for utils.date.diff")},create:dateCreate,compare:function(d1,d2){if(!isDate(d1)||!isDate(d2))return null;let t1=d1.getTime(),t2=d2.getTime();return t1-t2},endOfMonth,minDate:dateCreate(1901,1,1),maxDate:dateCreate(2999,12,31),fromDays:function(days){return new Date(Date.UTC(1900,0,days,0,0,0,0))},parseTime:function(str){let seg=(str=str||"").split(/[^\d]/).filter(x=>x);if(0===seg.length)return new Date(1970,0,1,0,0,0,0);1===seg.length&&seg.push("0");let h=Math.min(+seg[0],23),m=Math.min(+seg[1],59);return new Date(1970,0,1,h,m,0,0)}},text:{contains:textContains,containsText:function(obj,props,probe){if(!probe)return!0;if(!obj)return!1;for(let v of props.split(","))if(textContains(obj[v],probe))return!0;return!1},sanitize:function(text){return(""+text||"").replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"")},splitPath:function(path){let propIx=path.lastIndexOf(".");return{obj:path.substring(0,propIx),prop:path.substring(propIx+1)}},capitalize,maxChars:function(text,length){return(text=""+text||"").length<length?text:text.substring(0,length-1)+"â€¦"},equalNoCase:function(s1,s2){return(s1||"").toLowerCase()===(s2||"").toLowerCase()}},currency:{round:function(n,digits){if(isNaN(n))return Nan;isDefined(digits)||(digits=2);let m=!1;n<0&&(n=-n,m=!0);let r=Number(Math.round(n.toFixed(12)+"e"+digits)+"e-"+digits);return m?-r:r},format:currencyFormat},func:{curry:function(fn,...args){return(..._arg)=>fn(...args,..._arg)},debounce},debounce};function isDefined(value){return void 0!==value}function isObject(value){return null!==value&&"object"==typeof value}function isDate(value){return value instanceof Date}function isString(value){return"string"==typeof value}function isNumber(value){return"number"==typeof value}function isObjectExact(value){return isObject(value)&&!Array.isArray(value)}function toJson(data){return JSON.stringify(data,(function(key,value){if(!dateIsZero(this[key]))return"$"===key[0]||"_"===key[0]?void 0:value}),2)}function simpleEval(obj,path){if(!path||!obj)return"";let ps=(path||"").split("."),r=obj;for(let i=0;i<ps.length;i++){let pi=ps[i];if(!(pi in r))throw new Error(`Property '${pi}' not found in ${r.constructor.name} object`);r=r[ps[i]]}return r}function pad2(num){return num<10?"0"+num:""+num}function formatNumber(num,format){if(!format)return numberFormat(num);if(numFormatCache[format])return numFormatCache[format](num);let fmt=format.match(/^([#][,\s])?(#*)?(0*)?\.?(0*)?(#*)?$/);if(!fmt)return console.error(`Invalid number format: '${format}'`),num;function getlen(x){return x?x.length:0}let useGrp=!!fmt[1],fi0=(getlen(fmt[2]),getlen(fmt[3])),fp0=getlen(fmt[4]),fph=getlen(fmt[5]),formatFunc=Intl.NumberFormat(numLocale,{minimumFractionDigits:fp0,maximumFractionDigits:fp0+fph,minimumIntegerDigits:fi0,useGrouping:useGrp}).format;return numFormatCache[format]=formatFunc,formatFunc(num)}function formatDateWithFormat(date,format){if(!format)return formatDate(date);switch(format){case"MMMM yyyy":return capitalize(date.toLocaleDateString(locale.$Locale,{month:"long",year:"numeric"}));default:console.error("invalid date format: "+format)}return formatDate(date)}function format(obj,dataType,opts){if(opts=opts||{},!dataType)return obj;if(!isDefined(obj))return"";switch(dataType){case"DateTime":return isDate(obj)?dateIsZero(obj)?"":opts.format?formatDateWithFormat(obj,opts.format):formatDate(obj)+" "+formatTime(obj):(console.error(`Invalid Date for utils.format (${obj})`),obj);case"Date":return isString(obj)&&(obj=function(str){try{let dt=new Date(str);return dt.setUTCHours(0,0,0,0),dt}catch(err){return str}}(obj)),isDate(obj)?dateIsZero(obj)?"":opts.format?formatDateWithFormat(obj,opts.format):formatDate(obj):(console.error(`Invalid Date for utils.format (${obj})`),obj);case"DateUrl":return dateIsZero(obj)?"":isDate(d1=obj)&&(0!==d1.getUTCHours()||0!==d1.getUTCMinutes()&&0!==d1.getUTCSeconds())?obj.toISOString():""+obj.getFullYear()+pad2(obj.getMonth()+1)+pad2(obj.getDate());case"Time":return isDate(obj)?dateIsZero(obj)?"":formatTime(obj):(console.error(`Invalid Date for utils.format (${obj})`),obj);case"Period":return obj.format?obj.format("Date"):(console.error(`Invalid Period for utils.format (${obj})`),obj);case"Currency":return isNumber(obj)||(obj=toNumber(obj)),opts.hideZeros&&0===obj?"":opts.format?formatNumber(obj,opts.format):currencyFormat(obj);case"Number":return isNumber(obj)||(obj=toNumber(obj)),opts.hideZeros&&0===obj?"":formatNumber(obj,opts.format);default:console.error(`Invalid DataType for utils.format (${dataType})`)}var d1;return obj}function toNumber(val){return isString(val)&&(val=val.replace(/\s/g,"").replace(",",".")),isFinite(val)?+val:0}function dateToday(){let td=new Date;return new Date(Date.UTC(td.getFullYear(),td.getMonth(),td.getDate(),0,0,0,0))}function dateZero(){return new Date(Date.UTC(0,0,1,0,0,0,0))}function dateParse(str,yearCutOff){if(str=str||"",utcdatRegEx.test(str))return new Date(str);if(!str)return dateZero();let today=dateToday(),seg=str.split(/[^\d]/).filter(x=>x);if(1===seg.length)if(8===seg[0].length){let x=seg[0];seg=[],seg.push(x.substring(0,2)),seg.push(x.substring(2,4)),seg.push(x.substring(4))}else seg.push(""+(today.getMonth()+1)),seg.push(""+today.getFullYear());else 2===seg.length&&seg.push(""+today.getFullYear());let cutOffYear=function(year){let yco=yearCutOff||"+10";return year<=(yco.startsWith("+")||yco.startsWith("-")?today.getFullYear()%100+parseInt(yco,10):+yco%100)?"20":"19"},td=new Date(Date.UTC(+function(y){switch((y=""+y).length){case 1:y=cutOffYear(y)+"0"+y;break;case 2:y=cutOffYear(y)+y;break;case 4:break;default:y=today.getFullYear()}return+y}(seg[2]),+((seg[1]?seg[1]:1)-1),+seg[0],0,0,0,0));return isNaN(td.getDate())?dateZero():td}function dateEqual(d1,d2){return d1.getFullYear()===d2.getFullYear()&&d1.getMonth()===d2.getMonth()&&d1.getDate()===d2.getDate()}function dateIsZero(d1){return!!isDate(d1)&&dateEqual(d1,dateZero())}function endOfMonth(dt){return new Date(Date.UTC(dt.getFullYear(),dt.getMonth()+1,0,0,0,0))}function dateCreate(year,month,day){return new Date(Date.UTC(year,month-1,day,0,0,0,0))}function capitalize(text){return text?text.charAt(0).toUpperCase()+text.slice(1):""}function textContains(text,probe){return!probe||!!text&&-1!==(text||"").toString().toLowerCase().indexOf(probe.toLowerCase())}function debounce(fn,timeout){let timerId=null;return function(){clearTimeout(timerId),timerId=setTimeout(()=>{fn.call()},timeout)}}},app.modules["std:url"]=function(){const utils=require("std:utils"),period=require("std:period");return{combine,makeQueryString,parseQueryString,normalizeRoot:function(path){let root=window.$$rootUrl;return root&&path.startsWith(root)?path.substring(root.length):path},idChangedOnly:function(newUrl,oldUrl){let n1=(newUrl||"").split("?")[0],o1=(oldUrl||"").split("?")[0],ns=n1.split("/"),os=o1.split("/");if(ns.length!==os.length)return!1;function isNewPathArr(arr){let ai=arr[arr.length-1];return"new"===ai||"0"===ai}if(isNewPathArr(os)&&!isNewPathArr(ns)&&ns.slice(0,ns.length-1).join("/")===os.slice(0,os.length-1).join("/"))return!0;return!1},idOrCopyChanged:function(newUrl,oldUrl){let n1=(newUrl||"").split("?")[0],o1=(oldUrl||"").split("?")[0],ns=n1.split("/"),os=o1.split("/");if(ns.length!==os.length)return!1;if(ns.pop(),os.pop(),"edit"===ns.pop()&&"copy"===os.pop())return ns.join("/")===os.join("/");return!1},makeBaseUrl:function(url){let x=(url||"").split("/"),len=x.length;return len>=6?x.slice(2,len-2).join("/"):url},parseUrlAndQuery,replaceUrlQuery:function(url,query){url||(url=window.location.pathname+window.location.search);let pu=parseUrlAndQuery(url,query);return pu.url+makeQueryString(pu.query)},createUrlForNavigate:function(url,data){let urlId=data||"new",qs="";utils.isDefined(urlId.$id)?urlId=urlId.$id:utils.isObjectExact(urlId)&&(urlId=data.Id,delete data.Id,qs=makeQueryString(data),utils.isDefined(urlId)||(urlId="new"));url.endsWith("new")&&"new"===urlId&&(urlId="");return combine(url,urlId)+qs},firstUrl:"",encodeUrl:encodeURIComponent,helpHref:function(path){let helpUrlElem=document.querySelector("meta[name=helpUrl]");if(!helpUrlElem||!helpUrlElem.content)return console.warn("help url is not specified"),"";return helpUrlElem.content+(path||"")},replaceSegment:function(url,id,action){let parts=url.split("/");isDialogPath(url)?(parts.pop(),id&&parts.push(id)):(action&&parts.pop(),id&&parts.pop(),action&&parts.push(action),id&&parts.push(id));return parts.join("/")},removeFirstSlash:function(url){return url&&url.startsWith&&url.startsWith("/")?url.substring(1):url},isNewPath:function(url){return!!(url=url.split("?")[0])&&(-1!==url.indexOf("/new")||!(!isDialogPath(url)||!url.endsWith("/0")))}};function normalize(elem){return(elem=(elem=""+elem||"").replace(/\\/g,"/")).startsWith("/")&&(elem=elem.substring(1)),elem.endsWith("/")&&(elem=elem.substring(0,elem.length-1)),elem}function combine(...args){return"/"+args.map(normalize).filter(x=>!!x).join("/")}function toUrl(obj){return utils.isDefined(obj)&&null!==obj?utils.isDate(obj)?utils.format(obj,"DateUrl"):period.isPeriod(obj)?obj.format("DateUrl"):utils.isObjectExact(obj)?"Object"===obj.constructor.name?(utils.isDefined(obj.Id)||console.error("Id is not defined for Filter object"),""+(obj.Id||"")):(utils.isDefined(obj.$id)||console.error("$id is not defined for "+obj.constructor.name),""+(obj.$id||"0")):""+obj:""}function makeQueryString(obj){if(!obj)return"";if(!utils.isObjectExact(obj))return"";let esc=encodeURIComponent,query=Object.keys(obj).filter(k=>!k.startsWith("_")&&!k.startsWith("$")&&!function(obj){if(!obj)return!0;let objUrl=toUrl(obj);return!objUrl||"0"===objUrl}(obj[k])).map(k=>esc(k)+"="+esc(toUrl(obj[k]))).join("&");return query?"?"+query:""}function parseQueryString(str){var obj={};return str.replace(/\??([^=&]+)=([^&]*)/g,(function(m,key,value){obj[decodeURIComponent(key)]=""+decodeURIComponent(value)})),obj}function parseUrlAndQuery(url,querySrc){let query={};for(let p in querySrc)p.startsWith("_")||p.startsWith("$")||(query[p]=toUrl(querySrc[p]));let rv={url,query};if(-1!==url.indexOf("?")){let a=url.split("?");rv.url=a[0],rv.query=Object.assign({},parseQueryString(a[1]),query)}return rv}function isDialogPath(url){return url.startsWith("/_dialog/")}},app.modules["std:period"]=function(){const utils=require("std:utils"),date=utils.date,locale=window.$$locale;function TPeriod(source){source&&"From"in source&&(source.From||source.To)?(this.From=date.tryParse(source.From),this.To=date.tryParse(source.To)):(this.From=date.minDate,this.To=date.maxDate),Object.defineProperty(this,"Name",{enumerable:!0,get(){return this.format("Date")}})}return TPeriod.prototype.assign=function(v){return isPeriod(v)?(this.From=v.From,this.To=v.To):null===v.From&&null===v.To?(this.From=date.minDate,this.To=date.maxDate):(this.From=date.tryParse(v.From),this.To=date.tryParse(v.To)),this.normalize(),this},TPeriod.prototype.equal=function(p){return date.equal(this.From,p.From)&&date.equal(this.To,p.To)},TPeriod.prototype.fromUrl=function(v){if(utils.isObject(v)&&"From"in v)return this.From=date.tryParse(v.From),this.To=date.tryParse(v.To),this.normalize(),this;let px=(v||"").split("-");if("all"===px[0].toLowerCase())return this.From=date.minDate,this.To=date.maxDate,this;let df=px[0],dt=px.length>1?px[1]:px[0];return this.From=date.tryParse(df),this.To=date.tryParse(dt),this},TPeriod.prototype.isAllData=function(){return this.From.getTime()===date.minDate.getTime()&&this.To.getTime()===date.maxDate.getTime()},TPeriod.prototype.format=function(dataType){if(this.isAllData())return"DateUrl"===dataType?"All":locale.$AllPeriodData;let from=this.From,to=this.To;return from.getTime()===to.getTime()?utils.format(from,dataType):"DateUrl"===dataType?utils.format(from,dataType)+"-"+utils.format(to,dataType):utils.format(from,dataType)+" - "+(utils.format(to,dataType)||"???")},TPeriod.prototype.text=function(showCustom){if(this.isAllData())return locale.$AllPeriodData;let menu=predefined(!1);for(let mi of menu){let np=createPeriod(mi.key);if(this.equal(np))return mi.name}if(showCustom)return locale.$CustomPeriod;let from=this.From,to=this.To;return utils.format(from,"Date")+" - "+(utils.format(to,"Date")||"???")},TPeriod.prototype.in=function(dt){let t=dt.getTime(),zd=utils.date.zero().getTime();if(this.From.getTime()!==zd&&this.To.getTime()!==zd)return t>=this.From.getTime()&&t<=this.To.getTime()},TPeriod.prototype.normalize=function(){return this.From.getTime()>this.To.getTime()&&([this.From,this.To]=[this.To,this.From]),this},TPeriod.prototype.set=function(from,to){return this.From=from,this.To=to,this.normalize()},TPeriod.prototype.toJson=function(){return JSON.stringify(this)},{isPeriod,like:function(obj){return!!obj&&(2===Object.getOwnPropertyNames(obj).length&&!(!obj.hasOwnProperty("From")||!obj.hasOwnProperty("To")))},constructor:TPeriod,zero:zeroPeriod,all:function(){return createPeriod("allData")},create:createPeriod,predefined};function isPeriod(value){return value instanceof TPeriod}function zeroPeriod(){return new TPeriod}function predefined(showAll){let menu=[{name:locale.$Today,key:"today"},{name:locale.$Yesterday,key:"yesterday"},{name:locale.$Last7Days,key:"last7"},{name:locale.$CurrMonth,key:"currMonth"},{name:locale.$PrevMonth,key:"prevMonth"},{name:locale.$CurrQuart,key:"currQuart"},{name:locale.$PrevQuart,key:"prevQuart"},{name:locale.$CurrYear,key:"currYear"},{name:locale.$PrevYear,key:"prevYear"}];return showAll&&menu.push({name:locale.$AllPeriodData,key:"allData"}),menu}function createPeriod(key,from,to){let today=date.today(),p=zeroPeriod();switch(key){case"today":p.set(today,today);break;case"yesterday":let yesterday=date.add(today,-1,"day");p.set(yesterday,yesterday);break;case"last7":let last7=date.add(today,-6,"day");p.set(last7,today);break;case"last30":let last30=date.add(today,-29,"day");p.set(last30,today);break;case"startMonth":let d1=date.create(today.getFullYear(),today.getMonth()+1,1);p.set(d1,today);break;case"prevMonth":{let d1=date.create(today.getFullYear(),today.getMonth(),1),d2=date.create(today.getFullYear(),today.getMonth()+1,1);p.set(d1,date.add(d2,-1,"day"))}break;case"currMonth":{let d1=date.create(today.getFullYear(),today.getMonth()+1,1),d2=date.create(today.getFullYear(),today.getMonth()+2,1);p.set(d1,date.add(d2,-1,"day"))}break;case"startQuart":{let m=3*Math.floor(today.getMonth()/3),d1=date.create(today.getFullYear(),m+1,1);p.set(d1,today)}break;case"currQuart":{let year=today.getFullYear(),q=Math.floor(today.getMonth()/3),m1=3*q,m2=3*(q+1),d1=date.create(year,m1+1,1),d2=date.add(date.create(year,m2+1,1),-1,"day");p.set(d1,d2)}break;case"prevQuart":{let year=today.getFullYear(),q=Math.floor(today.getMonth()/3)-1;q<0&&(year-=1,q=3);let m1=3*q,m2=3*(q+1),d1=date.create(year,m1+1,1),d2=date.add(date.create(year,m2+1,1),-1,"day");p.set(d1,d2)}break;case"startYear":let dy1=date.create(today.getFullYear(),1,1);p.set(dy1,today);break;case"currYear":{let dy1=date.create(today.getFullYear(),1,1),dy2=date.create(today.getFullYear(),12,31);p.set(dy1,dy2)}break;case"prevYear":{let dy1=date.create(today.getFullYear()-1,1,1),dy2=date.create(today.getFullYear()-1,12,31);p.set(dy1,dy2)}break;case"allData":p.set(date.minDate,date.maxDate);break;case"custom":p.set(from,to);break;default:console.error("invalid menu key: "+key)}return p}},app.modules["std:modelInfo"]=function(){const period=require("std:period");return{copyfromQuery:function(mi,q){if(!mi)return;let psq={PageSize:q.pageSize,Offset:q.offset,SortDir:q.dir,SortOrder:q.order,GroupBy:q.group};for(let p in psq)mi[p]=psq[p];if(mi.Filter)for(let p in mi.Filter)mi.Filter[p]=q[p]},get:function(mi){if(!mi)return;let x={pageSize:mi.PageSize,offset:mi.Offset,dir:mi.SortDir,order:mi.SortOrder,group:mi.GroupBy};if(mi.Filter)for(let p in mi.Filter)x[p]=mi.Filter[p];return x},reconcile,reconcileAll,setModelInfoForRoot:function(elem){elem.$createModelInfo=createElemModelInfo,elem._setModelInfo_=setRootModelInfo,elem._findRootModelInfo=findRootModelInfo},setModelInfo:function(root,info,rawData){root.__modelInfo=info||{PageSize:20};let mi=rawData.$ModelInfo;if(!mi)return;reconcileAll(mi);for(let p in mi)root[p].$ModelInfo=checkPeriod(mi[p])}};function reconcile(mi){if(mi&&mi.Filter)for(let p in mi.Filter){let fv=mi.Filter[p];if("string"==typeof fv&&fv.startsWith('"\\/"')){let dx=new Date(fv.substring(4,fv.length-4));mi.Filter[p]=dx}}}function reconcileAll(m){if(m)for(let p in m)reconcile(m[p])}function checkPeriod(obj){let f=obj.Filter;if(!f)return obj;if(!("Period"in f))return obj;let p=f.Period;return period.like(p)&&(f.Period=new period.constructor(p)),obj}function setModelInfoFilter(prop,val){period.isPeriod(val)?this.Filter[prop].assign(val):this.Filter[prop]=val}function setRootModelInfo(elem,data){if(data.$ModelInfo)for(let p in data.$ModelInfo)return elem||(elem=this[p]),elem.$ModelInfo=checkPeriod(data.$ModelInfo[p]),elem.$ModelInfo.$setFilter=setModelInfoFilter,elem.$ModelInfo}function createElemModelInfo(elem,raw){return elem.$ModelInfo||(elem.$ModelInfo=checkPeriod(raw),elem.$ModelInfo.$setFilter=setModelInfoFilter),elem.$ModelInfo}function findRootModelInfo(){for(let p in this._meta_.props){let x=this[p];if(x.$ModelInfo)return x.$ModelInfo}return null}},app.modules["std:http"]=function(){const eventBus=require("std:eventBus"),urlTools=require("std:url");return{get:function(url,raw){return doRequest("GET",url,null,raw)},post:function(url,data,raw,skipEvents){return doRequest("POST",url,data,raw,skipEvents)},load:function(url,selector,baseUrl){if(selector){let fc=selector.firstElementChild;if(fc&&fc.__vue__){let ve=fc.__vue__;ve.$destroy(),ve.$el.remove(),ve.$el=null,fc.__vue__=null}selector.innerHTML=""}return new Promise((function(resolve,reject){eventBus.$emit("beginLoad"),doRequest("GET",url).then((function(html){if(html.startsWith("<!DOCTYPE"))return void window.location.assign("/");let rdoc=(new DOMParser).parseFromString(html,"text/html"),srcElem=rdoc.body.firstElementChild,elemId=srcElem.id||null;if(selector.innerHTML=srcElem?srcElem.outerHTML:"",elemId&&!document.getElementById(elemId))return selector.innerHTML="",void resolve(!1);for(let i=0;i<rdoc.scripts.length;i++){let s=rdoc.scripts[i];if("text/javascript"===s.type){let newScript=document.createElement("script");s.src?newScript.src=s.src:newScript.text=s.text,document.body.appendChild(newScript).parentNode.removeChild(newScript)}}if(selector.firstElementChild&&selector.firstElementChild.__vue__){let fec=selector.firstElementChild,ve=fec.__vue__;if(ve.$data.__baseUrl__=baseUrl||urlTools.normalizeRoot(url),ve.$data.__baseQuery__=urlTools.parseUrlAndQuery(url).query,fec.classList.contains("modal")){let dca=fec.getAttribute("data-controller-attr");dca&&eventBus.$emit("modalSetAttribites",dca,ve)}}rdoc.body.remove(),resolve(!0),eventBus.$emit("endLoad")})).catch((function(error){reject(error),eventBus.$emit("endLoad")}))}))},upload:function(url,data){return new Promise((function(resolve,reject){let xhr=new XMLHttpRequest;xhr.onload=function(response){if(eventBus.$emit("endRequest",url),200===xhr.status){let xhrResult=xhr.responseText?JSON.parse(xhr.responseText):"";resolve(xhrResult)}else 255===xhr.status&&reject(xhr.responseText||xhr.statusText)},xhr.onerror=function(response){alert("Error")},xhr.open("POST",url,!0),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.setRequestHeader("Accept","application/json"),eventBus.$emit("beginRequest",url),xhr.send(data)}))},localpost:function(command,data){return new Promise((function(resolve,reject){let xhr=new XMLHttpRequest;xhr.onload=function(response){if(200===xhr.status){let ct=xhr.getResponseHeader("content-type"),xhrResult=xhr.responseText;-1!==ct.indexOf("application/json")&&(xhrResult=JSON.parse(xhr.responseText)),resolve(xhrResult)}else 255===xhr.status?reject(xhr.responseText||xhr.statusText):reject(xhr.statusText)},xhr.onerror=function(response){reject(response)};let url="http://127.0.0.1:64031/"+command;xhr.open("POST",url,!0),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.setRequestHeader("Accept","text/plain"),xhr.setRequestHeader("Content-Type","text/plain"),xhr.send(data)}))}};function doRequest(method,url,data,raw,skipEvents){return new Promise((function(resolve,reject){let xhr=new XMLHttpRequest;xhr.onload=function(response){if(skipEvents||eventBus.$emit("endRequest",url),200===xhr.status){if(raw)return void resolve(xhr.response);let ct=xhr.getResponseHeader("content-type")||"",xhrResult=xhr.responseText;ct&&-1!==ct.indexOf("application/json")&&(xhrResult=xhr.responseText?JSON.parse(xhr.responseText):""),resolve(xhrResult)}else 255===xhr.status?raw?xhr.response instanceof Blob?function(blob,callback){const fr=new FileReader;fr.addEventListener("loadend",e=>{const text=fr.result;callback(text)}),fr.readAsText(blob)}(xhr.response,msg=>reject("server error: "+msg)):reject(xhr.statusText):reject(xhr.responseText||xhr.statusText):473===xhr.status?"Unauthorized"===xhr.statusText&&window.location.assign("/"):reject(xhr.statusText)},xhr.onerror=function(response){skipEvents||eventBus.$emit("endRequest",url),reject(xhr.statusText)},xhr.open(method,url,!0),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.setRequestHeader("Accept","application/json, text/html"),raw&&(xhr.responseType="blob"),skipEvents||eventBus.$emit("beginRequest",url),xhr.send(data)}))}},function(){const eventBus=require("std:eventBus"),urlTools=require("std:url"),titleStore={};function setTitle(to){to.title&&(document.title=to.title,titleStore[to.url]=to.title)}function normalizedRoute(){let path=window.location.pathname;return urlTools.normalizeRoot(path)}const store=new Vuex.Store({strict:!0,state:{route:normalizedRoute(),query:urlTools.parseQueryString(window.location.search)},getters:{seg0:state=>state.route.split("/")[1],seg1:state=>state.route.split("/")[2],len:state=>state.route.split("/").length,url:state=>state.route,query:state=>state.query,route:state=>{let sr=state.route.split("/");return{len:sr.length,seg0:sr[1],seg1:sr[2]}},baseUrl:state=>state.route+urlTools.makeQueryString(state.query),search:state=>urlTools.makeQueryString(state.query)},mutations:{navigate:function(state,to){let root=window.$$rootUrl,oldUrl=root+state.route+urlTools.makeQueryString(state.query);state.route=to.url.toLowerCase(),state.query=Object.assign({},to.query);let newUrl=root+state.route+urlTools.makeQueryString(to.query),h=window.history;setTitle(to),h.replaceState(oldUrl,null,oldUrl),h.pushState(oldUrl,null,newUrl)},query:function(state,query){let root=window.$$rootUrl;state.query=Object.assign({},query);let newUrl=root+state.route+urlTools.makeQueryString(state.query);window.history.replaceState(null,null,newUrl)},setquery:function(state,query){let root=window.$$rootUrl,oldUrl=root+this.getters.baseUrl;state.query=Object.assign({},state.query,query);let newUrl=root+this.getters.baseUrl;newUrl!==oldUrl&&(window.history.replaceState(null,null,newUrl),eventBus.$emit("queryChange",state.query))},popstate:function(state){state.route=normalizedRoute(),state.query=urlTools.parseQueryString(window.location.search),state.route in titleStore&&(document.title=titleStore[state.route])},setstate:function(state,to){window.history.replaceState(null,null,window.$$rootUrl+to.url),state.route=normalizedRoute(),state.query=urlTools.parseQueryString(window.location.search),setTitle(to)},setnewid:function(state,to){let root=window.$$rootUrl,oldRoute=state.route,newRoute=urlTools.replaceSegment(oldRoute,to.id,to.action);state.route=newRoute;let newUrl=root+newRoute+urlTools.makeQueryString(state.query);window.history.replaceState(null,null,newUrl)},close:function(state){function navigateBack(){window.close()}if(window.history.length>1){let oldUrl=window.location.pathname;window.history.back(),setTimeout(()=>{window.location.pathname===oldUrl&&navigateBack()},300)}else navigateBack()}}});function replaceUrlSearch(url,search){return url.split("?")[0]+(search||"")}store.parseQueryString=urlTools.parseQueryString,store.makeQueryString=urlTools.makeQueryString,store.replaceUrlSearch=replaceUrlSearch,store.replaceUrlQuery=function(url,query){return replaceUrlSearch(url,urlTools.makeQueryString(query))},store.makeBackUrl=function(url){let urlArr=url.split("/");return 5===urlArr.length?urlArr.slice(0,3).join("/"):4===url.length?urlArr.slice(0,2).join("/"):url},app.components["std:store"]=store}(),app.modules["std:log"]=function(){let _traceEnabled=!1,_sessionLoaded=!1;return{info:function(msg){if(!_traceEnabled)return;console.info(msg)},warn:function(msg){if(!_traceEnabled)return;console.warn(msg)},error:function(msg){console.error(msg)},time:function(msg,start,enable){if(!_traceEnabled&&!enable)return;console.warn(msg+" "+(performance.now()-start).toFixed(2)+" ms")},traceEnabled:function(){return _sessionLoaded||function(){let te=window.sessionStorage.getItem("traceEnabled");null!==te&&(_traceEnabled="true"===te,_traceEnabled&&console.warn("tracing is enabled"));_sessionLoaded=!0}(),_traceEnabled},enableTrace:function(val){if(window.$$debug){_traceEnabled=val,console.warn("tracing is "+(_traceEnabled?"enabled":"disabled"));try{window.sessionStorage.setItem("traceEnabled",val)}catch(err){}}}}},app.modules["std:console"]=function(){return{log(){window.$$debug&&console.log(...arguments)},dir(){window.$$debug&&console.dir(...arguments)},info(){window.$$debug&&console.info(...arguments)},error(){window.$$debug&&console.error(...arguments)},warn(){window.$$debug&&console.warn(...arguments)}}},app.modules["std:validators"]=function(){const utils=require("std:utils"),eventBus=require("std:eventBus"),EMAIL_REGEXP=/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,URL_REGEXP=/^[a-z][a-z\d.+-]*:\/*(?:[^:@]+(?::[^@]+)?@)?(?:[^\s:/?#]+|\[[a-f\d:]+\])(?::\d+)?(?:\/[^?#]*)?(?:\?[^#]*)?(?:#.*)?$/i;let validateMap=new WeakMap;return{validate:function(rules,item,val,du){let arr=[];utils.isArray(rules)?arr=rules:utils.isObject(rules)||utils.isFunction(rules)?arr.push(rules):utils.isString(rules)&&arr.push({valid:"notBlank",msg:rules});return function(rules,item,val,ff){let retval=[];return retval.pending=0,rules.forEach((function(rule){const sev=rule.severity||"error";if(!utils.isFunction(rule.applyIf)||rule.applyIf(item,val))if(utils.isString(rule))validateStd({valid:"notBlank"},val)||retval.push({msg:rule,severity:"error"});else if(utils.isFunction(rule)){let vr=rule(item,val);utils.isString(vr)&&vr?retval.push({msg:vr,severity:sev}):utils.isObject(vr)&&retval.push({msg:vr.msg,severity:vr.severity||sev})}else if(utils.isString(rule.valid))validateStd(rule,val)||retval.push({msg:rule.msg,severity:sev});else if(utils.isFunction(rule.valid)){if(rule.async){if(!validateMap.has(rule))return void addToWeak(rule,item,val);{let vmset=validateMap.get(rule);if(!vmset.has(item))return void addToWeak(rule,item,val);{let vmv=vmset.get(item);if(vmv.val===function(o1){if(utils.isObjectExact(o1)&&"$id"in o1)return o1.$id;return o1}(val))return void(vmv.result&&retval.push(vmv.result))}}}let vr=rule.valid(item,val);if(vr&&vr.then){if(retval.pending+=1,!rule.async)return void console.error("Async rules should be marked async:true");let valRes=addToWeak(rule,item,val);vr.then(result=>{let dm={severity:sev,msg:rule.msg},nu=!1;utils.isString(result)?(dm.msg=result,valRes.result=dm,retval.push(dm),nu=!0):result||(retval.push(dm),valRes.result=dm,nu=!0),item._root_._needValidate_=!0,nu&&ff&&ff(),retval.pending-=1,eventBus.$emit("pendingValidate")})}else utils.isString(vr)?retval.push({msg:vr,severity:sev}):utils.isObjectExact(vr)?retval.push({msg:vr.msg,severity:vr.severity}):vr||retval.push({msg:rule.msg,severity:sev})}else console.error("invalid valid element type for rule")})),retval}(arr,item,val,du)},removeWeak:function(){validateMap=new WeakMap}};function validateStd(rule,val){switch(rule.valid){case"notBlank":return utils.notBlank(val);case"email":return""===val||EMAIL_REGEXP.test(val);case"url":return""===val||URL_REGEXP.test(val);case"isTrue":return!0===val;case"regExp":return rule.regExp instanceof RegExp?""===val||rule.regExp.test(val):(console.error("rule.regExp is undefined or is not an regular expression"),!1)}return console.error(`invalid std rule: '${rule}'`),!0}function addToWeak(rule,item,val){let valMap;validateMap.has(rule)?valMap=validateMap.get(rule):(valMap=new WeakMap,validateMap.set(rule,valMap)),utils.isObjectExact(val)&&"$id"in val&&(val=val.$id);let valRes={val,result:null};return valMap.set(item,valRes),valRes}},app.modules["std:impl:array"]=function(){const utils=require("std:utils");return{defineArray:function(arr){arr.$lock=!1,arr.$lockUpdate=function(lock){this.$lock=lock},arr.$new=function(src){let newElem=new this._elem_(src||null,this._path_+"[]",this);return newElem.__checked=!1,newElem},arr.$sum=function(fn){return this.reduce((a,c)=>a+fn(c),0)},arr.$find=function(fc,thisArg){for(let i=0;i<this.length;i++){let el=this[i];if(fc.call(thisArg,el,i,this))return el;if("$items"in el){let x=el.$items.$find(fc,thisArg);if(x)return x}}return null},arr.$sort=function(compare){return this.sort(compare),this.$renumberRows(),this},arr.$copy=function(src){if(this.$root.isReadOnly)return this;if(this.$empty(),utils.isArray(src))for(let i=0;i<src.length;i++)this.push(this.$new(src[i]));return this.$renumberRows(),this},arr.$select=function(elem){elem.$select()},arr.$clearSelected=function(){let sel=this.$selected;return sel?(sel.$selected=!1,emitSelect(this,null),this):this},function(arr){arr.$empty=function(){return this.$root.isReadOnly||(this.splice(0,this.length),"$RowCount"in this&&(this.$RowCount=0)),this},arr.$append=function(src){return this.$insert(src,"end")},arr.$prepend=function(src){return this.$insert(src,"start")},arr.$insert=function(src,to,current){const that=this;function append(src,select){let addingEvent=that._path_+"[].adding",newElem=that.$new(src);if(!1===that._root_.$emit(addingEvent,that,newElem))return null;let ix,len=that.length,ne=null;switch(to){case"end":len=that.push(newElem),ne=that[len-1];break;case"start":that.unshift(newElem),ne=that[0],len=1;break;case"above":ix=that.indexOf(current),that.splice(ix,0,newElem),ne=that[ix],len=ix+1;break;case"below":ix=that.indexOf(current)+1,that.splice(ix,0,newElem),ne=that[ix],len=ix+1}"$RowCount"in that&&(that.$RowCount+=1);let eventName=that._path_+"[].add";if(that._root_.$setDirty(!0),that._root_.$emit(eventName,that,ne,len-1),select&&(ne.$select(),emitSelect(that,ne)),"$rowNo"in newElem._meta_){let rowNoProp=newElem._meta_.$rowNo;for(let i=0;i<that.length;i++)that[i][rowNoProp]=i+1}if(that.$parent){let m=that.$parent._meta_;m.$hasChildren&&that._path_.endsWith("."+m.$items)&&(that.$parent[m.$hasChildren]=!0)}return ne}if(utils.isArray(src)){let ra=[],lastElem=null;return src.forEach((function(elem){lastElem=append(elem,!1),ra.push(lastElem)})),lastElem&&lastElem.$select(),ra}return append(src,!0)},arr.$renumberRows=function(){if(!this.length)return this;let item=this[0];if("$rowNo"in item._meta_){let rowNoProp=item._meta_.$rowNo;for(let i=0;i<this.length;i++)this[i][rowNoProp]=i+1}return this},arr.$remove=function(item){if(this.$root.isReadOnly)return this;if(!item)return this;let index=this.indexOf(item);if(-1===index)return this;this.splice(index,1),"$RowCount"in this&&(this.$RowCount-=1);let eventName=this._path_+"[].remove";if(this._root_.$setDirty(!0),this._root_.$emit(eventName,this,item,index),!this.length){if(this.$parent){let m=this.$parent._meta_;m.$hasChildren&&this._path_.endsWith("."+m.$items)&&(this.$parent[m.$hasChildren]=!1),m.$items&&this.$parent.$select()}return this}return index>=this.length&&(index-=1),this.$renumberRows(),this.length>index&&this[index].$select(),this}}(arr)},defineArrayItemProto:function(elem){let proto=elem.prototype;proto.$remove=function(){this._parent_.$remove(this)},proto.$select=function(root){let arr=root||this._parent_,sel=arr.$selected;if(sel!==this&&(sel&&(sel.$selected=!1),this.$selected=!0,emitSelect(arr,this),this._meta_.$items)){let p=this._parent_._parent_;for(;p&&p&&p!==this.$root;)p.$expanded=!0,p=p._parent_._parent_}}}};function emitSelect(arr,item){let selectEvent=arr._path_+"[].select";arr._root_.$emit(selectEvent,arr,item)}},function(){const platform=require("std:platform"),validators=require("std:validators"),utils=require("std:utils"),log=require("std:log",!0),period=require("std:period"),mitool=require("std:modelInfo"),arrtool=require("std:impl:array");let __initialized__=!1;function loginfo(msg){log&&log.info(msg)}function logtime(msg,time){log&&log.time(msg,time)}function defHidden(obj,prop,value,writable){Object.defineProperty(obj,prop,{writable:writable||!1,enumerable:!1,configurable:!1,value})}function defHiddenGet(obj,prop,get){Object.defineProperty(obj,prop,{enumerable:!1,configurable:!1,get})}function defPropertyGet(trg,prop,get){Object.defineProperty(trg,prop,{enumerable:!0,configurable:!0,get})}function propFromPath(path){if(!path)return"";let propIx=path.lastIndexOf(".");return path.substring(propIx+1)}function defSource(trg,source,prop,parent){let propCtor=trg._meta_.props[prop];propCtor.type&&(propCtor=propCtor.type);let pathdot=trg._path_?trg._path_+".":"",shadow=trg._src_;if(source=source||{},utils.isObjectExact(propCtor)){if(!("type"in propCtor))throw new Error(`Invalid _meta_ for '${prop}'`);propCtor=propCtor.type}switch(propCtor){case Number:shadow[prop]=source[prop]||0;break;case String:shadow[prop]=source[prop]||"";break;case Boolean:shadow[prop]=source[prop]||!1;break;case Date:let srcval=source[prop]||null;shadow[prop]=srcval?new Date(srcval):utils.date.zero();break;case platform.File:case Object:shadow[prop]=null;break;case TMarker:let mp=trg._meta_.markerProps[prop];shadow[prop]=mp;break;case period.constructor:shadow[prop]=new propCtor(source[prop]);break;default:shadow[prop]=new propCtor(source[prop]||null,pathdot+prop,trg)}Object.defineProperty(trg,prop,{enumerable:!0,configurable:!0,get(){return this._src_[prop]},set(val){let eventWasFired=!1,skipDirty=prop.startsWith("$$"),ctor=this._meta_.props[prop],isjson=!1;if(ctor.type&&(isjson=!!ctor.json,ctor=ctor.type),isjson||(val=function(type,val){return utils.isDefined(val)||(val=utils.defaultValue(type)),type===Number?utils.toNumber(val):type===String?utils.toString(val):type!==Date||utils.isDate(val)?val:utils.date.parse(""+val)}(ctor,val)),val===this._src_[prop])return;let oldVal=this._src_[prop];if(!this._lockEvents_){let changingEvent=(this._path_||"Root")+"."+prop+".changing";if(!1===this._root_.$emit(changingEvent,this,val,oldVal,prop))return}if(this._src_[prop]&&this._src_[prop].$set?(this._src_[prop].$set(val),eventWasFired=!0):this._src_[prop]=val,skipDirty||this._root_.$setDirty(!0,this._path_,prop),this._lockEvents_)return;if(eventWasFired)return;let eventName=(this._path_||"Root")+"."+prop+".change";this._root_.$emit(eventName,this,val,oldVal,prop)}})}function TMarker(){}function createObjProperties(elem,ctor){let templ=elem._root_.$template;if(!templ)return;let props=templ._props_;if(!props)return;let objname=ctor.name;if(objname in props)for(let p in props[objname]){let propInfo=props[objname][p];utils.isPrimitiveCtor(propInfo)||(utils.isFunction(propInfo)?(loginfo(`create property: ${objname}.${p}`),Object.defineProperty(elem,p,{configurable:!1,enumerable:!0,get:propInfo})):utils.isObjectExact(propInfo)?propInfo.get&&(loginfo(`create property: ${objname}.${p}`),Object.defineProperty(elem,p,{configurable:!1,enumerable:!0,get:propInfo.get,set:propInfo.set})):alert("todo: invalid property type"))}}function seal(elem){if(Object.seal(elem),elem._meta_)for(let p in elem._meta_.props){let ctor=elem._meta_.props[p];if(ctor.type&&(ctor=ctor.type),utils.isPrimitiveCtor(ctor))continue;if(ctor===period.constructor)continue;let val=elem[p];utils.isArray(val)?val.forEach(itm=>seal(itm)):utils.isObjectExact(val)&&seal(val)}}function isReadOnly(){if("__modelInfo"in this){let mi=this.__modelInfo;if(utils.isDefined(mi.ReadOnly)&&mi.ReadOnly)return!0;if(utils.isDefined(mi.StateReadOnly)&&mi.StateReadOnly)return!0}return!1}function isStateReadOnly(){if("__modelInfo"in this){let mi=this.__modelInfo;if(utils.isDefined(mi.StateReadOnly)&&mi.StateReadOnly)return!0}return!1}function mainObject(){if("$main"in this._meta_){return this[this._meta_.$main]}return null}function isModelIsCopy(){if("__modelInfo"in this){let mi=this.__modelInfo;if(utils.isDefined(mi.Copy))return mi.Copy}return!1}function _BaseArray(length){let arr=new Array(length||0);return function(arr){defineCommonProps(arr),arrtool.defineArray(arr),defPropertyGet(arr,"$selected",(function(){for(let x of this.$elements)if(x.$selected)return x})),defPropertyGet(arr,"$selectedIndex",(function(){for(let i=0;i<this.length;i++)if(this[i].$selected)return i;return-1})),defPropertyGet(arr,"$elements",(function(){return function*elems(arr){for(let i=0;i<arr.length;i++){let val=arr[i];yield val,val.$items&&(yield*elems(val.$items))}}(this)})),defPropertyGet(arr,"Count",(function(){return this.length})),defPropertyGet(arr,"$isEmpty",(function(){return!this.length})),defPropertyGet(arr,"$checked",(function(){return this.filter(el=>el.$checked)})),defPropertyGet(arr,"$hasSelected",(function(){return!!this.$selected})),arr.Selected=function(propName){let sel=this.$selected;return sel?sel[propName]:null},arr.$isLazy=function(){const meta=this.$parent._meta_;if(!meta.$lazy)return!1;let prop=propFromPath(this._path_);return-1!==meta.$lazy.indexOf(prop)},arr.$load=function(){this.$isLazy()&&platform.defer(()=>this.$loadLazy())},arr.$resetLazy=function(){return this.$lock=!1,this.$empty(),this.$loaded&&(this.$loaded=!1),this},arr.$loadLazy=function(){if(this.$isLazy()&&!this.$lock)return new Promise((resolve,reject)=>{if(!this.$vm)return;if(this.$loaded)return void resolve(this);if(!this.$parent)return void resolve(this);const meta=this.$parent._meta_;if(!meta.$lazy)return void resolve(this);let prop=propFromPath(this._path_);-1!==meta.$lazy.indexOf(prop)?this.$vm.$loadLazy(this.$parent,prop).then(()=>resolve(this)):resolve(this)})},arr.$reload=function(){return this.$lock=!1,this.$vm.$reload(this)},arr.__fireChange__=function(opts){let root=this.$root,itm=this;"selected"===opts&&(itm=this.$selected),root.$emit(this._path_+"[].change",this,itm)}}(arr),arr}function defineCommonProps(obj){defHiddenGet(obj,"$host",(function(){return this._root_._host_})),defHiddenGet(obj,"$root",(function(){return this._root_})),defHiddenGet(obj,"$parent",(function(){return this._parent_})),defHiddenGet(obj,"$vm",(function(){return this._root_&&this._root_._host_?this._root_._host_.$viewModel:null})),defHiddenGet(obj,"$ctrl",(function(){return this._root_&&this._root_._host_?this._root_._host_.$ctrl:null})),defHiddenGet(obj,"$ready",(function(){return!this.$vm||!this.$vm.$isLoading})),obj.$isValid=function(props){return!0}}function emit(event,...arr){this._enableValidate_&&(this._needValidate_||(this._needValidate_=!0)),loginfo("emit: "+event);let templ=this.$template;if(!templ)return;let events=templ.events;if(events&&event in events){loginfo("handle: "+event);let rv=events[event].call(this,...arr);return!1===rv&&loginfo(event+" returns false"),rv}}function getDelegate(name){let tml=this.$template;return tml&&tml.delegates?name in tml.delegates?tml.delegates[name].bind(this.$root):void console.error(`Delegate "${name}" not found in the template`):(console.error("There are no delegates in the template"),null)}function canExecuteCommand(cmd,arg,opts){const tml=this.$template;if(!tml)return!1;if(!tml.commands)return!1;const cmdf=tml.commands[cmd];if(!cmdf)return!1;const optsCheckValid=opts&&!0===opts.validRequired,optsCheckRO=opts&&!0===opts.checkReadOnly;return!(opts&&!0===opts.checkArgument&&!arg)&&((!0!==cmdf.checkReadOnly&&!optsCheckRO||!this.$root.$readOnly)&&(!((!0===cmdf.validRequired||optsCheckValid)&&!this.$root.$valid)&&(utils.isFunction(cmdf.canExec)?cmdf.canExec.call(this,arg):utils.isBoolean(cmdf.canExec)?cmdf.canExec:!utils.isDefined(cmdf.canExec)||(console.error(cmd+".canExec should be a function"),!1))))}function executeCommand(cmd,arg,confirm,opts){try{this._root_._enableValidate_=!1;let vm=this.$vm;const tml=this.$template;if(!tml)return;if(!tml.commands)return;let cmdf=tml.commands[cmd];if(!cmdf)return void console.error(`Command "${cmd}" not found`);const optConfirm=cmdf.confirm||confirm,optSaveRequired=cmdf.saveRequired||opts&&opts.saveRequired;if((cmdf.validRequired||opts&&opts.validRequired)&&!vm.$data.$valid)return;if(utils.isFunction(cmdf.canExec)&&!cmdf.canExec.call(this,arg))return;let that=this;const doExec=function(){const realExec=function(){return utils.isFunction(cmdf)?cmdf.call(that,arg):utils.isFunction(cmdf.exec)?cmdf.exec.call(that,arg):void console.error($`There is no method 'exec' in command '${cmd}'`)};if(!optConfirm)return realExec();vm.$confirm(optConfirm).then(realExec)};if(!optSaveRequired||!vm.$isDirty)return doExec();vm.$save().then(doExec)}finally{this._root_._enableValidate_=!0,this._root_._needValidate_=!0}}function saveErrors(item,path,errors){if(item._errors_||errors)return!item._errors_&&errors&&(item._errors_={}),errors&&errors.length>0?item._errors_[path]=errors:path in item._errors_&&delete item._errors_[path],utils.isEmptyObject(item._errors_)&&(item._errors_=null),errors}function validate(item,path,val,ff){if(!item._root_._needValidate_)return item._errors_&&path in item._errors_?item._errors_[path]:null;return saveErrors(item,path,function(item,path,val,du){if(!item)return null;let tml=item._root_.$template;if(!tml)return null;var vals=tml.validators;if(!vals)return null;var elemvals=vals[path];return elemvals?validators.validate(elemvals,item,val,du):null}(item,path,val,ff))}function*enumData(root,path,name,index){if(index=index||"",!path)return void(yield{item:root,val:root[name],ix:index});let sp=path.split("."),currentData=root;for(let i=0;i<sp.length;i++){let last=i===sp.length-1,prop=sp[i];if(prop.endsWith("[]")){let pname=prop.substring(0,prop.length-2);pname in currentData||console.error(`Invalid validator key. Property '${pname}' not found in '${currentData.constructor.name}'`);let objto=currentData[pname];if(!objto)continue;for(let j=0;j<objto.length;j++){let arrItem=objto[j];if(last)yield{item:arrItem,val:arrItem[name],ix:index+":"+j};else{let newpath=sp.slice(i+1).join(".");yield*enumData(arrItem,newpath,name,index+":"+j)}}return}{prop in currentData||console.error(`Invalid Validator key. property '${prop}' not found in '${currentData.constructor.name}'`);let objto=currentData[prop];if(last)return void(objto&&(yield{item:objto,val:objto[name],ix:index}));currentData=objto}}}function validateOneElement(root,path,vals){if(!vals)return;let errs=[];for(let elem of function*(root,path){let ld=path.lastIndexOf("."),dp="",dn=path;-1!==ld&&(dp=path.substring(0,ld),dn=path.substring(ld+1)),yield*enumData(root,dp,dn,"")}(root,path)){let res=validators.validate(vals,elem.item,elem.val);saveErrors(elem.item,path,res),res&&res.length&&errs.push(...res)}return errs.length?errs:null}function forceValidateAll(){this._needValidate_=!0;var retArr=this._validateAll_(!1);return this._validateAll_(!0),retArr}function validateAll(force){var me=this;if(!me._host_)return;if(!me._needValidate_)return;me._needValidate_=!1,force&&validators.removeWeak();var startTime=platform.performance.now();let tml=me.$template;if(!tml)return;let vals=tml.validators;if(!vals)return;let allerrs=[];for(var val in vals){let err1=validateOneElement(me,val,vals[val]);err1&&allerrs.push({x:val,e:err1})}return logtime("validation time:",startTime),allerrs}function setDirty(val,path,prop){this.$root.$readOnly||path&&path.toLowerCase().startsWith("query")||function(root){let t=root.$template,opts=t&&t.options;return opts&&opts.noDirty}(this.$root)||path&&prop&&function(root,path){let t=root.$template;const opts=t&&t.options;if(!opts)return!1;const sd=opts.skipDirty;return!(!sd||!utils.isArray(sd))&&-1!==sd.indexOf(path)}(this.$root,`${path}.${prop}`)||(this.$dirty=val)}function empty(){return this.$set({}),this}function setElement(src){this.$root.isReadOnly||this.$merge(src)}function getMaxLength(prop){let m=this._meta_.props;if(!m)return;let x=m[prop];return utils.isObjectExact(x)?x.len:void 0}function isSkipMerge(root,prop){let t=root.$template,opts=t&&t.options,bo=opts&&opts.bindOnce;return!!bo&&-1!==bo.indexOf(prop)}function saveSelections(){let root=this,t=root.$template,opts=t&&t.options;if(!opts)return;let ps=opts.persistSelect;if(!ps||!ps.length)return;let result={};for(let p of ps){let arr=utils.simpleEval(root,p);if("$selected"in arr){let sel=arr.$selected;sel&&(result[p]=sel.$id)}}return result}function restoreSelections(sels){if(!sels)return;let root=this;for(let p in sels){let arr=utils.simpleEval(root,p),selId=sels[p];if("$find"in arr){let se=arr.$find(x=>x.$id===selId);se&&se.$select()}}}function merge(src,checkBindOnce,existsOnly){let oldId=this.$id__;try{for(var prop in null===src&&(src={}),this._root_._enableValidate_=!1,this._lockEvents_+=1,this._meta_.props){if(prop.startsWith("$$"))continue;if(checkBindOnce&&isSkipMerge(this._root_,prop))continue;let ctor=this._meta_.props[prop];ctor.type&&(ctor=ctor.type);let trg=this[prop];if(Array.isArray(trg)){if(trg.$loaded&&(trg.$loaded=!1),trg.$copy(src[prop]),"$RowCount"in trg){let rcProp=prop+".$RowCount";trg.$RowCount=rcProp in src&&src[rcProp]||0}}else if(utils.isDateCtor(ctor)){src[prop]?platform.set(this,prop,new Date(src[prop])):platform.set(this,prop,utils.date.zero())}else if(utils.isPrimitiveCtor(ctor))platform.set(this,prop,src[prop]);else{if(existsOnly&&!(prop in src))continue;let newsrc=new ctor(src[prop],prop,this);platform.set(this,prop,newsrc)}}}finally{this._root_._enableValidate_=!0,this._root_._needValidate_=!0,this._lockEvents_-=1}if(this.$parent._lockEvents_)return this;let newId=this.$id__,fireChange=!1;if(utils.isDefined(newId)&&utils.isDefined(oldId)&&(fireChange=newId!==oldId),fireChange){let eventName=this._path_+".change";this._root_.$emit(eventName,this.$parent,this,this,propFromPath(this._path_))}return this}function setRootRuntimeInfo(runtime){if(runtime&&runtime.$cross)for(let p in this){if(p.startsWith("$")||p.startsWith("_"))continue;let ta=this[p];if(ta._elem_&&ta.$cross)for(let x in runtime.$cross){if(ta._elem_.name!=x)continue;let t=ta.$cross,s=runtime.$cross[x];for(let p in t){let ta=t[p],sa=s[p];ta&&sa?ta.splice(0,ta.length,...sa):ta&&!sa&&ta.splice(0,ta.length)}}}}function destroyRoot(){this._host_.$viewModel=null,this._host_=null}app.modules["std:datamodel"]={createObject:function(elem,source,path,parent){const ctorname=elem.constructor.name;let startTime=null;"TRoot"===ctorname&&(startTime=platform.performance.now()),parent=parent||elem,defHidden(elem,"_src_",{}),defHidden(elem,"_path_",path||""),defHidden(elem,"_root_",parent._root_||parent),defHidden(elem,"_parent_",parent),defHidden(elem,"_errors_",null,!0),defHidden(elem,"_lockEvents_",0,!0),elem._uiprops_={};let hasTemplProps=!1;const templ=elem._root_.$template;templ&&!utils.isEmptyObject(templ._props_)&&(hasTemplProps=!0),hasTemplProps&&function(elem,ctor){const templ=elem._root_.$template;if(!templ)return;const props=templ._props_;if(!props)return;let objname=ctor.name;if(objname in props)for(let p in props[objname]){let propInfo=props[objname][p];utils.isPrimitiveCtor(propInfo)?(loginfo(`create scalar property: ${objname}.${p}`),elem._meta_.props[p]=propInfo):utils.isObjectExact(propInfo)&&(propInfo.get||(loginfo(`create object property: ${objname}.${p}`),elem._meta_.props[p]=TMarker,elem._meta_.markerProps||(elem._meta_.markerProps={}),elem._meta_.markerProps[p]=propInfo))}}(elem,elem.constructor);for(let propName in elem._meta_.props)defSource(elem,source,propName);hasTemplProps&&createObjProperties(elem,elem.constructor),path&&path.endsWith("]")&&(elem.$selected=!1),elem._meta_.$items&&(elem.$expanded=!1,elem.$collapsed=!1,elem.$level=0,function(elem){elem.$expand=function(){if(!this._meta_.$items)return null;if(this.$expanded)return null;this[this._meta_.$items];return this.$vm.$expand(this,this._meta_.$items,!0)},elem.$selectPath=async function(arr,cb){if(!arr.length)return null;let itemsProp=this._meta_.$items;if(!itemsProp)return null;let current=null;cb(this,arr[0])&&(current=this);for(let i=1;i<arr.length;i++){if(!current)return null;await current.$expand(),current=current[itemsProp].$find(itm=>cb(itm,arr[i]))}return current}}(elem)),elem.$lockEvents=function(){this._lockEvents_+=1},elem.$unlockEvents=function(){this._lockEvents_-=1},defHiddenGet(elem,"$eventsLocked",(function(){return this._lockEvents_>0})),defPropertyGet(elem,"$valid",(function(){if(this._root_._needValidate_&&this._root_._validateAll_(),this._errors_)return!1;for(var x in this){if("$"===x[0]||"_"===x[0])continue;let sx=this[x];if(utils.isArray(sx))for(let i=0;i<sx.length;i++){let ax=sx[i];if(utils.isObject(ax)&&"$valid"in ax&&!ax.$valid)return!1}else if(utils.isObject(sx)&&"$valid"in sx&&!sx.$valid)return!1}return!0})),defPropertyGet(elem,"$invalid",(function(){return!this.$valid})),elem.$errors=function(prop){if(!this)return null;let root=this._root_;if(!root)return null;if(!root._validate_)return null;let path=`${this._path_}.${prop}`,arr=root._validate_(this,path,this[prop]);return arr&&0===arr.length?null:arr},!0===elem._meta_.$group&&defPropertyGet(elem,"$groupName",(function(){if(!utils.isDefined(this.$level))return"#err#";const mi=this._root_.__modelInfo.Levels;if(mi){const levs=mi[this.constructor.name];if(levs&&this.$level<=levs.length)return this[levs[this.$level-1]]}return console.error("invalid data for $groupName"),"#err#"})),elem._meta_.$itemType&&(elem.$setProperty=function(prop,src){let itmPath=path+"."+prop,ne=new elem._meta_.$itemType(src,itmPath,elem);return platform.set(this,prop,ne),this._root_.$setDirty(!0),ne});let constructEvent=ctorname+".construct",_lastCaller=null,propForConstruct=path?propFromPath(path):"";if(elem._root_.$emit(constructEvent,elem,propForConstruct),elem._root_===elem){for(var m in elem._root_ctor_=elem.constructor,elem.$dirty=!1,elem._query_={},elem._meta_.props){let rcp=m+".$RowCount";if(source&&rcp in source){let rcv=source[rcp]||0;elem[m].$RowCount=rcv}}mitool.setModelInfoForRoot(elem),elem._setRuntimeInfo_=setRootRuntimeInfo,elem._saveSelections=saveSelections,elem._restoreSelections=restoreSelections,elem._enableValidate_=!0,elem._needValidate_=!1,elem._modelLoad_=caller=>{_lastCaller=caller,function(root){if(root.$template&&root.$template.defaults)for(let p in root.$template.defaults){let px=p.lastIndexOf(".");if(-1===px)continue;let path=p.substring(0,px),prop=p.substring(px+1);if(prop.endsWith("[]"))continue;let def=root.$template.defaults[p],obj=utils.simpleEval(root,path);obj.$isNew&&(utils.isFunction(def)?platform.set(obj,prop,def.call(root,obj,prop)):platform.set(obj,prop,def))}}(elem),elem._fireLoad_(),__initialized__=!0},elem._fireLoad_=()=>{platform.defer(()=>{let isRequery=elem.$vm.__isModalRequery();elem.$emit("Model.load",elem,_lastCaller,isRequery),elem._root_.$setDirty(!!elem._root_.$isCopy)})},elem._fireUnload_=()=>{elem.$emit("Model.unload",elem)},defHiddenGet(elem,"$readOnly",isReadOnly),defHiddenGet(elem,"$stateReadOnly",isStateReadOnly),defHiddenGet(elem,"$isCopy",isModelIsCopy),defHiddenGet(elem,"$mainObject",mainObject),elem._seal_=seal,elem._fireGlobalPeriodChanged_=period=>{elem.$emit("GlobalPeriod.change",elem,period)}}return startTime&&logtime("create root time:",startTime),elem},createArray:function(source,path,ctor,arrctor,parent){let arr=new _BaseArray(source?source.length:0),dotPath=path+"[]";defHidden(arr,"_elem_",ctor),defHidden(arr,"_path_",path),defHidden(arr,"_parent_",parent),defHidden(arr,"_root_",parent._root_||parent),defPropertyGet(arr,"$valid",(function(){if(this._errors_)return!1;for(var x of this)if(x._errors_)return!1;return!0})),defPropertyGet(arr,"$invalid",(function(){return!this.$valid})),ctor.prototype._meta_.$cross&&defPropertyGet(arr,"$cross",(function(){return ctor.prototype._meta_.$cross})),createObjProperties(arr,arrctor);let constructEvent=arrctor.name+".construct";if(arr._root_.$emit(constructEvent,arr),!source)return arr;for(let i=0;i<source.length;i++)arr[i]=new arr._elem_(source[i],dotPath,arr),arr[i].__checked=!1;return arr},defineObject:function(obj,meta,arrayItem){var elem;defHidden(obj.prototype,"_meta_",meta),obj.prototype.$merge=merge,obj.prototype.$empty=empty,obj.prototype.$set=setElement,obj.prototype.$maxLength=getMaxLength,defineCommonProps(obj.prototype),defHiddenGet(obj.prototype,"$isNew",(function(){return!this.$id})),defHiddenGet(obj.prototype,"$isEmpty",(function(){return!this.$id})),defHiddenGet(obj.prototype,"$id",(function(){let idName=this._meta_.$id;if(!idName){let tpname=this.constructor.name;throw new Error(tpname+" object does not have an Id property")}return this[idName]})),defHiddenGet(obj.prototype,"$id__",(function(){let idName=this._meta_.$id;if(idName)return this[idName]})),defHiddenGet(obj.prototype,"$name",(function(){let nameName=this._meta_.$name;if(!nameName){let tpname=this.constructor.name;throw new Error(tpname+" object does not have a Name property")}return this[nameName]})),arrayItem&&(elem=obj,arrtool.defineArrayItemProto(elem),Object.defineProperty(elem.prototype,"$checked",{enumerable:!0,configurable:!0,get(){return this.__checked},set(val){this.__checked=val;let arr=this.$parent,checkEvent=arr._path_+"[].check";arr._root_.$emit(checkEvent,arr,this)}})),meta.$hasChildren&&defHiddenGet(obj.prototype,"$hasChildren",(function(){let hcName=this._meta_.$hasChildren;if(hcName)return this[hcName]})),meta.$items&&defHiddenGet(obj.prototype,"$items",(function(){let itmsName=this._meta_.$items;if(itmsName)return this[itmsName]})),meta.$permissions&&defHiddenGet(obj.prototype,"$permissions",(function(){let permName=this._meta_.$permissions;if(permName){var perm=this[permName];if(this.$isNew&&0===perm){let mi=this.$ModelInfo;mi&&utils.isDefined(mi.Permissions)&&(perm=mi.Permissions)}return Object.freeze({canView:!!(1&perm),canEdit:!!(2&perm),canDelete:!!(4&perm),canApply:!!(8&perm),canUnapply:!!(16&perm)})}}))},implementRoot:function(root,template,ctors){if(root.prototype.$emit=emit,root.prototype.$setDirty=setDirty,root.prototype.$defer=platform.defer,root.prototype.$merge=merge,root.prototype.$template=template,root.prototype._exec_=executeCommand,root.prototype._canExec_=canExecuteCommand,root.prototype._delegate_=getDelegate,root.prototype._validate_=validate,root.prototype._validateAll_=validateAll,root.prototype.$forceValidate=forceValidateAll,root.prototype.$destroy=destroyRoot,!template)return;let xProp={};for(let p in template.properties){let px=p.split(".");if(2!==px.length){console.error(`invalid propery name '${p}'`);continue}let typeName=px[0],propName=px[1],pv=template.properties[p];typeName in xProp||(xProp[typeName]={}),xProp[typeName][propName]=pv}template._props_=xProp},setModelInfo:mitool.setModelInfo,enumData}}(),function(){let http=require("std:http");app.modules["std:dataservice"]={post:function(url,data,raw){return http.post(url,data,raw)},get:function(url){return http.get(url)}}}(),app.modules["std:popup"]=function(){const __dropDowns__=[];let __started=!1;const __error="Perhaps you forgot to create a _close function for popup element";return{startService:function(){if(__started)return;__started=!0,document.body.addEventListener("click",closePopups),document.body.addEventListener("contextmenu",closePopups),document.body.addEventListener("keydown",closeOnEsc)},registerPopup:function(el){__dropDowns__.push(el)},unregisterPopup:function(el){let ix=__dropDowns__.indexOf(el);-1!==ix&&__dropDowns__.splice(ix,1);delete el._close},closeAll:function(){__dropDowns__.forEach(el=>{el._close&&el._close(document)})},closest,closeInside:function(el){if(!el)return;let ch=el.querySelectorAll(".popover-wrapper");for(let i=0;i<ch.length;i++){let chel=ch[i];chel._close&&chel._close()}}};function closest(node,css){return node?node.closest(css):null}function closePopups(ev){if(0!==__dropDowns__.length)for(let i=0;i<__dropDowns__.length;i++){let el=__dropDowns__[i];if(closest(ev.target,".dropdown-item")||ev.target.hasAttribute("close-dropdown")||closest(ev.target,"[dropdown-top]")!==el){if(!el._close)throw new Error(__error);el._close(ev.target)}}}function closeOnEsc(ev){if(27===ev.which)for(let i=0;i<__dropDowns__.length;i++){let el=__dropDowns__[i];if(!el._close)throw new Error(__error);el._close(ev.target)}}},app.modules["std:mask"]=function(){return{getMasked,getUnmasked:function(mask,value){let str="";for(let i=0;i<mask.length;i++){let mc=mask[i],ch=value[i];if(!isSpaceChar(mc))if(isMaskChar(mc)){if(!ch||"_"===ch)return"";str+=ch}else str+=mc}return str},mountElement,unmountElement,setMask:function(el,mask){if(!el)return;mask?el.__opts?(el.__opts.mask=mask,el.value=getMasked(mask,"")):(mountElement(el,mask),el.value=getMasked(mask,"")):(unmountElement(el,mask),el.value="")}};function isMaskChar(ch){return"#"===ch||"@"===ch}function isSpaceChar(ch){return-1!=="- ()".indexOf(ch)}function getMasked(mask,value){let str="",j=0;for(let i=0;i<mask.length;i++){let mc=mask[i],ch=value[j];mc===ch?(str+=ch,j++):isMaskChar(mc)?(str+=ch||"_",j++):str+=mc}return str}function mountElement(el,mask){el&&(el.__opts={mask},el.addEventListener("keydown",keydownHandler,!1),el.addEventListener("blur",blurHandler,!1),el.addEventListener("focus",focusHandler,!1),el.addEventListener("paste",pasteHandler,!1))}function unmountElement(el,mask){el&&(delete el.__opts,el.removeEventListener("keydown",keydownHandler),el.removeEventListener("blur",blurHandler),el.removeEventListener("focus",focusHandler),el.removeEventListener("paste",pasteHandler))}function getCaretPosition(input){return input&&void 0!==input.selectionStart?(input.selectionStart!==input.selectionEnd&&input.setSelectionRange(input.selectionStart,input.selectionStart),input.selectionStart):0}function fitCaret(mask,pos,fit){if(pos>=mask.length)return pos+1;if(isMaskChar(mask[pos]))return pos;if("r"===fit){for(let i=pos+1;i<mask.length;i++)if(isMaskChar(mask[i]))return i;return mask.length+1}if("l"===fit){for(let i=pos-1;i>=0;i--)if(isMaskChar(mask[i]))return i;return fitCaret(mask,0,"r")}throw new Error(`mask.fitCaret. Invalid fit value '${fit}'`)}function setCaretPosition(input,pos,fit){if(input&&0!==input.offsetWidth&&0!==input.offsetHeight&&input.setSelectionRange){pos=fitCaret(input.__opts.mask,pos,fit),input.setSelectionRange(pos,pos)}}function setRangeText(input,text,s,e){if(input.setRangeText)return void input.setRangeText(text,s,e);let val=input.value,r=val.substring(0,s);r+=text,r+=val.substring(e),input.value=r}function setCurrentChar(input,char){let pos=getCaretPosition(input),mask=input.__opts.mask;if(pos=fitCaret(mask,pos,"r"),function(mask,char){return"#"===mask&&(char>="0"&&char<="9"||"_"===char)}(mask[pos],char)){setRangeText(input,char,pos,pos+1);let np=fitCaret(mask,pos+1,"r");input.setSelectionRange(np,np)}}function keydownHandler(e){if(function(e,input){if(e.which>=112&&e.which<=123)return!0;if(16===e.which||17===e.which)return!0;if(e.which>=112&&e.which<=123)return!0;if(9===e.which)return!0;if(13===e.which)return fireChange(input),setTimeout(()=>{let d="l";input.value||(input.value=getMasked(input.__opts.mask,""),d="r"),setCaretPosition(input,"r"===d?0:32768,d)},10),!0;if(e.ctrlKey)switch(e.which){case 86:case 67:case 65:case 88:case 90:case 45:return!0}else if(e.shiftKey)switch(e.which){case 45:case 46:case 37:case 39:case 36:case 35:return!0}return!1}(e,this))return;let handled=!1;if(function(ev,input){if(46!==ev.which)return!1;let s=input.selectionStart,e=input.selectionEnd,l=input.value.length;return 0===s&&e===l&&(input.value=getMasked(input.__opts.mask,""),setCaretPosition(input,0,"r"),ev.preventDefault(),ev.stopPropagation(),!0)}(e,this))return;let pos=getCaretPosition(this),char=e.which;switch(229===char&&(char=e.target.value.charAt(e.target.selectionStart-1).charCodeAt()),char){case 37:setCaretPosition(this,pos-1,"l"),handled=!0;break;case 39:setCaretPosition(this,pos+1,"r"),handled=!0;break;case 38:case 40:case 33:case 34:handled=!0;break;case 36:setCaretPosition(this,0,"r"),handled=!0;break;case 35:setCaretPosition(this,this.__opts.mask.length,"l"),handled=!0;break;case 46:setCurrentChar(this,"_"),handled=!0;break;case 8:setCaretPosition(this,pos-1,"l"),setCurrentChar(this,"_"),setCaretPosition(this,pos-1,"l"),handled=!0;break;default:1===e.key.length&&setCurrentChar(this,e.key),handled=!0}handled&&(e.preventDefault(),e.stopPropagation())}function blurHandler(e){fireChange(this)}function focusHandler(){this.value||(this.value=getMasked(this.__opts.mask,"")),setTimeout(()=>{setCaretPosition(this,0,"r")},10)}function pasteHandler(e){e.preventDefault();let dat=e.clipboardData.getData("text/plain");dat&&(this.value=function(mask,value){let str="",j=0;function nextValueChar(){let ch;for(;;){if(ch=value[j],!ch)return"_";if(j++,ch>="0"&&ch<="9")return ch}}let ch=nextValueChar();for(let i=0;i<mask.length;i++){let mc=mask[i];isSpaceChar(mc)?str+=mc:isMaskChar(mc)?(str+=ch,ch=nextValueChar()):(str+=mc,mc===ch&&(ch=nextValueChar()))}return str}(this.__opts.mask,dat))}function fireChange(input){var evt=document.createEvent("HTMLEvents");evt.initEvent("change",!1,!0),input.dispatchEvent(evt)}},app.modules["std:tools"]=function(){const eventBus=require("std:eventBus");return{alert:function(msg,title,list){let dlgData={promise:null,data:{message:msg,title,style:"alert",list}};return eventBus.$emit("confirm",dlgData),dlgData.promise}}},app.modules["std:html"]=function(){return{getColumnsWidth:function(elem){let cols=elem.getElementsByTagName("col"),body=elem.querySelectorAll("tbody.col-shadow")[0];body.style.display="table-row-group";let cells=elem.querySelectorAll("tbody.col-shadow > tr > td"),len=Math.min(cols.length,cells.length);for(let i=0;i<len;i++){let w=cells[i].offsetWidth;cols[i].setAttribute("data-col-width",w)}body.style.display="none"},getRowHeight:function(elem,padding){let rows=elem.getElementsByTagName("tr");for(let r=0;r<rows.length;r++){let h=rows[r].offsetHeight-(padding||12);rows[r].setAttribute("data-row-height",h)}},downloadBlob:function(blob,fileName,format){let objUrl=URL.createObjectURL(blob),link=document.createElement("a");link.style="display:none",document.body.appendChild(link);let downloadFile=fileName||"file";"excel"===(format=(format||"").toLowerCase())?downloadFile+=".xlsx":"pdf"===format&&(downloadFile+=".pdf");link.download=downloadFile,link.href=objUrl,link.click(),document.body.removeChild(link),URL.revokeObjectURL(objUrl)},downloadUrl:function(url){let link=document.createElement("a");link.style="display:none",document.body.appendChild(link),link.href=url,link.setAttribute("download",""),link.click(),document.body.removeChild(link)},openUrl:function(url){let link=document.createElement("a");link.style="display:none",document.body.appendChild(link),link.href=url,link.setAttribute("target","_blank"),link.click(),document.body.removeChild(link)},printDirect:function(url){if(window.cefHost||navigator.userAgent.toLowerCase().indexOf("firefox")>-1)return void window.open(url);removePrintFrame();let frame=document.createElement("iframe");document.body.classList.add("waiting"),frame.id="print-direct-frame",frame.style.cssText="display:none;width:0;height:0;border:none;position:absolute;left:-10000,top:-100000",document.body.appendChild(frame),document.activeElement&&document.activeElement.blur();frame.setAttribute("src",url),frame.onload=function(ev){let cw=frame.contentWindow;if(cw.document.body){let finp=cw.document.createElement("input");finp.setAttribute("id","dummy-focus"),finp.cssText="width:0;height:0;border:none;position:absolute;left:-10000,top:-100000",cw.document.body.appendChild(finp),finp.focus(),cw.document.body.removeChild(finp)}document.body.classList.remove("waiting"),cw.print()}},removePrintFrame,updateDocTitle:function(title){if(document.title===title)return;document.title=title}};function removePrintFrame(){let frame=window.frames["print-direct-frame"];frame&&document.body.removeChild(frame)}},app.modules["std:routing"]=function(){return{dataUrl:function(msg){return"_data"}}},app.modules["std:accel"]=function(){const _elems=[];let _listenerAdded=!1,_key=42;return{registerControl:function(accel,elem,action){let key=_key++;var found=_elems.find(c=>c.accel===accel);found?found.handlers.unshift({key,elem,action}):_elems.push({accel,handlers:[{key,elem,action}]});return setListeners(),key},unregisterControl:function(key){var found=_elems.findIndex(c=>-1!=c.handlers.findIndex(x=>x.key===key));if(-1==found)return void console.error("Invalid accel handler");let elem1=_elems[found];elem1.handlers.shift(),elem1.handlers.length||_elems.splice(found,1);setListeners()}};function _keyDownHandler(ev){let code=ev.code;"NumpadEnter"===code&&(code="Enter");const keyAccel=`${ev.ctrlKey?"C":"_"}${ev.altKey?"A":"_"}${ev.shiftKey?"S":"_"}${ev.metaKey?"M":"_"}:${code}`;let el=_elems.find(x=>x.accel===keyAccel);if(!el||!el.handlers||!el.handlers.length)return;let handler=el.handlers[0];"focus"===handler.action?(ev.preventDefault(),ev.stopPropagation(),Vue.nextTick(()=>{"function"==typeof handler.elem.focus&&handler.elem.focus()})):"func"==handler.action&&(ev.preventDefault(),ev.stopPropagation(),Vue.nextTick(()=>{"function"==typeof handler.elem&&handler.elem()}))}function setListeners(){if(_elems.length>0){if(_listenerAdded)return;document.addEventListener("keydown",_keyDownHandler,!1),_listenerAdded=!0}else{if(!_listenerAdded)return;document.removeEventListener("keydown",_keyDownHandler,!1),_listenerAdded=!1}}},function(){const http=require("std:http"),urlTools=require("std:url"),eventBus=require("std:eventBus"),utils=require("std:utils");function _destroyElement(el){let fc=el.firstElementChild;if(!fc)return;let vue=fc.__vue__;vue&&!vue.$marker&&(vue=vue.$parent),vue&&vue.$marker()&&vue.$destroy(),el.__vue__=null}Vue.component("include",{template:'<div :class="implClass"></div>',props:{src:String,cssClass:String,needReload:Boolean,insideDialog:Boolean,done:Function},data:()=>({loading:!0,currentUrl:"",_needReload:!0}),methods:{loaded(ok){this.loading=!1,this.insideDialog&&eventBus.$emit("modalCreated",this),this.done&&this.done()},requery(){this.currentUrl&&(this.__destroy(),http.load(this.currentUrl,this.$el).then(this.loaded).catch(this.error))},__destroy(){_destroyElement(this.$el)},modalRequery(){this.insideDialog&&setTimeout(()=>{this.requery()},1)},error(msg){if(msg=msg||"",this.insideDialog&&eventBus.$emit("modalClose",!1),0===msg.indexOf("UI:")){let dlgData={promise:null,data:{message:msg.substring(3).replace("\\n","\n"),style:"alert"}};eventBus.$emit("confirm",dlgData)}else alert(msg)}},computed:{implClass(){return`include ${this.cssClass||""} ${this.loading?"loading":""}`}},mounted(){this.src&&(this.currentUrl=this.src,http.load(this.src,this.$el).then(this.loaded).catch(this.error))},destroyed(){this.__destroy()},watch:{src:function(newUrl,oldUrl){this.insideDialog||newUrl.split("?")[0]===oldUrl.split("?")[0]||urlTools.idChangedOnly(newUrl,oldUrl)||urlTools.idOrCopyChanged(newUrl,oldUrl)?this.currentUrl=newUrl:(this.loading=!0,this.currentUrl=newUrl,this.__destroy(),http.load(newUrl,this.$el).then(this.loaded).catch(this.error))},needReload(val){val&&this.requery()}}}),Vue.component("a2-include",{template:'<div class="a2-include"></div>',props:{source:String,arg:void 0,dat:void 0},data:()=>({needLoad:0}),methods:{__destroy(){_destroyElement(this.$el)},loaded(){},makeUrl(){let arg=this.arg||"0",url=urlTools.combine("_page",this.source,arg);return this.dat&&(url+=urlTools.makeQueryString(this.dat)),url},load(){let url=this.makeUrl();this.__destroy(),http.load(url,this.$el).then(this.loaded).catch(this.error)}},watch:{source(newVal,oldVal){utils.isEqual(newVal,oldVal)||(this.needLoad+=1)},arg(newVal,oldVal){utils.isEqual(newVal,oldVal)||(this.needLoad+=1)},dat(newVal,oldVal){utils.isEqual(newVal,oldVal)||(this.needLoad+=1)},needLoad(){this.load()}},mounted(){this.source&&(this.currentUrl=this.makeUrl(this.source),http.load(this.currentUrl,this.$el).then(this.loaded).catch(this.error))},destroyed(){this.__destroy()}})}(),function(){const utils=require("std:utils"),mask=require("std:mask"),maccel=require("std:accel"),control={props:{label:String,required:Boolean,align:{type:String,default:"left"},description:String,disabled:Boolean,tabIndex:Number,dataType:String,format:String,validatorOptions:Object,updateTrigger:String,mask:String,hideZeros:Boolean,testId:String,accel:String},computed:{path(){return this.item._path_?this.item._path_+"."+this.prop:this.prop},pathToValidate(){return this.itemToValidate._path_+"."+this.propToValidate},modelValue(){if(!this.item)return null;let val=this.item[this.prop];return this.dataType?utils.format(val,this.dataType,{hideZeros:this.hideZeros,format:this.format}):this.mask&&val?mask.getMasked(this.mask,val):val},modelValueRaw(){if(!this.item)return null;return this.item[this.prop]},errors(){if(!this.item)return null;let err,root=this.item._root_;return root&&root._validate_?(err=this.itemToValidate?root._validate_(this.itemToValidate,this.pathToValidate,this.itemToValidate[this.propToValidate],this.deferUpdate):root._validate_(this.item,this.path,this.modelValueRaw,this.deferUpdate),err):null},inputClass(){let cls="";return this.align&&"left"!==this.align&&(cls+="text-"+this.align),this.isNegative&&(cls+=" negative-red"),"input"===this.updateTrigger&&(cls+=" trigger-input"),cls},isNegative(){return!("Number"!==this.dataType&&"Currency"!==this.dataType||!this.item||!(this.modelValue<0))},hasLabel(){return!!this.label},hasDescr(){return!!this.description},maxLength(){if(this.item&&this.item.$maxLength)return this.item.$maxLength(this.prop)}},mounted(){this.$parent.$registerControl&&this.$parent.$registerControl(this),this.accel&&(this._accelKey=maccel.registerControl(this.accel,this.$refs.input,"focus")),this.mask&&mask.mountElement(this.$refs.input,this.mask)},beforeDestroy(){this.$parent.$unregisterControl&&this.$parent.$unregisterControl(this),this.accel&&maccel.unregisterControl(this._accelKey),this.mask&&mask.unmountElement(this.$refs.input,this.mask)},methods:{valid(){return!this.invalid()},invalid(out){let err=this.errors;return!!err&&(out&&(out.warn=err.every(r=>"warning"===r.severity),out.info=err.every(r=>"info"===r.severity),out.all=err.length),err.length>0)},pending(){return this.errors&&this.errors.pending>0},cssClass(){let out={},inv=this.invalid(out),cls="control-group"+(inv?" invalid":" valid");return inv&&out.warn?cls+=" val-warning":inv&&out.info&&(cls+=" val-info"),this.required&&(cls+=" required"),this.disabled&&(cls+=" disabled"),cls},deferUpdate(){this.$children.forEach(val=>val.$forceUpdate()),this.$forceUpdate()},test(){alert("from base control")}},watch:{mask(){mask.setMask(this.$refs.input,this.mask),this.updateValue&&this.updateValue(this.$refs.input.value)}}};app.components.control=control}(),Vue.component("validator",{props:{invalid:Function,errors:Array,options:Object},template:'<div v-if="invalid()" class="validator" :class="cssClass" :style="cssStyle"><span v-for="err in errors" v-text="err.msg" :class="err.severity"></span></div>',computed:{cssStyle(){let r={};return this.options&&this.options.width&&(r.width=this.options.width),r},cssClass(){let r={};return this.options?(this.options.placement&&(r[this.options.placement]=!0),this.options.width&&(r["with-width"]=!0),r):r}}}),Vue.component("a2-static-validator",{props:{item:{type:Object,default:()=>({})},prop:String},template:'<div v-if="invalid()" class="static-validator"><span v-for="err in errors" v-text="err.msg" :class="err.severity"></span></div>',computed:{path(){return this.item._path_+"."+this.prop},modelValue(){return this.item?this.item[this.prop]:null},errors(){if(!this.item)return null;let err,root=this.item._root_;return root&&root._validate_?(err=root._validate_(this.item,this.path,this.modelValue,this.deferUpdate),err):null}},methods:{invalid(out){let err=this.errors;return!!err&&err.length>0}}}),function(){const utils=require("std:utils"),mask=require("std:mask");let baseControl=component("control");const textbox={extends:baseControl,template:'<div :class="cssClass()" :test-id="testId">\n\t<label v-if="hasLabel"><span v-text="label"/><slot name="hint"/><slot name="link"></slot></label>\n\t<div class="input-group">\n\t\t<input v-if="password" type="text" class="fake-pwd-field" tabindex="-1"/>\n\t\t<input ref="input" :type="controlType" v-focus :autocomplete="autocompleteText"\n\t\t\tv-bind:value="modelValue" \n\t\t\t\tv-on:change="onChange($event.target.value)" \n\t\t\t\tv-on:input="onInput($event.target.value)"\n\t\t\t\tv-on:keypress="onKey($event)"\n\t\t\t\t:class="inputClass" :placeholder="placeholder" :disabled="disabled" :tabindex="tabIndex" :maxlength="maxLength" :spellcheck="spellCheck"/>\n\t\t<slot></slot>\n\t\t<a class="a2-hyperlink add-on a2-inline" tabindex="-1" href="" @click.stop.prevent="clear" v-if="clearVisible"><i class="ico ico-clear"></i></a>\n\t\t<validator :invalid="invalid" :errors="errors" :options="validatorOptions"></validator>\n\t</div>\n\t<slot name="popover"></slot>\n\t<span class="descr" v-if="hasDescr" v-text="description"></span>\n</div>\n',props:{item:{type:[Object,Array],default:()=>({})},prop:String,itemToValidate:Object,propToValidate:String,placeholder:String,password:Boolean,number:Boolean,spellCheck:{type:Boolean,default:void 0},enterCommand:Function,hasClear:Boolean},computed:{controlType(){return this.password?"password":"text"},autocompleteText(){return this.password?"new-password":"off"},clearVisible(){return!!this.hasClear&&!!this.item[this.prop]}},methods:{updateValue(value){this.mask?this.item[this.prop]=mask.getUnmasked(this.mask,value):this.item[this.prop]=utils.parse(value,this.dataType);let mv=this.modelValue;this.$refs.input.value!==mv&&(this.$refs.input.value=mv,this.$emit("change",this.item[this.prop]))},onInput(value){"input"===this.updateTrigger&&this.updateValue(value)},onChange(value){"input"!==this.updateTrigger&&this.updateValue(value)},onKey(event){this.number&&(event.charCode<48||event.charCode>57)&&45!==event.charCode&&(event.preventDefault(),event.stopPropagation()),"Enter"===event.code&&this.enterCommand&&this.enterCommand()},clear(){this.item[this.prop]=""}}};Vue.component("textbox",textbox),app.components.textbox=textbox;const textarea={extends:baseControl,template:'<div :class="cssClass()" :test-id="testId">\n\t<label v-if="hasLabel"><span v-text="label"/><slot name="hint"/><slot name="link"></slot></label>\n\t<div class="input-group">\n\t\t<textarea ref="input" v-focus v-auto-size="autoSize" v-bind:value="modelValue2" :style="areaStyle"\n\t\t\tv-on:change="onChange($event.target.value)" \n\t\t\tv-on:input="onInput($event.target.value)"\n\t\t\tv-on:keypress="onKey($event)"\n\t\t\t:rows="rows" :class="inputClass" :placeholder="placeholder" :disabled="disabled" :tabindex="tabIndex" :maxlength="maxLength" :spellcheck="spellCheck"/>\n\t\t<slot></slot>\n\t\t<validator :invalid="invalid" :errors="errors" :options="validatorOptions"></validator>\n\t</div>\n\t<slot name="popover"></slot>\n\t<span class="descr" v-if="hasDescr" v-text="description"></span>\n</div>\n',props:{item:{type:[Object,Array],default:()=>({})},prop:String,itemToValidate:Object,propToValidate:String,placeholder:String,autoSize:Boolean,rows:Number,spellCheck:{type:Boolean,default:void 0},enterCommand:Function,maxHeight:String},computed:{modelValue2(){return this.item?this.item[this.prop]:null},areaStyle(){if(this.maxHeight)return{"max-height":this.maxHeight}}},methods:{updateValue(value){this.item[this.prop]!==value&&(this.item[this.prop]=value,this.$emit("change",this.item[this.prop]))},onInput(value){"input"===this.updateTrigger&&this.updateValue(value)},onChange(value){"input"!==this.updateTrigger&&this.updateValue(value)},onKey(event){"Enter"===event.code&&event.ctrlKey&&this.enterCommand&&this.enterCommand()}},watch:{modelValue(){if(!this.autoSize)return;let inp=this.$refs.input;if(inp){var evt=document.createEvent("HTMLEvents");evt.initEvent("autosize",!1,!0),inp.dispatchEvent(evt)}}}},staticControl={extends:baseControl,template:'<div :class="cssClass()" :test-id="testId">\n\t<label v-if="hasLabel"><span v-text="label"/><slot name="hint"/><slot name="link"></slot></label>\n\t<div class="input-group static">\n\t\t<span v-focus v-text="textProp" :class="inputClass" :tabindex="tabIndex" class="static-input"/>\n\t\t<slot></slot>\n\t\t<validator :invalid="invalid" :errors="errors" :options="validatorOptions"></validator>\n\t</div>\n\t<slot name="popover"></slot>\n\t<span class="descr" v-if="hasDescr" v-text="description"></span>\n</div>\n',props:{item:{type:[Object,Array],default:()=>({})},prop:String,itemToValidate:Object,propToValidate:String,text:[String,Number,Date]},computed:{textProp(){return this.mask&&this.text?mask.getMasked(this.mask,this.text):this.text}}};Vue.component("textbox",textbox),app.components.textbox=textbox,Vue.component("a2-textarea",textarea),app.components[textarea],Vue.component("static",staticControl),app.components[staticControl]}(),function(){const utils=require("std:utils");let baseControl=component("control");Vue.component("combobox",{extends:baseControl,template:'<div :class="cssClass()" v-lazy="itemsSource" :test-id="testId">\n\t<label v-if="hasLabel"><span v-text="label"/><slot name="hint"/><slot name="link"></slot></label>\n\t<div class="input-group">\n\t\t<div class="select-wrapper" :disabled="disabled" >\n\t\t\t<div v-text="getWrapText()" class="select-text" ref="wrap" :class="wrapClass"/>\n\t\t\t<span class="caret"/>\n\t\t</div>\n\t\t<select v-focus v-model="cmbValue" :disabled="disabled" :tabindex="tabIndex" ref="sel" :title="getWrapText()">\n\t\t\t<slot>\n\t\t\t\t<option v-for="(cmb, cmbIndex) in itemsSource" :key="cmbIndex" \n\t\t\t\t\tv-text="getName(cmb, true)" :value="getValue(cmb)"></option>\n\t\t\t</slot>\n\t\t</select>\n\t\t<validator :invalid="invalid" :errors="errors" :options="validatorOptions"></validator>\n\t</div>\n\t<slot name="popover"></slot>\n\t<span class="descr" v-if="hasDescr" v-text="description"></span>\n</div>\n',props:{prop:String,item:{type:Object,default:()=>({})},itemsSource:{type:Array,default:()=>[]},itemToValidate:Object,propToValidate:String,nameProp:String,valueProp:String,showvalue:Boolean,align:String},computed:{cmbValue:{get(){return this.getComboValue()},set(value){this.item&&(this.item[this.prop]=value)}},wrapClass(){let cls="";return this.align&&"left"!==this.align&&(cls+="text-"+this.align),cls}},methods:{getName(itm,trim){return this.nameProp?utils.eval(itm,this.nameProp):itm.$name},getValue(itm){return this.valueProp?utils.eval(itm,this.valueProp):itm},getWrapText(){return this.showvalue?this.getComboValue():this.getText()},getComboValue(){let val=this.item?this.item[this.prop]:null;if(!utils.isObjectExact(val))return val;let vProp=this.valueProp||"$id";return vProp in val?-1!==this.itemsSource.indexOf(val)?val:this.itemsSource.find(x=>x[vProp]===val[vProp]):val},getText(){let cv=this.getComboValue();if(utils.isObjectExact(cv))return this.getName(cv);if(this.itemsSource&&this.itemsSource.length){let vProp=this.valueProp||"$id",ob=this.itemsSource.find(x=>x[vProp]===cv);return ob?this.getName(ob):""}return this.getOptionsText(cv)},getOptionsText(cv){let sel=this.$refs.sel;if(!sel)return"";let ops=sel.options;for(let i=0;i<ops.length;i++)if(""+ops[i].value==""+cv)return ops[i].text;let si=sel.selectedIndex;return si<0||si>=ops.length?"":ops[si].text}},mounted(){let t=this.getText();t&&(this.$refs.wrap.innerText=t)}})}(),function(){const utils=require("std:utils"),locale=window.$$locale;Vue.component("a2-calendar",{template:'\n<div @click.stop.prevent="dummy">\n\t<table class="calendar-pane">\n\t\t<thead><tr>\n\t\t\t\t<th class="h-btn"><a v-if="hasPrev" @click.stop.prevent="prevMonth"><i class="ico ico-triangle-left"></i></a></th>\n\t\t\t\t<th :colspan="isDayView ? 5 : 7" class="month-title"><span v-text="title"></span></th>\n\t\t\t\t<th class="h-btn"><a v-if="hasNext" @click.stop.prevent=\'nextMonth\'><i class="ico ico-triangle-right"></i></a></th>\n\t\t\t</tr>\n\t\t\t<tr class="weekdays" v-if="isDayView"><th v-for="d in 7" v-text="wdTitle(d)">ÐŸÐ½</th></tr>\n\t\t\t<tr class="weekdays" v-else><th colspan="9"></th></tr>\n\t\t</thead>\n\t\t<tbody v-if="isDayView">\n\t\t\t<tr v-for="row in days">\n\t\t\t\t<td v-for="day in row" :class="dayClass(day)"><a @click.stop.prevent="selectDay(day)" \n\t\t\t\t\t@mouseover="mouseOver(day)"\n\t\t\t\t\tv-text="day.getDate()" :title="dayTitle(day)"/></td>\n\t\t\t</tr>\n\t\t</tbody>\n\t\t<tbody v-else>\n\t\t\t<tr v-for="qr in monthes">\n\t\t\t\t<td v-for="m in qr" class="mcell" :class="monthClass(m.date)" colspan="3"><a @click.stop.prevent="selectDay(m.date)" v-text="m.name"/></td>\n\t\t\t</tr>\n\t\t</tbody>\n\t\t<tfoot v-if="showFooter" ><tr><td colspan="7" class="calendar-footer">\n\t\t\t<a class="today" @click.stop.prevent=\'today\' v-text=\'todayText\'></a></td></tr></tfoot>\n\t</table>\n</div>\n',props:{showToday:{type:Boolean,default:!0},pos:String,model:Date,setMonth:Function,setDay:Function,getDayClass:Function,hover:Function,view:String},computed:{isDayView(){return"day"===(this.view||"day")},showFooter(){return this.showToday&&this.isDayView},days(){let dt=new Date(this.model);dt.setHours(0,-dt.getTimezoneOffset(),0,0);dt.getDate();dt.setDate(1);let w=dt.getDay()-1;-1===w?w=6:0===w&&(w=7),dt.setDate(1-w);let arr=[];for(let r=0;r<6;r++){let row=[];for(let c=0;c<7;c++){let xd=new Date(dt);xd.setHours(0,-xd.getTimezoneOffset(),0,0),row.push(new Date(xd)),dt.setDate(dt.getDate()+1)}arr.push(row)}return arr},monthes(){let ma=[];for(let q=0;q<4;q++){let ia=[];for(let m=0;m<3;m++){let mno=3*q+m,dt=utils.date.create(this.model.getFullYear(),mno+1,1),mname=utils.text.capitalize(dt.toLocaleDateString(locale.$Locale,{month:"long"}));ia.push({date:dt,month:mno+1,name:mname})}ma.push(ia)}return ma},hasPrev(){return"right"!==this.pos},hasNext(){return"left"!==this.pos},title(){let mn=this.model.toLocaleString(locale.$Locale,{month:"long",year:"numeric"});return utils.text.capitalize(mn)},todayText:()=>locale.$Today,todayDate:()=>utils.date.today()},methods:{dummy(){},nextMonth(){let dt=new Date(this.model);this.isDayView?dt=utils.date.add(dt,1,"month"):dt.setFullYear(dt.getFullYear()+1),this.setMonth(dt,this.pos)},prevMonth(){let dt=new Date(this.model);this.isDayView?dt=utils.date.add(dt,-1,"month"):dt.setFullYear(dt.getFullYear()-1),this.setMonth(dt,this.pos)},wdTitle(d){return this.days[0][d-1].toLocaleString(locale.$Locale,{weekday:"short"})},today(){this.setDay(this.todayDate)},selectDay(d){this.setDay(d,this.pos)},dayClass(day){let cls="";if(day.getMonth()!==this.model.getMonth()&&(cls+=" other"),this.getDayClass)return cls+=this.getDayClass(day),cls;let tls=utils.date;return tls.equal(day,this.todayDate)&&(cls+=" today"),tls.equal(day,this.model)&&(cls+=" active"),cls},monthClass(day){let cls="";return day.getFullYear()===this.model.getFullYear()&&day.getMonth()===this.model.getMonth()&&(cls+=" active"),cls},dayTitle:day=>day.toLocaleString(locale.$Locale,{year:"numeric",month:"long",day:"numeric",weekday:"long"}),mouseOver(day){this.hover&&this.hover(day)}}})}(),function(){const popup=require("std:popup"),utils=require("std:utils"),eventBus=require("std:eventBus"),baseControl=component("control"),locale=window.$$locale;Vue.component("a2-date-picker",{extends:baseControl,template:'\n<div :class="cssClass2()" class="date-picker" :test-id="testId">\n\t<label v-if="hasLabel"><span v-text="label"/><slot name="hint"/><slot name="link"></slot></label>\n\t<div class="input-group"  @click="clickInput($event)">\n\t\t<input v-focus v-model.lazy="model" :class="inputClass" :disabled="inputDisabled"/>\n\t\t<a href @click.stop.prevent="toggle($event)" tabindex="-1"><i class="ico ico-calendar"></i></a>\n\t\t<validator :invalid="invalid" :errors="errors" :options="validatorOptions"></validator>\n\t\t<div class="calendar" v-if="isOpen">\t\t\n\t\t\t<a2-calendar :model="modelDate" :view="view"\n\t\t\t\t:set-month="setMonth" :set-day="selectDay" :get-day-class="dayClass"/>\n\t\t</div>\n\t</div>\n\t<span class="descr" v-if="hasDescr" v-text="description"></span>\n</div>\n',props:{item:Object,prop:String,itemToValidate:Object,propToValidate:String,align:{type:String,default:"center"},view:String,yearCutOff:String},data:()=>({isOpen:!1}),methods:{toggle(ev){this.disabled||(this.isOpen||(eventBus.$emit("closeAllPopups"),utils.date.isZero(this.modelDate)&&(this.item[this.prop]=utils.date.today())),this.isOpen=!this.isOpen)},clickInput(ev){"month"===this.view&&(this.toggle(ev),ev.stopPropagation(),ev.preventDefault())},setMonth(dt){this.setDate(dt)},selectDay(day){var dt=new Date(Date.UTC(day.getFullYear(),day.getMonth(),day.getDate(),0,0,0,0));this.setDate(dt),this.isOpen=!1},setDate(d){let md=this.modelDate,nd=new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),md.getUTCHours(),md.getUTCMinutes(),0,0));this.item[this.prop]=nd},dayClass(day){let cls="",tls=utils.date;return tls.equal(day,tls.today())&&(cls+=" today"),tls.equal(day,this.modelDate)&&(cls+=" active"),day.getMonth()!==this.modelDate.getMonth()&&(cls+=" other"),cls},cssClass2(){let cx=this.cssClass();return this.isOpen&&(cx+=" open"),cx},__clickOutside(){this.isOpen=!1}},computed:{modelDate(){return this.item[this.prop]},inputDisabled(){return this.disabled||"month"===this.view},model:{get(){return utils.date.isZero(this.modelDate)?"":"month"===this.view?utils.text.capitalize(this.modelDate.toLocaleString(locale.$Locale,{timeZone:"UTC",year:"numeric",month:"long"})):this.modelDate.toLocaleString(locale.$Locale,{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"})},set(str){let md=utils.date.parse(str,this.yearCutOff);utils.date.isZero(md)?(this.item[this.prop]=md,this.isOpen=!1):this.setDate(md)}}},mounted(){popup.registerPopup(this.$el),this.$el._close=this.__clickOutside},beforeDestroy(){popup.unregisterPopup(this.$el)}})}(),function(){const popup=require("std:popup"),utils=require("std:utils"),eventBus=require("std:eventBus"),baseControl=component("control"),locale=window.$$locale,timesheet={props:{model:Date,setHour:Function,setMinute:Function,getHourClass:Function,getMinuteClass:Function},template:'\n<div @click.stop.prevent="dummy" class="time-picker-pane calendar-pane">\n<table class="table-hours">\n<thead><tr><th colspan="6" v-text="locale.$Hours">Ð“Ð¾Ð´Ð¸Ð½Ð¸</th></tr></thead>\n<tbody>\n\t<tr v-for="row in hours">\n\t\t<td v-for="h in row" :class="getHourClass(h)"><a @click.stop.prevent="clickHours(h)" v-text="h"/></td>\n\t</tr>\t\n</tbody></table>\n<div class="divider"/>\n<table class="table-minutes">\n<thead><tr><th colspan="3" v-text="locale.$Minutes">Ð¥Ð²Ð¸Ð»Ð¸Ð½Ð¸</th></tr></thead>\n<tbody>\n\t<tr v-for="row in minutes">\n\t\t<td v-for="m in row" :class="getMinuteClass(m)"><a @click.stop.prevent="clickMinutes(m)" v-text="m"/></td>\n\t</tr>\t\n</tbody></table>\n</div>\n',methods:{clickHours(h){this.setHour&&this.setHour(+h)},clickMinutes(m){this.setMinute&&this.setMinute(m)},dummy(){}},computed:{locale:()=>locale,hours(){let a=[];for(let y=0;y<4;y++){let r=[];a.push(r);for(let x=0;x<6;x++){var v=6*y+x;v<10&&(v="0"+v),r.push(v)}}return a},minutes(){let a=[];for(let y=0;y<4;y++){let r=[];a.push(r);for(let x=0;x<3;x++){var v=5*(3*y+x);v<10&&(v="0"+v),r.push(v)}}return a}}};Vue.component("a2-time-picker",{extends:baseControl,template:'\n<div :class="cssClass2()" class="date-picker">\n\t<label v-if="hasLabel"><span v-text="label"/><slot name="hint"/><slot name="link"></slot></label>\n\t<div class="input-group">\n\t\t<input v-focus v-model.lazy="model" :class="inputClass" :disabled="inputDisabled"/>\n\t\t<a href @click.stop.prevent="toggle($event)"><i class="ico ico-waiting-outline"></i></a>\n\t\t<validator :invalid="invalid" :errors="errors" :options="validatorOptions"></validator>\n\t\t<div class="calendar" v-if="isOpen">\n\t\t\t<a2-time-sheet :model="modelDate" :set-hour="setHour" :set-minute="setMinute" :get-hour-class="hourClass" :get-minute-class="minuteClass"/>\n\t\t</div>\n\t</div>\n\t<span class="descr" v-if="hasDescr" v-text="description"></span>\n</div>\n',components:{"a2-time-sheet":timesheet},props:{item:Object,prop:String,itemToValidate:Object,propToValidate:String,align:{type:String,default:"center"}},data:()=>({isOpen:!1}),methods:{toggle(ev){this.disabled||(this.isOpen||(eventBus.$emit("closeAllPopups"),utils.date.isZero(this.modelDate)&&(this.item[this.prop]=utils.date.today())),this.isOpen=!this.isOpen)},setHour(h){let nd=new Date(this.modelDate);nd.setUTCHours(h),this.item[this.prop]=nd},setMinute(m){let md=new Date(this.modelDate);md.setMinutes(m),this.item[this.prop]=md,this.isOpen=!1},hourClass(h){let cls="";return this.modelDate.getUTCHours()===+h&&(cls+=" active"),cls},minuteClass(m){return this.modelDate.getUTCMinutes()===+m?"active":void 0},cssClass2(){let cx=this.cssClass();return this.isOpen&&(cx+=" open"),cx},__clickOutside(){this.isOpen=!1}},computed:{modelDate(){return this.item[this.prop]},inputDisabled(){return this.disabled},model:{get(){let md=this.modelDate;return utils.date.isZero(md)?"":md.toLocaleTimeString(locale.$Locale,{timeZone:"UTC",hour:"2-digit",minute:"2-digit"})},set(str){let md=new Date(this.modelDate);if(str){utils.date.isZero(md)&&(md=utils.date.today());let time=utils.date.parseTime(str);md.setUTCHours(time.getHours(),time.getMinutes())}else md.setUTCHours(0,0);this.item[this.prop]=md,this.isOpen=!1}}},mounted(){popup.registerPopup(this.$el),this.$el._close=this.__clickOutside},beforeDestroy(){popup.unregisterPopup(this.$el)}})}(),function(){const popup=require("std:popup"),utils=require("std:utils"),eventBus=require("std:eventBus"),uPeriod=require("std:period"),baseControl=component("control");window.$$locale;Vue.component("a2-period-picker",{extends:baseControl,template:'\n<div class="control-group period-picker" @click.stop.prevent="toggle($event)" :class="{open: isOpen}">\n\t<label v-if="hasLabel"><span v-text="label"/><slot name="hint"/></label>\n\t<div class="input-group">\n\t\t<span class="period-text" v-text="text" :class="inputClass" :tabindex="tabIndex"/>\n\t\t<span class="caret"/>\n\t\t<div class="calendar period-pane" v-if="isOpen" @click.stop.prevent="dummy">\n\t\t\t<ul class="period-menu" style="grid-area: 1 / 1 / span 2 / auto">\n\t\t\t\t<li v-for=\'(mi, ix) in menu\' :key="ix" :class="{active: isSelectedMenu(mi.key)}"><a v-text=\'mi.name\' @click.stop.prevent="selectMenu(mi.key)"></a></li>\n\t\t\t</ul>\n\t\t\t<a2-calendar style="grid-area: 1 / 2" :show-today="false" pos="left" :model="prevModelDate" \n\t\t\t\t:set-month="setMonth" :set-day="setDay" :get-day-class="dayClass" :hover="mouseHover"/>\n\t\t\t<a2-calendar style="grid-area: 1 / 3; margin-left:6px":show-today="false" pos="right" :model="modelDate" \n\t\t\t\t:set-month="setMonth" :set-day="setDay" :get-day-class="dayClass" :hover="mouseHover"/>\n\t\t\t<div class="period-footer" style="grid-area: 2 / 2 / auto / span 2">\n\t\t\t\t<span class="current-period" v-text="currentText" :class="{processing: selection}"/>\n\t\t\t\t<span class="aligner"></span>\n\t\t\t\t<button class="btn btn-primary" @click.stop.prevent="apply" v-text="locale.$Apply" :disabled="applyDisabled"/>\n\t\t\t\t<button class="btn btn-default" @click.stop.prevent="close" v-text="locale.$Cancel" />\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<span class="descr" v-if="hasDescr" v-text="description"></span>\n</div>\n',props:{item:Object,prop:String,showAll:{type:Boolean,default:!0},display:String,callback:Function},data:()=>({isOpen:!1,selection:"",modelDate:utils.date.today(),currentPeriod:uPeriod.zero(),selectEnd:utils.date.zero(),timerId:null}),computed:{locale:()=>window.$$locale,text(){return"name"===this.display?this.period.text():"namedate"===this.display?this.period.isAllData()?this.period.text(!0):`${this.period.text(!0)} [${this.period.format("Date")}]`:this.period.format("Date")},period(){if(!this.item)return this.currentPeriod;let period=this.item[this.prop];return uPeriod.isPeriod(period)||console.error("PeriodPicker. Value is not a Period"),period},prevModelDate(){return utils.date.add(this.modelDate,-1,"month")},currentText(){return this.currentPeriod.format("Date")},applyDisabled(){return"start"===this.selection},menu(){return uPeriod.predefined(this.showAll)}},methods:{dummy(){},setMonth(d,pos){this.modelDate="left"===pos?utils.date.add(d,1,"month"):d},setDay(d){this.selection?"start"===this.selection&&(this.currentPeriod.To=d,this.currentPeriod.normalize(),this.selection=""):(this.selection="start",this.currentPeriod.From=d,this.currentPeriod.To=utils.date.zero(),this.selectEnd=utils.date.zero())},dayClass(day){let cls="",px=this.currentPeriod;return this.selection&&(px=uPeriod.create("custom",this.currentPeriod.From,this.selectEnd)),px.in(day)&&(cls+=" active"),px.From.getTime()===day.getTime()&&(cls+=" period-start"),px.To.getTime()===day.getTime()&&(cls+=" period-end"),cls},close(){this.isOpen=!1},apply(){this.period.equal(this.currentPeriod)||(this.period.assign(this.currentPeriod),this.fireEvent()),this.isOpen=!1},fireEvent(){this.callback&&this.callback(this.period);let root=this.item.$root;if(!root)return;let eventName=this.item._path_+"."+this.prop+".change";root.$emit(eventName,this.item,this.period,null)},toggle(ev){this.isOpen||(eventBus.$emit("closeAllPopups"),this.modelDate=this.period.To,(this.modelDate.isZero()||this.modelDate.getTime()===utils.date.maxDate.getTime())&&(this.modelDate=utils.date.today()),this.currentPeriod.assign(this.period),this.selection="",this.selectEnd=utils.date.zero()),this.isOpen=!this.isOpen},__clickOutside(){this.isOpen=!1},isSelectedMenu(key){return uPeriod.create(key).equal(this.currentPeriod)},selectMenu(key){let p=uPeriod.create(key);this.currentPeriod.assign(p),this.apply()},mouseHover(day){this.selection&&this.selectEnd.getTime()!==day.getTime()&&(clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.selectEnd=day},150))}},mounted(){popup.registerPopup(this.$el),this.$el._close=this.__clickOutside},beforeDestroy(){popup.unregisterPopup(this.$el)}})}(),function(){const popup=require("std:popup"),utils=require("std:utils"),platform=require("std:platform"),locale=window.$$locale,eventBus=require("std:eventBus"),baseControl=component("control");Vue.component("a2-selector",{extends:baseControl,template:'\n<div :class="cssClass2()"  :test-id="testId">\n\t<label v-if="hasLabel"><span v-text="label"/><slot name="hint"/><slot name="link"></slot></label>\n\t<div class="input-group">\n\t\t<div v-if="isCombo" class="selector-combo" @click.stop.prevent="open"><span tabindex="-1" class="select-text" v-text="valueText" @keydown="keyDown" ref="xcombo"/></div>\n\t\t<input v-focus v-model="query" :class="inputClass" :placeholder="placeholder" v-else\n\t\t\t@input="debouncedUpdate" @blur.stop="blur" @keydown="keyDown" @keyup="keyUp" ref="input" \n\t\t\t:disabled="disabled" @click="clickInput($event)"/>\n\t\t<slot></slot>\n\t\t<a class="selector-open" href="" @click.stop.prevent="open" v-if="caret"><span class="caret"></span></a>\n\t\t<a class="selector-clear" href="" @click.stop.prevent="clear" v-if="clearVisible">&#x2715</a>\n\t\t<validator :invalid="invalid" :errors="errors" :options="validatorOptions"></validator>\n\t\t<div class="selector-pane" v-if="isOpen" ref="pane" :class="paneClass">\n\t\t\t<div class="selector-body" :style="bodyStyle">\n\t\t\t\t<slot name="pane" :items="items" :is-item-active="isItemActive" :item-name="itemName" :hit="hit" :slotStyle="slotStyle">\n\t\t\t\t\t<ul class="selector-ul">\n\t\t\t\t\t\t<li @mousedown.prevent="hit(itm)" :class="{active: isItemActive(itmIndex)}"\n\t\t\t\t\t\t\tv-for="(itm, itmIndex) in items" :key="itmIndex" v-text="itemName(itm)">}</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</slot>\n\t\t\t</div>\n\t\t\t<a v-if=\'canNew\' class="create-elem a2-hyperlink a2-inline" @mousedown.stop.prevent="doNew()"><i class="ico ico-plus"/> <span v-text="newText"></span></a>\n\t\t</div>\n\t\t<div class="selector-pane" v-if="isOpenNew" @click.stop.prevent="dummy">\n\t\t\t<slot name="new-pane"></slot>\n\t\t</div>\n\t</div>\n\t<slot name="popover"></slot>\n\t<span class="descr" v-if="hasDescr" v-text="description"></span>\n</div>\n',props:{item:Object,prop:String,itemsSource:Array,textItem:Object,textProp:String,display:String,itemToValidate:Object,propToValidate:String,placeholder:String,delay:Number,minChars:Number,fetch:Function,hitfunc:Function,listWidth:String,listHeight:String,createNew:Function,placement:String,caret:Boolean,hasClear:Boolean,mode:String},data:()=>({isOpen:!1,isOpenNew:!1,loading:!1,items:[],query:"",filter:"",current:-1}),computed:{valueText(){if(!this.item)return"";if(this.hasText){if(this.item[this.prop].$isEmpty)return this.textItem[this.textProp]}let el=this.item[this.prop];return utils.isNumber(el)&&this.itemsSource&&(el=this.itemsSource.find(x=>x.$id===el),!el)?"":utils.simpleEval(el,this.display)},canNew(){return!!this.createNew},clearVisible(){if(!this.hasClear)return!1;let to=this.item[this.prop];return to&&utils.isDefined(to)&&!to.$isEmpty},hasText(){return!!this.textProp},newText(){return`${locale.$CreateLC} "${this.query}"`},pane(){return{items:this.items,isItemActive:this.isItemActive,itemName:this.itemName,hit:this.hit}},paneClass(){if(this.placement)return"panel-"+this.placement},bodyStyle(){let s={};return this.listWidth&&(s.minWidth=this.listWidth),this.listHeight&&(s.maxHeight=this.listHeight),s},slotStyle(){let r={};return this.listWidth&&(r.width=this.listWidth,r.minWidth=this.listWidth),this.listHeight&&(r.maxHeight=this.maxHeight),r},debouncedUpdate(){let delay=this.delay||300;return utils.debounce(()=>{this.current=-1,this.filter=this.query,this.update()},delay)},isCombo(){return"combo-box"===this.mode||"hyperlink"===this.mode}},watch:{valueText(newVal){if(this.hasText){this.item[this.prop].$isEmpty||(this.textItem[this.textProp]="")}this.query=this.valueText}},methods:{dummy(){},__clickOutside(){this.isOpen=!1,this.isOpenNew=!1},cssClass2(){let cx=this.cssClass();return(this.isOpen||this.isOpenNew)&&(cx+=" open"),"hyperlink"===this.mode?cx+=" selector-hyperlink":"combo-box"===this.mode&&(cx+=" selector-combobox"),cx},isItemActive(ix){return ix===this.current},itemName(itm){return utils.simpleEval(itm,this.display)},blur(){let text=this.query;if(this.hasText&&text!==this.valueText){let to=this.item[this.prop];to&&to.$empty&&to.$empty(),this.textItem[this.textProp]=text}this.cancel()},open(){if(!this.isOpen)if(eventBus.$emit("closeAllPopups"),-1!=this.current&&this.$nextTick(()=>this.scrollIntoView()),this.doFetch(this.valueText,!0),this.isCombo){let combo=this.$refs.xcombo;combo&&combo.focus()}else{let input=this.$refs.input;input&&input.focus()}this.isOpen=!this.isOpen},cancel(){this.query=this.valueText,this.isOpen=!1},keyUp(event){this.isOpen&&27===event.which?(event.preventDefault(),event.stopPropagation(),this.cancel()):13===event.which&&this.hasText&&this.blur()},clickInput(event){this.caret&&!this.isOpen&&(event.stopPropagation(),event.preventDefault(),this.open())},keyDown(event){if(this.isOpen)switch(event.stopPropagation(),event.which){case 27:event.preventDefault();break;case 13:if(-1===this.current)return;this.hit(this.items[this.current]);break;case 40:event.preventDefault(),this.current+=1,this.current>=this.items.length&&(this.current=0),this.query=this.itemName(this.items[this.current]),this.scrollIntoView();break;case 38:event.preventDefault(),this.current-=1,this.current<0&&(this.current=this.items.length-1),this.query=this.itemName(this.items[this.current]),this.scrollIntoView();break;case 115:this.cancel();break;default:return}else 115===event.which&&this.open()},hit(itm){let obj=this.item[this.prop];this.query=this.valueText,this.isOpen=!1,this.isOpenNew=!1,this.current=this.items.indexOf(itm),this.$nextTick(()=>{this.hitfunc?this.hitfunc.call(this.item.$root,itm):obj&&obj.$merge?obj.$merge(itm,!0):utils.isNumber(obj)?this.item[this.prop]=itm.$id:platform.set(this.item,this.prop,itm)})},clear(){this.query="",this.isOpen=!1,this.isOpenNew=!1;let obj=this.item[this.prop];obj.$empty&&obj.$empty()},scrollIntoView(){this.$nextTick(()=>{let pane=this.$refs.pane;if(!pane)return;let elem=pane.querySelector(".active");elem&&elem.scrollIntoView(!1)})},update(){let text=this.query||"",chars=+(this.minChars||0);chars&&text.length<chars||(this.isOpen=!0,this.isOpenNew=!1,""!==text?this.doFetch(text,!1):this.clear())},doFetch(text,all){if(this.itemsSource){this.items.length||(this.items=this.itemsSource);let fi=-1,el=this.item[this.prop];return fi=utils.isNumber(el)?this.items.findIndex(x=>x.Id===el):this.items.indexOf(el),void(-1!==fi&&(this.current=fi,setTimeout(()=>this.scrollIntoView(),10)))}this.loading=!0;let fData=this.fetchData(text,all);fData.then?fData.then(result=>{this.loading=!1;let prop=Object.keys(result)[0];this.items=result[prop]}).catch(()=>{this.items=[]}):utils.isArray(fData)&&this.items!=fData&&(this.items.length!=fData.length&&(this.current=-1),this.items=fData)},fetchData(text,all){this.fetch||console.error("Selector. Fetch not defined"),all=all||!1;let elem=this.item[this.prop];return elem&&!("$vm"in elem)&&(elem.$vm=this.$root),this.fetch.call(this.item.$root,elem,text,all)},doNew(){if(this.isOpen=!1,this.createNew){let arg={elem:this.item[this.prop],text:this.query};this.createNew(arg)}}},mounted(){popup.registerPopup(this.$el),this.query=this.valueText,this.$el._close=this.__clickOutside},beforeDestroy(){popup.unregisterPopup(this.$el)}})}(),function(){const utils=require("std:utils"),log=require("std:log"),eventBus=require("std:eventBus"),locale=window.$$locale,eqlower=utils.text.equalNoCase,dataGridColumn={name:"data-grid-column",template:'\n<th :class="cssClass" @click.prevent="doSort">\n\t<div class="h-fill" v-if="fixedHeader" v-text="headerText">\n\t</div><div class="h-holder">\n\t\t<slot>{{headerText}}</slot>\n\t</div>\n</th>\n',props:{header:String,content:String,dataType:String,hideZeros:Boolean,format:String,icon:String,bindIcon:String,id:String,align:{type:String,default:"left"},editable:{type:Boolean,default:!1},noPadding:{type:Boolean,default:!1},validate:String,sort:{type:Boolean,default:void 0},sortProp:String,small:{type:Boolean,default:void 0},bold:String,mark:String,controlType:String,width:String,fit:Boolean,wrap:String,command:Object},created(){this.$parent.$addColumn(this)},destroyed(){this.$parent.$removeColumn(this)},computed:{sortProperty(){return this.sortProp||this.content},dir(){return this.$parent.sortDir(this.sortProperty)},fixedHeader(){return this.$parent.fixedHeader},isSortable(){return!!this.sortProperty&&(void 0===this.sort?this.$parent.isGridSortable:this.sort)},isUpdateUrl(){return!this.$root.inDialog},template(){return this.id?this.$parent.$scopedSlots[this.id]:null},classAlign(){return"left"!==this.align?(" text-"+this.align).toLowerCase():""},cssClass(){let cssClass=this.classAlign;return this.isSortable&&(cssClass+=" sort",this.dir&&(cssClass+=" "+this.dir)),cssClass},headerText(){return this.header||"Â "},evalOpts(){return{hideZeros:this.hideZeros,format:this.format}}},methods:{doSort(){this.isSortable&&this.$parent.doSort(this.sortProperty)},cellCssClass(row,editable){let cssClass=this.classAlign;if(this.mark){let mark=utils.simpleEval(row,this.mark);mark&&(cssClass+=" "+mark)}return editable&&"checkbox"!==this.controlType&&(cssClass+=" cell-editable"),this.wrap&&(cssClass+=" "+this.wrap),this.small&&(cssClass+=" small"),function(bind,cls){if(bind)if("true"===bind)cssClass+=cls;else if(bind.startsWith("{")){var prop=bind.substring(1,bind.length-1);utils.simpleEval(row,prop)&&(cssClass+=cls)}}(this.bold," bold"),cssClass.trim()}}};Vue.component("data-grid-column",dataGridColumn);const dataGridRow={name:"data-grid-row",template:'\n<tr @click="rowSelect(row)" :class="rowClass()" v-on:dblclick.prevent="doDblClick" ref="tr" @mousedown="mouseDown(row)">\n\t<td v-if="isMarkCell" class="marker">\n\t\t<div :class="markClass"></div>\n\t</td>\n\t<td v-if="detailsMarker" class="details-marker" @click.prevent="toggleDetails">\n\t\t<i v-if="detailsIcon" class="ico" :class="detailsExpandClass" />\n\t</td>\n\t<data-grid-cell v-for="(col, colIndex) in cols" :key="colIndex" :row="row" :col="col" :index="index" />\n</tr>',components:{"data-grid-cell":{functional:!0,name:"data-grid-cell",props:{row:Object,col:Object,index:Number},render(h,ctx){let row=ctx.props.row,col=ctx.props.col,ix=ctx.props.index,cellProps={class:col.cellCssClass(row,col.editable||col.noPadding)},childProps={props:{row,col}};if(col.template){return h("td",cellProps,[col.template(childProps.props)])}if("validator"===col.controlType){let cellValid={props:["item","col"],template:'<span><i v-if="item.$invalid" class="ico ico-error"></i></span>'};return cellProps.class={"cell-validator":!0},h("td",cellProps,[h(cellValid,{props:{item:row,col}})])}if(!col.content&&!col.icon&&!col.bindIcon)return h("td",cellProps);let validator={props:["path","item"],template:'<validator :path="path" :item="item"></validator>'},validatorProps={props:{path:col.validate,item:row}};function normalizeArg(arg,doEval){if(utils.isBoolean(arg)||utils.isNumber(arg)||utils.isObjectExact(arg))return arg;if("this"===(arg=arg||""))arg=row;else if(arg.startsWith("{"))if(-1!==(arg=arg.substring(1,arg.length-1)).indexOf("."))arg=utils.eval(row,arg);else{if(!(arg in row))throw new Error(`Property '${arg}' not found in ${row.constructor.name} object`);arg=row[arg]}else arg&&doEval&&(arg=utils.eval(row,arg,col.dataType,col.evalOpts));return arg}if(col.command){let arg1=normalizeArg(col.command.arg1,!1),arg2=normalizeArg(col.command.arg2,col.command.eval),arg3=normalizeArg(col.command.arg3,!1),arg4=col.command.arg4;return h("td",cellProps,[h({props:["row","col"],template:'<a @click.prevent="doCommand($event)" :href="getHref()"><i v-if="hasIcon" :class="iconClass" class="ico"></i><span v-text="eval(row, col.content, col.dataType, col.evalOpts)"></span></a>',computed:{hasIcon:()=>col.icon||col.bindIcon,iconClass(){let icoSingle=col.content?"":" ico-single";return col.bindIcon?"ico-"+utils.eval(row,col.bindIcon)+icoSingle:col.icon?"ico-"+col.icon+icoSingle:null}},methods:{doCommand(ev){col.command.cmd(arg1,arg2,arg3,arg4)},eval:utils.eval,getHref(){if(!col.command)return null;if(col.command.isDialog)return"";if(-1!==col.command.cmd.name.indexOf("$exec"))return"";let id=arg2;return utils.isObjectExact(arg2)&&(id=arg2.$id),arg1+"/"+id}}},childProps)])}if("$index"===col.content)return h("td",cellProps,[ix+1]);let content=utils.eval(row,col.content,col.dataType,col.evalOpts),chElems=[h("span",{class:{"dg-cell":!0,"negative-red":function(col){if("Number"===col.dataType||"Currency"===col.dataType){if(utils.eval(row,col.content,col.dataType,col.evalOpts,!0)<0)return!0}return!1}(col)}},content)],icoSingle=col.content?"":" ico-single";return col.icon?chElems.unshift(h("i",{class:"ico ico-"+col.icon+icoSingle})):col.bindIcon&&chElems.unshift(h("i",{class:"ico ico-"+utils.eval(row,col.bindIcon)+icoSingle})),col.validate&&chElems.push(h(validator,validatorProps)),h("td",cellProps,chElems)}}},props:{row:Object,cols:Array,index:Number,mark:String,group:Boolean,level:Number,isItemActive:Function,hitItem:Function},computed:{isMarkCell(){return this.$parent.isMarkCell},detailsMarker(){return this.$parent.isRowDetailsCell},detailsIcon(){if(!this.detailsMarker)return!1;let prdv=this.$parent.rowDetailsVisible;return!1===prdv||prdv&&this.row[prdv]},detailsExpandClass(){return this.row._uiprops_.$details?"ico-minus-circle":"ico-plus-circle"},totalColumns(){console.error("implement me")},markClass(){return this.mark?utils.simpleEval(this.row,this.mark):""}},methods:{rowClass(){let cssClass="dg-row";return(this.isItemActive?this.isItemActive(this.index):!!this.row.$selected)&&(cssClass+=" active"),this.$parent.isMarkRow&&this.mark&&(cssClass+=" "+utils.simpleEval(this.row,this.mark)),(this.index+1)%2&&(cssClass+=" even"),this.$parent.rowBold&&this.row[this.$parent.rowBold]&&(cssClass+=" bold"),this.level&&(cssClass+=" lev-"+this.level),cssClass.trim()},rowSelect(row){row.$select&&row.$select()},mouseDown(row){this.hitItem&&this.hitItem(row)},doDblClick($event){$event.stopImmediatePropagation(),this.$parent.doubleclick&&(window.getSelection().removeAllRanges(),this.$parent.doubleclick())},toggleDetails($event){this.detailsIcon&&Vue.set(this.row._uiprops_,"$details",!this.row._uiprops_.$details)}}},dataGridRowDetails={name:"data-grid-row-details",template:'\n<tr v-if="visible()" class="row-details">\n\t<td v-if="isMarkCell" class="marker">\n\t\t<div :class="markClass"></div>\n\t</td>\n\t<td :colspan=\'totalCols\' class="details-cell">\n\t\t<div class="details-wrapper"><slot></slot></div>\n\t</td>\n</tr>\n',props:{cols:Number,row:Object,mark:String},computed:{isMarkCell(){return this.$parent.isMarkCell},markClass(){return this.mark?utils.simpleEval(this.row,this.mark):""},detailsMarker(){return this.$parent.isRowDetailsCell},totalCols(){return this.cols+(this.isMarkCell?1:0)+(this.detailsMarker?1:0)}},methods:{visible(){return!!this.$parent.isRowDetailsAlways||(this.$parent.isRowDetailsCell?!!this.row._uiprops_.$details:this.row===this.$parent.selected())}}};Vue.component("data-grid",{props:{"items-source":[Object,Array],border:Boolean,grid:String,fixedHeader:Boolean,hideHeader:Boolean,hover:{type:Boolean,default:void 0},striped:{type:Boolean,default:void 0},compact:Boolean,sort:Boolean,routeQuery:Object,mark:String,filterFields:String,markStyle:String,rowBold:String,doubleclick:Function,groupBy:[Array,Object,String],rowDetails:Boolean,rowDetailsActivate:String,rowDetailsVisible:[String,Boolean],isItemActive:Function,hitItem:Function,emptyPanelCallback:Function,testId:String,autoSelect:String},template:'\n<div v-lazy="itemsSource" :class="{\'data-grid-container\':true, \'fixed-header\': fixedHeader, \'bordered\': border}" :test-id="testId">\n\t<div class="data-grid-header-border" v-if="fixedHeader" />\n\t<div :class="{\'data-grid-body\': true, \'fixed-header\': fixedHeader}">\n\t<div class="data-grid-empty" v-if="$isEmpty">\n\t\t<slot name="empty" />\n\t</div>\n\t<table :class="cssClass">\n\t\t<colgroup>\n\t\t\t<col v-if="isMarkCell" class="fit"/>\n\t\t\t<col v-if="isRowDetailsCell" class="fit" />\n\t\t\t<col v-bind:class="columnClass(col)" v-bind:style="columnStyle(col)" v-for="(col, colIndex) in columns" :key="colIndex"></col>\n\t\t</colgroup>\n\t\t<thead>\n\t\t\t<tr v-show="isHeaderVisible">\n\t\t\t\t<th v-if="isMarkCell" class="marker"><div v-if="fixedHeader" class="h-holder">&#160;</div></th>\n\t\t\t\t<th v-if="isRowDetailsCell" class="details-marker"><div v-if="fixedHeader" class="h-holder">&#160;</div></th>\n\t\t\t\t<slot></slot>\n\t\t\t</tr>\n\t\t</thead>\n\t\t<template v-if="isGrouping">\n\t\t\t<tbody>\n\t\t\t\t<template v-for="(g, gIndex) of $groups">\n\t\t\t\t\t<tr v-if="isGroupGroupVisible(g)" :class="\'group lev-\' + g.level" :key="gIndex">\n\t\t\t\t\t\t<td @click.prevent=\'toggleGroup(g)\' :colspan="groupColumns">\n\t\t\t\t\t\t<span :class="{expmark: true, expanded: g.expanded}" />\n\t\t\t\t\t\t<span class="grtitle" v-text="groupTitle(g)" />\n\t\t\t\t\t\t<span v-if="isGroupCountVisible(g)" class="grcount" v-text="g.count" /></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<template v-for="(row, rowIndex) in g.items">\n\t\t\t\t\t\t<data-grid-row v-show="isGroupBodyVisible(g)" :group="true" :level="g.level" :cols="columns" :row="row" :key="gIndex + \':\' + rowIndex" :index="rowIndex" :mark="mark" ref="row" />\n\t\t\t\t\t\t<data-grid-row-details v-if="rowDetails" v-show="isGroupBodyVisible(g)" :cols="columns.length" :row="row" :key="\'rd:\' + gIndex + \':\' + rowIndex" :mark="mark">\n\t\t\t\t\t\t\t<slot name="row-details" :row="row"></slot>\n\t\t\t\t\t\t</data-grid-row-details>\n\t\t\t\t\t</template>\n\t\t\t\t</template>\n\t\t\t</tbody>\n\t\t</template>\n\t\t<template v-else>\n\t\t\t<tbody>\n\t\t\t\t<template v-for="(item, rowIndex) in $items">\n\t\t\t\t\t<data-grid-row :cols="columns" :row="item" :key="rowIndex" :index="rowIndex" :mark="mark" ref="row" :is-item-active="isItemActive" :hit-item="hitItem"/>\n\t\t\t\t\t<data-grid-row-details v-if="rowDetails" :cols="columns.length" :row="item" :key="\'rd:\' + rowIndex" :mark="mark">\n\t\t\t\t\t\t<slot name="row-details" :row="item"></slot>\n\t\t\t\t\t</data-grid-row-details>\n\t\t\t\t</template>\n\t\t\t</tbody>\n\t\t</template>\n\t\t<slot name="footer"></slot>\n\t</table>\n\t</div>\n</div>\n',components:{"data-grid-row":dataGridRow,"data-grid-row-details":dataGridRowDetails},data:()=>({columns:[],clientItems:null,clientGroups:null,localSort:{dir:"asc",order:""}}),computed:{$items(){return this.clientItems?this.clientItems:this.itemsSource},isMarkCell(){return"marker"===this.markStyle||"both"===this.markStyle},isRowDetailsCell(){return this.rowDetails&&"cell"===this.rowDetailsActivate},isRowDetailsAlways(){return this.rowDetails&&"always"===this.rowDetailsActivate},isMarkRow(){return"row"===this.markStyle||"both"===this.markStyle},isHeaderVisible(){return!this.hideHeader},cssClass(){let cssClass="data-grid";return this.grid&&(cssClass+=" grid-"+this.grid.toLowerCase()),null!=this.striped&&(cssClass+=this.striped?" striped":" no-striped"),null!=this.hover&&(cssClass+=this.hover?" hover":" no-hover"),this.compact&&(cssClass+=" compact"),cssClass},isGridSortable(){return!!this.sort},isLocal(){return!this.$parent.sortDir},isGrouping(){return this.groupBy},groupColumns(){return this.columns.length+(this.isMarkCell?1:0)+(this.isRowDetailsCell?1:0)},$groupCount(){return utils.isString(this.groupBy)?this.groupBy.split("-").length:utils.isObjectExact(this.groupBy)?1:this.groupBy.length},$groups(){this.doSortLocally();let startTime=performance.now(),grmap={},grBy=this.groupBy;if(utils.isString(grBy)){let rarr=[];for(let vs of grBy.split("-"))rarr.push({prop:vs.trim(),count:!0});grBy=rarr}else utils.isObjectExact(grBy)&&(grBy=[grBy]);if(!this.$items)return null;for(let itm of this.$items){let root=grmap;for(let gr of grBy){let key=utils.eval(itm,gr.prop);utils.isDate(key)&&(key=utils.format(key,"Date")),utils.isDefined(key)||(key=""),""===key&&(key=locale.$Unknown||"Unknown"),key in root||(root[key]={}),root=root[key]}root.items||(root.items=[]),root.items.push(itm)}let grArray=[];for(let el of function*enumGroups(src,p0,lev,cnt){for(let grKey in src){if("items"===grKey)continue;let srcElem=src[grKey],count=srcElem.items?srcElem.items.length:0;cnt&&(cnt.c+=count);let pElem={group:grKey,p0,expanded:!0,level:lev,items:srcElem.items||null,count};if(yield pElem,!src.items){let cnt={c:0};yield*enumGroups(srcElem,pElem,lev+1,cnt),pElem.count+=cnt.c}}}(grmap,null,1))el.source=grBy[el.level-1],!1===el.source.expanded&&(el.expanded=!1),grArray.push(el);return this.clientGroups=grArray,log.time("datagrid grouping time:",startTime),this.clientGroups},$isEmpty(){if(!this.itemsSource)return!1;let mi=this.itemsSource.$ModelInfo;return!!mi&&("HasRows"in mi?!this.itemsSource.length&&!1===mi.HasRows:0===this.itemsSource.length)}},watch:{localSort:{handler(){this.handleSort()},deep:!0},"itemsSource.length"(){this.handleSort()},$isEmpty(newval,oldval){this.emptyPanelCallback&&this.emptyPanelCallback.call(this.$root.$data,newval)}},methods:{selected(){let src=this.itemsSource;return src.$origin&&(src=src.$origin),src.$selected},$addColumn(column){this.columns.push(column)},$removeColumn(column){let ix=this.columns.indexOf(column);-1!==ix&&this.columns.splice(ix,1)},columnClass(column){let cls="";return(column.fit||"validator"===column.controlType)&&(cls+="fit"),this.sort&&column.isSortable&&utils.isDefined(column.dir)&&(cls+=" sorted"),cls},columnStyle:column=>({width:utils.isDefined(column.width)?column.width:void 0}),doSort(order){this.isLocal?eqlower(this.localSort.order,order)?this.localSort.dir=eqlower(this.localSort.dir,"asc")?"desc":"asc":this.localSort={order,dir:"asc"}:this.$parent.$emit("sort",order)},sortDir(order){return this.isLocal?eqlower(this.localSort.order,order)?this.localSort.dir:void 0:this.$parent.sortDir(order)},doSortLocally(){if(!this.isLocal)return;if(!this.localSort.order)return;let startTime=performance.now(),rev="desc"===this.localSort.dir,sortProp=this.localSort.order,arr=[].concat(this.itemsSource);arr.sort((a,b)=>{let av=a[sortProp],bv=b[sortProp];return av===bv?0:av<bv?rev?1:-1:rev?-1:1}),log.time("datagrid sorting time:",startTime),this.clientItems=arr},handleSort(){this.isGrouping?this.clientGroups=null:this.doSortLocally()},toggleGroup(g){g.expanded=!g.expanded},isGroupCountVisible:g=>!(g&&g.source&&utils.isDefined(g.source.count))||g.source.count,isGroupGroupVisible(g){if(!g.group)return!1;if(!g.p0)return!0;let cg=g.p0;for(;cg;){if(!cg.expanded)return!1;cg=cg.p0}return!0},isGroupBodyVisible(g){if(!g.expanded)return!1;let cg=g.p0;for(;cg;){if(!cg.expanded)return!1;cg=cg.p0}return!0},groupTitle:g=>g.source&&g.source.title?g.source.title.replace("{Value}",g.group).replace("{Count}",g.count):g.group,expandGroups(lev){for(var gr of this.$groups)gr.expanded=gr.level<lev},__autoSelect(){if(this.autoSelect&&this.$items&&this.$items.length&&!this.$items.$selected)switch(this.autoSelect){case"first-item":this.$items[0].$select();break;case"last-item":this.$items[this.$items.length-1].$select()}},__invoke__test__(args){if("datagrid"===(args=args||{}).target&&args.testId===this.testId)switch(args.action){case"selectRow":this.$items.forEach(e=>{e.$id.toString()===args.id&&(e.$select(),args.result="success")})}}},updated(){let src=this.itemsSource;if(!src)return;let ix=src.$selectedIndex,rows=this.$refs.row;if(-1!==ix&&rows&&ix<rows.length){rows[ix].$refs.tr.scrollIntoViewCheck()}this.__autoSelect()},mounted(){this.testId&&eventBus.$on("invokeTest",this.__invoke__test__)},beforeDestroy(){this.testId&&eventBus.$off("invokeTest",this.__invoke__test__)}})}(),function(){const locale=window.$$locale,eventBus=require("std:eventBus");Vue.component("a2-pager",{props:{source:Object,emptyText:String,templateText:String},computed:{pages(){return Math.ceil(this.count/this.source.pageSize)},currentPage(){return Math.ceil(this.offset/this.source.pageSize)+1},title(){return this.count?this.textString:this.emptyString},emptyString(){return this.emptyText?this.emptyText:locale.$NoElements},textString(){let lastNo=Math.min(this.count,this.offset+this.source.pageSize);return this.templateText?this.templateText.replace(/\#\[Start\]/g,this.offset+1).replace(/\#\[End\]/g,lastNo).replace(/\#\[Count\]/g,this.count):`${locale.$PagerElements}: <b>${this.offset+1}</b>-<b>${lastNo}</b> ${locale.$Of} <b>${this.count}</b>`},offset(){return+this.source.offset},count(){return+this.source.sourceCount}},methods:{setOffset(offset){offset=+offset,this.offset!==offset&&(eventBus.$emit("closeAllPopups"),this.$nextTick(()=>this.source.$setOffset(offset)))},isActive(page){return page===this.currentPage},click(arg,$ev){switch($ev.preventDefault(),arg){case"prev":this.setOffset(this.offset-this.source.pageSize);break;case"next":this.setOffset(this.offset+this.source.pageSize)}},goto(page,$ev){$ev.preventDefault();let offset=(page-1)*this.source.pageSize;this.setOffset(offset)}},render(h,ctx){if(-1===this.source.pageSize)return;let children=[];const dotsClass={class:"a2-pager-dots"},renderBtn=page=>h("button",{domProps:{innerText:page},on:{click:$ev=>this.goto(page,$ev)},class:{active:this.isActive(page)}});children.push(h("button",{on:{click:$ev=>this.click("prev",$ev)},attrs:{disabled:0===this.offset,"aria-label":"Previous page"}},[h("i",{class:"ico ico-chevron-left"})])),this.pages>0&&children.push(renderBtn(1));let ms=2,me=this.pages-1;2==this.pages&&(me=2);let sd=!1,ed=!1,cp=this.currentPage;me-ms>4&&(cp>4&&(sd=!0),cp<this.pages-3&&(ed=!0),sd&&!ed?ms=me-3:!sd&&ed?me=ms+3:sd&&ed&&(ms=cp-1,me=cp+1)),sd&&children.push(h("span",dotsClass,"..."));for(let mi=ms;mi<=me;++mi)children.push(renderBtn(mi));return ed&&children.push(h("span",dotsClass,"...")),this.pages>2&&children.push(renderBtn(this.pages)),children.push(h("button",{on:{click:$ev=>this.click("next",$ev)},attrs:{disabled:this.currentPage>=this.pages,"aria-label":"Next Page"}},[h("i",{class:"ico ico-chevron-right"})])),children.push(h("span",{class:"a2-pager-divider"})),children.push(h("span",{class:"a2-pager-title",domProps:{innerHTML:this.title}})),h("div",{class:"a2-pager"},children)}})}(),Vue.component("popover",{template:'\n<div v-dropdown class="popover-wrapper" :style="{top: top}" :class="{show: isShowHover}">\n\t<span toggle class="popover-title" v-on:mouseover="mouseover" v-on:mouseout="mouseout"><i v-if="hasIcon" :class="iconClass"></i> <span :title="title" v-text="content"></span><slot name="badge"></slot></span>\n\t<div class="popup-body" :style="{width: width, left:offsetLeft}">\n\t\t<div class="arrow" :style="{left:offsetArrowLeft}"/>\n\t\t<div v-if="visible">\n\t\t\t<include :src="popoverUrl"/>\n\t\t</div>\n\t\t<slot />\n\t</div>\n</div>\n',data:()=>({state:"hidden",hoverstate:!1,popoverUrl:""}),props:{icon:String,url:String,content:[String,Number],title:String,width:String,top:String,hover:Boolean,offsetX:String},computed:{hasIcon(){return!!this.icon},offsetLeft(){return this.offsetX||void 0},offsetArrowLeft(){if(this.offsetX&&0===this.offsetX.indexOf("-"))return`calc(${this.offsetX.substring(1)} + 6px)`},iconClass(){let cls="ico po-ico";return this.icon&&(cls+=" ico-"+this.icon),cls},visible(){return this.url&&"shown"===this.state},isShowHover(){return this.hover&&this.hoverstate?"show":void 0}},methods:{mouseover(){this.hover&&(this.hoverstate=!0)},mouseout(){this.hover&&(this.hoverstate=!1)}},mounted(){this.$el._show=()=>{if(this.state="shown",this.url){const urltools=require("std:url");let root=window.$$rootUrl;this.popoverUrl=urltools.combine(root,"/_popup",this.url)}},this.$el._hide=()=>{this.state="hidden",this.popoverUrl=""}}}),function(){const utils=require("std:utils"),eventBus=require("std:eventBus"),platform=require("std:platform"),treeItemComponent={name:"tree-item",template:'\n<li @click.stop.prevent="doClick(item)" :title=title v-on:dblclick.stop.prevent="doDblClick(item)"\n\tv-show=isItemVisible\n\t:class="{expanded: isExpanded, collapsed:isCollapsed, active:isItemSelected, folder:isFolder, group: isItemGroup}" >\n\t<div :class="{overlay:true, \'no-icons\': !options.hasIcon}">\n\t\t<a class="toggle" v-if="isFolder" href @click.stop.prevent=toggle></a>\n\t\t<span v-else class="toggle"/>\n\t\t<i v-if="options.hasIcon" :class="iconClass"/>\n\t\t<a v-if="hasLink(item)" :href=dataHref tabindex="-1" v-text="item[options.label]" :class="{\'no-wrap\':!options.wrapLabel }"/>\n\t\t<span v-else v-text="item[options.label]" :class="{\'tv-folder\':true, \'no-wrap\':!options.wrapLabel}"/>\n\t</div>\n\t<ul v-if=isFolder v-show=isExpanded>\n\t\t<tree-item v-for="(itm, index) in item[options.subitems]" :options="options"\n\t\t\t:key="index" :item="itm" :click="click" :doubleclick="doubleclick" :get-href="getHref" :is-active="isActive" :expand="expand" :root-items="rootItems">\n\t\t</tree-item>\n\t</ul>\n</li>\n',props:{item:Object,options:Object,rootItems:Array,click:Function,expand:Function,isActive:Function,isGroup:Function,getHref:Function,doubleclick:Function},methods:{isFolderSelect(item){let fs=this.options.folderSelect;return utils.isFunction(fs)?fs(item):!!this.options.folderSelect},doClick(item){eventBus.$emit("closeAllPopups"),this.isFolder&&!this.isFolderSelect(item)?this.toggle():"$select"in item?item.$select(this.rootItems):this.click&&this.click(item)},doDblClick(item){eventBus.$emit("closeAllPopups"),this.isFolder&&!this.isFolderSelect(item)||this.doubleclick&&this.doubleclick()},hasLink(item){return!this.isFolder||this.isFolderSelect(item)},toggle(){eventBus.$emit("closeAllPopups"),this.isFolder&&(this.expandItem(!this.item.$expanded),this.expand&&this.expand(this.item,this.options.subitems))},expandItem(val){platform.set(this.item,"$expanded",val)},openElem:function(){this.isFolder&&this.expandItem(!0)}},computed:{isFolder:function(){if(utils.isDefined(this.item.$hasChildren)&&this.item.$hasChildren)return!0;if(utils.isDefined(this.options.isFolder))return this.item[this.options.isFolder];let ch=this.item[this.options.subitems];return ch&&ch.length},isItemVisible:function(){let iv=this.options.isVisible;return!iv||this.item[iv]},isExpanded:function(){return this.isFolder&&this.item.$expanded},isCollapsed:function(){return this.isFolder&&!this.item.$expanded},title(){var t=this.item[this.options.title];return t||(t=this.item[this.options.label]),t},isItemSelected:function(){return this.item&&"$selected"in this.item?this.item.$selected:this.isActive&&this.isActive(this.item)},isItemGroup(){let gp=this.options?this.options.isGroup:void 0;return gp?utils.eval(this.item,gp):this.isGroup&&this.isGroup(this.item)},iconClass:function(){let icons=this.options.staticIcons;if(icons)return"ico ico-"+(this.isFolder?icons[0]:icons[1]);if(this.options.icon){let icon=this.item[this.options.icon];return icon?"ico ico-"+(icon||"empty"):""}},dataHref(){return this.getHref?this.getHref(this.item):""}},watch:{isItemSelected(newVal){newVal&&this.$el.scrollIntoViewCheck&&this.$el.scrollIntoViewCheck()}},updated(x){if(this.item.$expanded&&this.item.$hasChildren){this.item[this.options.subitems].$loaded||this.expandItem(!1)}}};Vue.component("tree-view",{components:{"tree-item":treeItemComponent},template:'\n<ul class="tree-view">\n\t<tree-item v-for="(itm, index) in items" :options="options" :get-href="getHref"\n\t\t:item="itm" :key="index"\n\t\t:click="click" :doubleclick="doubleclick" :is-active="isActive" :is-group="isGroup" :expand="expand" :root-items="items">\n\t</tree-item>\n</ul>',props:{options:Object,items:Array,isActive:Function,isGroup:Function,click:Function,expand:Function,autoSelect:String,getHref:Function,expandFirstItem:Boolean,doubleclick:Function},computed:{isSelectFirstItem(){return"first-item"===this.autoSelect}},watch:{items:function(){this.doExpandFirst()}},methods:{selectFirstItem(){if(!this.isSelectFirstItem)return;let itms=this.items;if(!itms.length)return;let fe=null;if(this.options&&this.options.isVisible){let vi=this.options.isVisible;fe=itms.$find(x=>x[vi])}else fe=itms[0];fe&&fe.$select&&fe.$select(this.items)},doExpandFirst(){this.expandFirstItem&&this.$nextTick(()=>{this.$children&&this.$children.forEach(val=>{val&&val.openElem&&val.openElem()})})}},created(){this.selectFirstItem(),this.doExpandFirst()},updated(){this.isSelectFirstItem&&!this.items.$selected&&this.selectFirstItem()}})}(),function(){const log=require("std:log",!0),utils=require("std:utils"),period=require("std:period"),eventBus=require("std:eventBus"),eqlower=utils.text.equalNoCase;function getModelInfoProp(src,propName){if(!src)return;let mi=src.$ModelInfo;return mi?mi[propName]:void 0}function setModelInfoProp(src,propName,value){if(!src)return;let mi=src.$ModelInfo;mi&&(mi[propName]=value)}function makeNewQueryFunc(that){let nq={dir:that.dir,order:that.order,offset:that.offset,group:that.GroupBy};for(let x in that.filter){let fVal=that.filter[x];period.isPeriod(fVal)?nq[x]=fVal.format("DateUrl"):utils.isDate(fVal)?nq[x]=utils.format(fVal,"DateUrl"):utils.isObjectExact(fVal)?("Id"in fVal||console.error("The object in the Filter does not have Id property"),nq[x]=fVal.Id?fVal.Id:void 0):nq[x]=fVal||void 0}return nq}function modelInfoToFilter(q,filter){if(q)for(let x in filter)if(x in q){let iv=filter[x];period.isPeriod(iv)?filter[x]=iv.fromUrl(q[x]):utils.isDate(iv)?filter[x]=utils.date.tryParse(q[x]):utils.isObjectExact(iv)?iv.Id=q[x]:utils.isNumber(iv)?filter[x]=+q[x]:filter[x]=q[x]}}Vue.component("collection-view",{template:'\n<div>\n\t<slot :ItemsSource="pagedSource" :Pager="thisPager" :Filter="filter">\n\t</slot>\n</div>\n',props:{ItemsSource:Array,initialPageSize:Number,initialFilter:Object,initialSort:Object,runAt:String,filterDelegate:Function},data(){let lq=Object.assign({},{offset:0,dir:"asc",order:""},this.initialFilter);return{filter:this.initialFilter,filteredCount:0,localQuery:lq}},computed:{pageSize(){return this.initialPageSize>0?this.initialPageSize:-1},dir(){return this.localQuery.dir},offset(){return this.localQuery.offset},order(){return this.localQuery.order},pagedSource(){let s=performance.now(),arr=[].concat(this.ItemsSource);if(this.filterDelegate&&(arr=arr.filter(item=>this.filterDelegate(item,this.filter))),this.order&&this.dir){let p=this.order,d=eqlower(this.dir,"asc");arr.sort((a,b)=>a[p]===b[p]?0:a[p]<b[p]?d?-1:1:d?1:-1)}return this.filteredCount=arr.length,this.pageSize>0&&(arr=arr.slice(this.offset,this.offset+this.pageSize)),arr.$origin=this.ItemsSource,-1===arr.indexOf(arr.$origin.$selected)&&arr.$origin.$clearSelected(),log&&log.time("get paged source:",s),arr},sourceCount(){return this.ItemsSource.length},thisPager(){return this},pages(){let cnt=this.filteredCount;return Math.ceil(cnt/this.pageSize)}},methods:{$setOffset(offset){this.localQuery.offset=offset},sortDir(order){return eqlower(order,this.order)?this.dir:void 0},doSort(order){let nq=this.makeNewQuery();eqlower(nq.order,order)?nq.dir=eqlower(nq.dir,"asc")?"desc":"asc":(nq.order=order,nq.dir="asc"),nq.order||(nq.dir=null),this.localQuery.dir=nq.dir,this.localQuery.order=nq.order},makeNewQuery(){return makeNewQueryFunc(this)},copyQueryToLocal(q){for(let x in q){let fVal=q[x];this.localQuery[x]="offset"===x?q[x]:fVal||void 0}}},created(){this.initialSort&&(this.localQuery.order=this.initialSort.order,this.localQuery.dir=this.initialSort.dir),this.$on("sort",this.doSort)}}),Vue.component("collection-view-server",{template:'\n<div>\n\t<slot :ItemsSource="ItemsSource" :Pager="thisPager" :Filter="filter" :ParentCollectionView="parentCw">\n\t</slot>\n</div>\n',props:{ItemsSource:Array,initialFilter:Object,persistentFilter:Array},data(){return{filter:this.initialFilter,lockChange:!0}},watch:{jsonFilter:{handler(newData,oldData){this.filterChanged()}}},computed:{jsonFilter(){return utils.toJson(this.filter)},thisPager(){return this},pageSize(){return getModelInfoProp(this.ItemsSource,"PageSize")},dir(){return getModelInfoProp(this.ItemsSource,"SortDir")},order(){return getModelInfoProp(this.ItemsSource,"SortOrder")},offset(){return getModelInfoProp(this.ItemsSource,"Offset")},pages(){return cnt=this.sourceCount,Math.ceil(cnt/this.pageSize)},sourceCount(){return this.ItemsSource&&this.ItemsSource.$RowCount||0},parentCw(){let p=this.$parent;for(;p&&p.$options&&p.$options._componentTag&&!p.$options._componentTag.startsWith("collection-view-server");)p=p.$parent;return p}},methods:{$setOffset(offset){this.offset!==offset&&(setModelInfoProp(this.ItemsSource,"Offset",offset),this.reload())},sortDir(order){return eqlower(order,this.order)?this.dir:void 0},doSort(order){if(eqlower(order,this.order)){let dir=eqlower(this.dir,"asc")?"desc":"asc";setModelInfoProp(this.ItemsSource,"SortDir",dir)}else setModelInfoProp(this.ItemsSource,"SortOrder",order),setModelInfoProp(this.ItemsSource,"SortDir","asc");this.reload()},filterChanged(){if(this.lockChange)return;let mi=this.ItemsSource.$ModelInfo;if(mi?this.ItemsSource.$ModelInfo.Filter=this.filter:(mi={Filter:this.filter},this.ItemsSource.$ModelInfo=mi),this.persistentFilter&&this.persistentFilter.length){let parentProp=this.ItemsSource._path_,propIx=parentProp.lastIndexOf(".");parentProp=parentProp.substring(propIx+1);for(let topElem of this.ItemsSource.$parent.$parent)if(topElem[parentProp].$ModelInfo)for(let pp of this.persistentFilter)utils.isEqual(topElem[parentProp].$ModelInfo.Filter[pp],this.filter[pp])||(topElem[parentProp].$ModelInfo.Filter[pp]=this.filter[pp],topElem[parentProp].$loaded=!1);else topElem[parentProp].$ModelInfo=mi}"Offset"in mi&&setModelInfoProp(this.ItemsSource,"Offset",0),this.reload()},reload(){this.$root.$emit("cwChange",this.ItemsSource)},updateFilter(){let mi=this.ItemsSource?this.ItemsSource.$ModelInfo:null;if(!mi)return;let fi=mi.Filter;if(fi){for(var prop in this.lockChange=!0,this.filter)prop in fi&&(this.filter[prop]=fi[prop]);this.$nextTick(()=>{this.lockChange=!1})}},__setFilter(props){this.ItemsSource===props.source&&(period.isPeriod(props.value)?this.filter[props.prop].assign(props.value):this.filter[props.prop]=props.value)}},created(){let mi=this.ItemsSource?this.ItemsSource.$ModelInfo:null;mi&&modelInfoToFilter(mi.Filter,this.filter),this.$nextTick(()=>{this.lockChange=!1}),this.$on("sort",this.doSort),eventBus.$on("setFilter",this.__setFilter)},updated(){this.updateFilter()},beforeDestroy(){eventBus.$off("setFilter",this.__setFilter)}}),Vue.component("collection-view-server-url",{store:component("std:store"),template:'\n<div>\n\t<slot :ItemsSource="ItemsSource" :Pager="thisPager" :Filter="filter" :Grouping="thisGrouping">\n\t</slot>\n</div>\n',props:{ItemsSource:Array,initialFilter:Object,initialGroup:Object},data(){return{filter:this.initialFilter,GroupBy:"",lockChange:!0}},watch:{jsonFilter:{handler(newData,oldData){this.filterChanged()}},GroupBy:{handler(newData,oldData){this.filterChanged()}}},computed:{jsonFilter(){return utils.toJson(this.filter)},pageSize(){let ps=getModelInfoProp(this.ItemsSource,"PageSize");return ps||20},dir(){let dir=this.$store.getters.query.dir;return dir||(dir=getModelInfoProp(this.ItemsSource,"SortDir")),dir},offset(){let ofs=this.$store.getters.query.offset;return utils.isDefined(ofs)||(ofs=getModelInfoProp(this.ItemsSource,"Offset")),ofs||0},order(){return getModelInfoProp(this.ItemsSource,"SortOrder")},sourceCount(){return this.ItemsSource&&this.ItemsSource.$RowCount||0},thisPager(){return this},thisGrouping(){return this},pages(){return cnt=this.sourceCount,Math.ceil(cnt/this.pageSize)},Filter(){return this.filter}},methods:{commit(query){this.$store.commit("setquery",query)},sortDir(order){return eqlower(order,this.order)?this.dir:void 0},$setOffset(offset){this.offset!==offset&&(setModelInfoProp(this.ItemsSource,"Offset",offset),this.commit({offset}))},doSort(order){let nq=this.makeNewQuery();eqlower(nq.order,order)?nq.dir=eqlower(nq.dir,"asc")?"desc":"asc":(nq.order=order,nq.dir="asc"),nq.order||(nq.dir=null),this.commit(nq)},makeNewQuery(){return makeNewQueryFunc(this)},filterChanged(){if(this.lockChange)return;let nq=this.makeNewQuery();nq.offset=0,nq.order||(nq.dir=void 0),this.commit(nq)},__setFilter(props){this.ItemsSource===props.source&&(period.isPeriod(props.value)?this.filter[props.prop].assign(props.value):this.Filter[props.prop]=props.value)}},created(){let mi=this.ItemsSource.$ModelInfo;mi&&(modelInfoToFilter(mi.Filter,this.filter),mi.GroupBy&&(this.GroupBy=mi.GroupBy)),modelInfoToFilter(this.$store.getters.query,this.filter),this.$nextTick(()=>{this.lockChange=!1}),this.$on("sort",this.doSort),eventBus.$on("setFilter",this.__setFilter)},beforeDestroy(){eventBus.$off("setFilter",this.__setFilter)}})}();const maccel=require("std:accel");function findHandle(el){for(let ch of el.childNodes)if(ch.nodeType===Node.ELEMENT_NODE&&ch.classList.contains("drag-handle"))return ch;return null}Vue.component("a2-accel-command",{props:{accel:String,command:Function},render(){},mounted(){this.accel&&(this._key=maccel.registerControl(this.accel,this.command,"func"))},beforeDestroy(){this.accel&&maccel.unregisterControl(this._key)}}),function(){const url=require("std:url"),http=require("std:http"),tools=require("std:tools"),locale=window.$$locale;Vue.component("a2-upload",{template:'\n<label :class="cssClass" @dragover="dragOver" @dragleave="dragLeave">\n\t<input v-if=\'canUpload\' type="file" @change="uploadImage" v-bind:multiple="isMultiple" :accept="accept" />\n\t<i class="ico" :class="icoClass"></i>\n\t<span class="upload-tip" v-text="tip" v-if="tip"></span>\n</label>\n\t\t',props:{item:Object,prop:String,base:String,newItem:Boolean,tip:String,readOnly:Boolean,accept:String,limit:Number,icon:String},data:function(){return{hover:!1}},computed:{cssClass(){return"file-upload"+(this.hover?" hover":"")},isMultiple(){return!!this.newItem},canUpload(){return!this.readOnly},icoClass(){return this.icon?"ico-"+this.icon:"image/*"===this.accept?"ico-image":"ico-upload"}},methods:{dragOver(ev){this.hover=!0,ev.preventDefault()},dragLeave(ev){this.hover=!1,ev.preventDefault()},checkLimit(file){if(!this.limit)return!1;return file.size/1024>this.limit},uploadImage(ev){let root=window.$$rootUrl,id=this.item[this.prop],imgUrl=url.combine(root,"_image",this.base,this.prop,id);var fd=new FormData;for(let file of ev.target.files){if(this.checkLimit(file)){ev.target.value="";let msg=locale.$FileTooLarge.replace("{0}",this.limit);return void tools.alert(msg)}fd.append("file",file,file.name)}http.upload(imgUrl,fd).then(result=>{ev.target.value="";let token=void 0;if(this.item._meta_&&(token=this.item._meta_.$token),"OK"===result.status)if(this.newItem){let p0=this.item.$parent;for(let elem of result.elems){let ni=p0.$append();ni[this.prop]=elem.Id,ni[token]=elem.Token}}else this.item[this.prop]=result.elems[0].Id,this.item[token]=result.elems[0].Token}).catch(msg=>{0===msg.indexOf("UI:")?tools.alert(msg.substring(3).replace("\\n","\n")):alert(msg)})}}}),Vue.component("a2-simple-upload",{template:'\n<label class="a2-simple-upload" :class="labelClass">\n\t<i class="ico" :class=\'icon\'></i>\n\t<input type="file" @change="uploadChange" ref="file"/>\n\t<span v-text="labelText" class="upload-text"></span>\n\t<button class="btnclose" @click.prevent="clear" v-if="file">&#x2715;</button>\n</label>\n\t\t',props:{item:Object,prop:String,text:String},data:function(){return{}},computed:{labelText(){return this.file?this.file.name:this.text||locale.$ChooseFile},icon(){return this.file&&this.file.name?"ico-file":"ico-attach"},file(){return this.item?this.item[this.prop]:null},labelClass(){return this.file?"has-file":void 0}},methods:{fireChange(){},clear(){this.item&&(this.item[this.prop]=null,this.fireChange(),this.$refs.file.value="")},uploadChange(ev){let files=ev.target.files;this.item[this.prop]=files[0],this.fireChange()}}})}(),function(){require("std:utils");Vue.component("a2-tab-item",{name:"a2-tab-item",template:'\n<div class="tab-item" v-show="isActive">\n\t<slot />\n</div>\n',props:{header:String,badge:[String,Number,Object],icon:String,tabStyle:String,show:void 0,itemToValidate:Object,propToValidate:String},data:()=>({controls:[]}),computed:{hasIcon(){return!!this.icon},hasBadge(){return!!this.badge},iconCss(){return this.icon?"ico ico-"+this.icon:""},isActive(){return this===this.$parent.activeTab},tabCssClass(){return(this.isActive?"active ":"")+(this.tabStyle||"")},isVisible(){return"boolean"!=typeof this.show||this.show}},methods:{isInvalid(){if(!this.controls.length)return!1;for(let c of this.controls)if(c.invalid())return!0;return!1},$registerControl(control){this.controls.push(control)},$unregisterControl(control){let ix=this.controls.indexOf(control);-1!==ix&&this.controls.splice(ix,1)}},created(){this.$parent.$addTab(this)},destroyed(){this.$parent.$removeTab(this)}}),Vue.component("a2-tab-panel",{template:'\n<div class="tab-panel">\n\t<template v-if="static">\n\t\t<ul class="tab-header">\n\t\t\t<li :class="tab.tabCssClass" v-for="(tab, tabIndex) in tabs" :key="tabIndex" @click.prevent="select(tab)" v-show="tab.isVisible">\n\t\t\t\t<i v-if="tab.hasIcon" :class="tab.iconCss" ></i>\n\t\t\t\t<span v-text="tab.header"></span><span class="badge" v-if="tab.hasBadge" v-text="tab.badge"></span>\n\t\t\t\t<i v-if="tab.isInvalid()" class="ico ico-error-outline"/>\n\t\t\t</li>\n\t\t</ul>\n\t\t<slot name="title" />\n\t\t<div class="tab-content" :class="contentCssClass">\n\t\t\t<slot />\n\t\t</div>\n\t</template>\n\t<template v-else>\n\t\t<ul class="tab-header">\n\t\t\t<li :class="{active: isActiveTab(item)}" v-for="(item, tabIndex) in items" :key="tabIndex" @click.prevent="select(item)" v-show="item.isVisible">\n\t\t\t\t<slot name="header" :item="item" :index="tabIndex" :number="tabIndex + 1">\n\t\t\t\t\t<span v-text="defaultTabHeader(item, tabIndex)"></span> \n\t\t\t\t</slot>\n\t\t\t</li>\n\t\t</ul>\n\t\t<slot name="title" />\n\t\t<div class="tab-content">\n\t\t\t<div class="tab-item" v-if="isActiveTab(item)" v-for="(item, tabIndex) in items" :key="tabIndex">\n\t\t\t\t<slot name="items" :item="item" :index="tabIndex" />\n\t\t\t</div>\n\t\t</div>\n\t</template>\n</div>\n',props:{items:Array,header:String},data:()=>({tabs:[],activeTab:null}),computed:{static(){return!this.items},contentCssClass(){return this.activeTab?this.activeTab.tabStyle:""}},watch:{items(newVal,oldVal){let tabs=this.items;newVal.length<oldVal.length?(this._index>=tabs.length&&(this._index=tabs.length-1),this.select(tabs[this._index])):newVal.length===oldVal.length?tabs.length>0&&this.select(tabs[0]):this.select(tabs[tabs.length-1])}},methods:{select(item){this.activeTab=item,this.items&&(this._index=this.items.indexOf(item))},nextTab(){alert("next")},prevTab(){alert("prev")},isActiveTab(item){return item===this.activeTab},defaultTabHeader:(item,index)=>"Tab "+(index+1),$addTab(tab){this.tabs.push(tab)},$removeTab(tab){let ix=this.tabs.indexOf(tab);-1!==ix&&(this.tabs.splice(ix,1),-1===this.tabs.indexOf(this.activeTab)&&this.tabs.length>0&&this.select(this.tabs[0]))}},mounted(){this.tabs.length>0?this.activeTab=this.tabs[0]:this.items&&this.items.length&&(this.activeTab=this.items[0]),this._index=0}})}(),function(){const utils=require("std:utils"),locale=(require("std:eventBus"),window.$$locale);Vue.component("a2-list",{template:'\n<ul class="a2-list" v-lazy="itemsSource">\n\t<template v-if="itemsSource">\n\t\t<li class="a2-list-item" tabindex="1" :class="cssClass(listItem)" v-for="(listItem, listItemIndex) in source" :key="listItemIndex" \n\t\t\t\t@mousedown.prevent="select(listItem)" @keydown="keyDown" \n\t\t\t\tref="li">\n\t\t\t<span v-if="listItem.__group" v-text="listItem.__group"></span>\n\t\t\t<slot name="items" :item="listItem" v-if="!listItem.__group"/>\n\t\t</li>\n\t\t<div class="list-empty" v-if="$isEmpty">\n\t\t\t<slot name="empty" />\n\t\t</div>\n\t</template>\n\t<template v-else>\n\t\t<slot />\n\t</template>\n</ul>\n',props:{itemsSource:Array,autoSelect:String,mark:String,markStyle:String,command:Function,selectable:{type:Boolean,default:!0},hover:{type:Boolean,default:!0},groupBy:String},computed:{selectedSource(){let src=this.itemsSource;return src?(src.$origin&&(src=src.$origin),src.$selected):null},source(){if(!this.groupBy)return this.itemsSource;let grmap={};for(let itm of this.itemsSource){let key=utils.eval(itm,this.groupBy);utils.isDate(key)&&(key=utils.format(key,"Date")),utils.isDefined(key)||(key=""),""===key&&(key=locale.$Unknown||"Unknown"),key in grmap||(grmap[key]={group:key,items:[]}),grmap[key].items.push(itm)}let rarr=[];for(let key in grmap){let me=grmap[key];for(var e of(rarr.push(Object.assign({},me,{__group:me.group,__count:me.items.length})),me.items))rarr.push(e)}return rarr},$isEmpty(){return this.itemsSource&&0===this.itemsSource.length}},methods:{cssClass(item){return this.groupBy&&item.__group?"group"+(this.mark?" mark":""):(item.$selected?"active ":" ")+(el=>{if(!this.mark)return"";let cls=utils.eval(el,this.mark);return"row"===this.markStyle?cls+=" no-marker":"marker"===this.markStyle&&(cls+=" no-background"),cls})(item)},select(item){this.selectable&&item.$select&&item.$select()},selectStatic(){alert("yet not implemented"),console.dir(this)},selectFirstItem(){if(!this.autoSelect)return;if(!this.selectable)return;let src=this.itemsSource;if(!src.$selected&&src&&src.length)if("first-item"!==this.autoSelect)if("last-item"!==this.autoSelect){if("item-id"===this.autoSelect){let rootId=this.$root.$modelInfo.Id;if(!utils.isDefined(rootId))return void console.error("Id not found in Root.modelInfo");let fe=src.find(itm=>itm.$id===rootId);fe||(console.error(`Element with id=${rootId} not found`),fe=src[0]),fe&&this.select(fe)}}else{let fe=src[src.length-1];this.select(fe)}else{let fe=src[0];this.select(fe)}},keyDown(e){const next=delta=>{let index;index=this.itemsSource.indexOf(this.selectedSource),-1!==index&&(index+=delta,-1!==index&&index<this.itemsSource.length&&this.select(this.itemsSource[index]))};switch(e.which){case 38:next(-1);break;case 40:next(1);break;case 36:case 35:case 33:case 34:break;case 13:utils.isFunction(this.command)&&this.command();break;default:return}e.preventDefault(),e.stopPropagation()}},created(){this.selectFirstItem()},updated(){if(!this.selectedSource&&this.autoSelect&&this.selectFirstItem(),!this.itemsSource)return;let li=this.$refs.li;li&&setTimeout(()=>{let ix=li.findIndex(itm=>itm.classList.contains("active"));-1!==ix&&li&&ix<li.length&&li[ix].scrollIntoViewCheck()},0)}})}(),function(){const eventBus=require("std:eventBus"),locale=window.$$locale,utils=require("std:utils"),setWidthComponent={inserted(el,binding){let mw=el.closest(".modal-window");if(mw){switch(binding.value.width&&(mw.style.width=binding.value.width),binding.value.cssClass){case"modal-large":mw.style.width="800px";break;case"modal-small":mw.style.width="350px"}binding.value.minWidth&&(mw.style.minWidth=binding.value.minWidth)}}},maximizeComponent={inserted(el,binding){let mw=el.closest(".modal-window");mw&&binding.value&&mw.setAttribute("maximize","true")}},dragDialogDirective={inserted(el,binding){const mw=el.closest(".modal-window");if(!mw)return;const opts={down:!1,init:{x:0,y:0,cx:0,cy:0},offset:{x:0,y:0}};function onRelease(event){opts.down=!1,document.removeEventListener("mouseup",onRelease),document.removeEventListener("mousemove",onMouseMove)}function onMouseMove(event){if(!opts.down)return;let dx=2*(event.pageX-opts.offset.x),dy=2*(event.pageY-opts.offset.y),mx=opts.init.x+dx,my=opts.init.y+dy,maxX=window.innerWidth-opts.init.cx,maxY=window.innerHeight-opts.init.cy-24;mx<-maxX&&(mx=-maxX),mx>maxX&&(mx=maxX),my<-maxY&&(my=-maxY),mw.style.marginLeft=mx+"px",mw.style.marginTop=my+"px"}el.addEventListener("mousedown",(function(event){opts.down=!0,opts.offset.x=event.pageX,opts.offset.y=event.pageY;const cs=window.getComputedStyle(mw);opts.init.x=Number.parseFloat(cs.marginLeft),opts.init.y=Number.parseFloat(cs.marginTop),opts.init.cx=Number.parseFloat(cs.width),opts.init.cy=Number.parseFloat(cs.height),document.addEventListener("mouseup",onRelease,!1),document.addEventListener("mousemove",onMouseMove,!1)}),!1)}};Vue.directive("drag-window",dragDialogDirective),Vue.directive("modal-width",setWidthComponent),Vue.directive("maximize",maximizeComponent);const modalComponent={template:'\n<div class="modal-window modal-animation-window" @keydown.tab="tabPress" :class="mwClass" ref=dialog>\n\t<include v-if="isInclude" class="modal-body" :src="dialog.url" :done="loaded" :inside-dialog="true"></include>\n\t<div v-else class="modal-body">\n\t\t<div class="modal-header" v-drag-window><span v-text="title"></span><button ref=\'btnclose\' class="btnclose" @click.prevent="modalClose(false)">&#x2715;</button></div>\n\t\t<div :class="bodyClass">\n\t\t\t<i v-if="hasIcon" :class="iconClass" />\n\t\t\t<div class="modal-body-content">\n\t\t\t\t<div v-html="messageText()" />\n\t\t\t\t<ul v-if="hasList" class="modal-error-list">\n\t\t\t\t\t<li v-for="(itm, ix) in dialog.list" :key="ix" v-text="itm"/>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="modal-footer">\n\t\t\t<button class="btn btn-default" v-for="(btn, index) in buttons"  :key="index" @click.prevent="modalClose(btn.result)" v-text="btn.text"/>\n\t\t</div>\n\t</div>\n</div>\n',props:{dialog:Object},data:()=>({modalCreated:!1,keyUpHandler:function(event){27===event.which&&(eventBus.$emit("modalClose",!1),event.stopPropagation(),event.preventDefault())}}),methods:{modalClose(result){eventBus.$emit("modalClose",result)},loaded(){},messageText(){return utils.text.sanitize(this.dialog.message)},tabPress(event){const dialog=this.$refs.dialog,activeInput=document.activeElement;let elems=Array.from(dialog.querySelectorAll("input:enabled, button:enabled, textarea:enabled, select:enabled, a:not([disabled])"));if(elems=elems.filter(el=>el&&(el.offsetLeft||el.offsetTop||el.offsetWidth||el.offsetHeight)).map(el=>({elem:el,ti:+el.getAttribute("tabindex")||0,active:el==activeInput})).filter(el=>-1!==el.ti).sort((e1,e2)=>e1.ti==e2.ti?0:e1.ti<e2.ti?-1:1),!elems.length)return;const d=event.shiftKey?-1:1;let ni=elems.findIndex(x=>x.active)+d;ni<0?ni=elems.length-1:ni>=elems.length&&(ni=0),elems[ni].elem.focus(),event.preventDefault()},__modalRequery(){alert("requery yet not implemented")}},computed:{isInclude:function(){return!!this.dialog.url},mwClass(){return this.modalCreated?"loaded":""},hasIcon(){return!!this.dialog.style},title:function(){return this.dialog.title?this.dialog.title:"confirm"===this.dialog.style?locale.$Confirm:"info"===this.dialog.style?locale.$Message:locale.$Error},bodyClass(){return"modal-body "+(this.dialog.style||"")},iconClass(){let ico=this.dialog.style;return"info"===ico&&(ico="info-blue"),"ico ico-"+ico},hasList(){return this.dialog.list&&this.dialog.list.length},buttons:function(){let okText=this.dialog.okText||locale.$Ok,cancelText=this.dialog.cancelText||locale.$Cancel;return this.dialog.buttons?this.dialog.buttons:"alert"===this.dialog.style||"info"===this.dialog.style?[{text:okText,result:!0,tabindex:1}]:[{text:okText,result:!0,tabindex:2},{text:cancelText,result:!1,tabindex:1}]}},created(){document.addEventListener("keyup",this.keyUpHandler),this.savedFocus=document.activeElement,this.savedFocus&&this.savedFocus.blur&&this.savedFocus.blur()},mounted(){setTimeout(()=>{this.modalCreated=!0},50)},destroyed(){this.savedFocus&&this.savedFocus.focus&&this.savedFocus.focus(),document.removeEventListener("keyup",this.keyUpHandler)}};app.components["std:modal"]=modalComponent}(),function(){const waitCursor={template:'<div class="wait-cursor" v-if="visible()"><div class="spinner"/></div>',props:{ready:Boolean},methods:{visible(){return!this.ready}}};Vue.component("wait-cursor",waitCursor)}(),function(){const eventBus=require("std:eventBus"),locale=window.$$locale;Vue.component("a2-wizard-panel",{template:'\n<div class="wizard-panel" :style="panelStyle">\n\t<ul class="wizard-header">\n\t\t<li v-for="(p, px) in pages" :class="pageClass(p)" @click.prevent="selectPage(p)">\n\t\t\t<a><span class="wizard-header-title" v-text="p.header"/><span class="wizard-header-descr" v-text="p.descr"></span><i v-if="p.errorIcon" class="ico ico-error-outline"></i></a>\n\t\t</li>\n\t</ul>\n\t<div class="wizard-content">\n\t\t<slot />\n\t</div>\n\t<div class="modal-footer">\n\t\t<template v-if="helpLink">\n\t\t\t<a class="btn-help" rel="help" :href="helpLink" @click.prevent="$showHelp()"><i class="ico ico-help"/><span v-text="$locale.$Help"/></a>\n\t\t\t<div class="aligner"/>\n\t\t</template>\n\t\t<button class="btn a2-inline" :disabled="backDisabled" @click.stop="back"><i class="ico ico-chevron-left"/> <span v-text="$locale.$Back"/></button>\n\t\t<button class="btn a2-inline btn-primary" @click.stop="nextFinish" :disabled="nextDisabled()"><span v-text="nextFinishText"/> <i class="ico" :class="nextFinishIco""/></button>\n\t\t<button class="btn a2-inline" @click.prevent="close" v-text="$locale.$Cancel" style="margin-left:2rem"/>\n\t</div>\n</div>\n',props:{finish:Function,helpLink:String,minHeight:String},data:()=>({pages:[],activePage:null}),computed:{$locale:()=>locale,nextFinishText(){let pgs=this.pages;return this.activePage===pgs[pgs.length-1]?locale.$Finish:locale.$Next},nextFinishIco(){let pgs=this.pages;return this.activePage===pgs[pgs.length-1]?"ico-chevron-right-end":"ico-chevron-right"},backDisabled(){return this.activePage===this.pages[0]},panelStyle(){if(this.minHeight)return{"min-height":this.minHeight}}},methods:{nextDisabled(){return!!this.activePage&&!!this.activePage.$invalid()},setActivePage(page){this.activePage&&(this.activePage.visit=!0),this.activePage=page,this.activePage.state="edit"},selectPage(page){!this.$nextPage(page)||this.nextDisabled()?page.visit&&this.setActivePage(page):this.setActivePage(page)},pageClass(page){let cls="";if(!page.visit){if(this.$nextPage(page)&&!this.nextDisabled())return cls;cls="disabled"}return page===this.activePage?cls="active":page.wasInvalid&&(cls="invalid"),cls},close(){eventBus.$emit("modalClose")},back(){let pgs=this.pages,ix=pgs.indexOf(this.activePage);ix<=0||this.setActivePage(pgs[ix-1])},nextFinish(){if(this.nextDisabled())return;let pgs=this.pages,ix=pgs.indexOf(this.activePage);ix===pgs.length-1?this.finish?this.finish():console.error("The FinishCommand is not specified"):this.setActivePage(pgs[ix+1])},$nextPage(page){let ia=this.pages.indexOf(this.activePage);return this.pages.indexOf(page)===ia+1},$addPage(page){this.pages.push(page)},$removePage(page){let ix=this.pages.indexOf(page);-1!==ix&&this.pages.splice(ix,1)},$showHelp(){this.helpLink&&window.open(this.helpLink,"_blank")},_pendingValidate(){this.$forceUpdate()}},mounted(){this.pages.length>0&&(this.activePage=this.pages[0],this.activePage.state="edit")},created(){eventBus.$on("pendingValidate",this._pendingValidate)},beforeDestroy(){eventBus.$off("pendingValidate",this._pendingValidate)}}),Vue.component("a2-wizard-page",{template:'\n<div class="wizard-page" v-if="isActive">\n\t<slot />\n</div>\n',props:{header:String,descr:String},data:()=>({controls:[],state:"init",wasInvalid:!1,visit:!1}),computed:{isActive(){return this===this.$parent.activePage},isNextPage(){return $parent.$nextPage(this)},errorIcon(){return!!this.visit&&this.wasInvalid}},methods:{$invalid(){if(!this.controls.length)return this.wasInvalid=!1,!1;for(let c of this.controls)if(c.invalid())return this.wasInvalid=!0,!0;return this.wasInvalid=!1,!1},$registerControl(control){this.controls.push(control)},$unregisterControl(control){let ix=this.controls.indexOf(control);-1!==ix&&this.controls.splice(ix,1)}},created(){this.$parent.$addPage(this)},beforeDestroy(){this.controls.splice(0,this.controls.length)},destroyed(){this.$parent.$removePage(this)}})}(),function(){window.$$locale;const eventBus=require("std:eventBus"),toastrComponent={template:'\n<div class="toastr-stack" >\n\t<transition-group name="list" tag="ul">\n\t\t<a2-toast v-for="(t, k) in items":toast="t" :key="t.$index"></a2-toast>\n\t</transition-group>\n</div>\n',components:{"a2-toast":{template:'\n<li class="toast" :class="toast.style">\n\t<i class="ico" :class="icoCssClass"></i>\n\t<span v-text="toast.text" />\n</li>\n',props:{toast:Object},computed:{icoCssClass(){switch(this.toast.style){case"success":return"ico-check";case"danger":case"error":return"ico-error-outline-nocolor";case"warning":return"ico-warning-outline";case"info":return"ico-info-outline"}return"ico-dot"}}}},props:{},data:()=>({items:[],currentIndex:0}),methods:{showToast(toast){toast.$index=++this.currentIndex,this.items.unshift(toast),setTimeout(()=>{this.removeToast(toast.$index)},2e3)},removeToast(tstIndex){let ix=this.items.findIndex(x=>x.$index===tstIndex);-1!==ix&&this.items.splice(ix,1)}},created(){eventBus.$on("toast",this.showToast)}};app.components["std:toastr"]=toastrComponent}(),function(){const url=require("std:url"),utils=require("std:utils"),locale=window.$$locale;Vue.component("a2-image",{template:'\n<div class="a2-image">\n\t<img v-if="hasImage" :src="href" :style="cssStyle" @click.prevent="clickOnImage"/>\n\t<a class="remove-image" v-if="hasRemove" @click.prevent="removeImage">&#x2715;</a>\n\t<a2-upload v-if="isUploadVisible" :style=uploadStyle accept="image/*"\n\t\t:item=itemForUpload :base=base :prop=prop :new-item=newItem :tip=tip :read-only=readOnly :limit=limit :icon=icon></a2-upload>\n</div>\n',props:{base:String,item:Object,prop:String,newItem:Boolean,inArray:Boolean,source:Array,width:String,height:String,readOnly:Boolean,limit:Number,placeholder:String,icon:String},data:()=>({newElem:{}}),computed:{href:function(){if(this.newItem)return;let root=window.$$rootUrl,id=this.item[this.prop];if(!id)return;let qry={};return this.item._meta_&&this.item._meta_.$token&&(qry.token=this.item[this.item._meta_.$token]),url.combine(root,"_image",this.base,this.prop,id)+url.makeQueryString(qry)},tip(){return this.readOnly||this.placeholder?this.placeholder:locale.$ClickToDownloadPicture},cssStyle(){return{maxWidth:this.width,maxHeight:this.height}},uploadStyle(){let w={width:this.width,height:this.height};return w.width||(w.width=w.height),w.height||(w.height=w.width),w},hasImage(){return!!this.href},hasRemove(){return!this.readOnly&&this.hasImage},isUploadVisible:function(){return!!this.newItem||(this.readOnly?!this.hasImage:!this.inArray&&!this.item[this.prop])},itemForUpload(){return this.newItem?this.newElem:this.item}},methods:{removeImage:function(){this.inArray?this.item.$remove():this.item[this.prop]=void 0},clickOnImage:function(){}},created(){this.newItem&&this.source&&this.source.$new&&(this.newElem=this.source.$new())}}),Vue.component("a2-static-image",{template:'<img :src="href" :alt="alt"/>',props:{url:String,alt:String},computed:{href:function(){let root=window.$$rootUrl;return url.combine(root,"_static_image",this.url.replace(/\./g,"-"))}}}),Vue.component("a2-file-image",{template:'<img :src="href" :style="cssStyle" />',props:{url:String,width:String,height:String,value:[String,Number,Object]},computed:{href:function(){let root=window.$$rootUrl,id=this.value,qry={};return utils.isObjectExact(this.value)&&(id=utils.getStringId(this.value),this.value._meta_&&this.value._meta_.$token&&(qry.token=this.value[this.value._meta_.$token])),url.combine(root,"_file",this.url,id)+url.makeQueryString(qry)},cssStyle(){let r={};return this.width&&(r.maxWidth=this.width),this.height&&(r.maxHeight=this.height),r}}})}(),function(){const url=require("std:url"),http=require("std:http"),locale=window.$$locale,tools=require("std:tools");Vue.component("a2-file-upload",{template:'\n<div class="a2-file-upload">\n<label :class="cssClass" @dragover.prevent="dragOver" @dragleave.prevent="dragLeave">\n\t<input v-if=\'canUpload\' type="file" @change="uploadFile" v-bind:multiple="isMultiple" :accept="accept" ref="inputFile"/>\n\t<i class="ico ico-upload"></i>\n\t<span class="upload-tip" v-text="tip" v-if="tip"></span>\n</label>\n</div>\n',data:()=>({hover:!1}),props:{accept:String,url:String,source:Object,delegate:Function,errorDelegate:Function,argument:[Object,String,Number],limit:Number},computed:{cssClass(){return"file-upload"+(this.hover?" hover":"")},canUpload:()=>!0,isMultiple:()=>!1,tip(){return this.readOnly?"":locale.$ClickToDownloadFile}},methods:{dragOver(ev){this.hover=!0},dragLeave(ev){this.hover=!1},checkLimit(file){if(!this.limit)return!1;return file.size/1024>this.limit},uploadFile(ev){let root=window.$$rootUrl,uploadUrl=url.combine(root,"_file",this.url),na=this.argument?Object.assign({},this.argument):{Id:1};uploadUrl=url.createUrlForNavigate(uploadUrl,na);var fd=new FormData;for(let file of ev.target.files){if(this.checkLimit(file)){ev.target.value="";let msg=locale.$FileTooLarge.replace("{0}",this.limit);return void tools.alert(msg)}fd.append("file",file,file.name)}this.$refs.inputFile.value="",http.upload(uploadUrl,fd).then(result=>{ev.target.value="",this.delegate&&this.delegate(result)}).catch(msg=>{this.errorDelegate?this.errorDelegate(msg):0===msg.indexOf("UI:")?tools.alert(msg.substring(3).replace("\\n","\n")):alert(msg)})}}})}(),Vue.component("a2-taskpad",{template:'<div :class="cssClass">\n\t<a class="ico taskpad-collapse-handle" @click.stop="toggle"></a>\n\t<div v-if="expanded" class="taskpad-body">\n\t\t<slot>\n\t\t</slot>\n\t</div>\n\t<div v-else class="taskpad-title" @click.prevent="toggle">\n\t\t<span class="taskpad-label" v-text="tasksText"></span>\n\t</div>\n</div>\n',props:{title:String,initialCollapsed:Boolean},data:()=>({expanded:!0,__savedCols:""}),computed:{cssClass(){let cls="taskpad";return this.expanded?cls+=" expanded":cls+=" collapsed",cls},tasksText(){return this.title||window.$$locale.$Tasks}},methods:{setExpanded(exp){this.expanded=exp;let topStyle=this.$el.parentElement.style;this.expanded?topStyle.gridTemplateColumns=this.__savedCols:topStyle.gridTemplateColumns="1fr 36px"},toggle(){this.setExpanded(!this.expanded)}},mounted(){let topStyle=this.$el.parentElement.style;this.__savedCols=topStyle.gridTemplateColumns,this.initialCollapsed&&this.setExpanded(!1)}}),Vue.component("a2-panel",{template:'<div :class="cssClass" :test-id="testId">\n\t<div class="panel-header" @click.prevent="toggle" v-if="!noHeader">\n\t\t<slot name=\'header\'></slot>\n\t\t<span v-if="collapsible" class="ico panel-collapse-handle"></span>\n\t</div>\n\t<slot v-if="expanded"></slot>\n</div>\n',props:{initialCollapsed:Boolean,collapsible:Boolean,panelStyle:String,noHeader:Boolean,testId:String},data(){return{collapsed:this.initialCollapsed}},computed:{cssClass(){let cls="panel";if(this.collapsed?cls+=" collapsed":cls+=" expanded",this.panelStyle){let ps=this.panelStyle.toLowerCase();switch(ps){case"red":case"danger":case"error":cls+=" panel-red";break;case"info":case"cyan":cls+=" panel-cyan";break;case"green":case"success":cls+=" panel-green";break;case"warning":case"yellow":cls+=" panel-yellow";break;default:cls+=" panel-"+ps}}return cls},expanded(){return!this.collapsed}},methods:{toggle(){this.collapsible&&(this.collapsed=!this.collapsed)}}}),function(){const eventBus=require("std:eventBus");let __inlineStack=[];Vue.component("a2-inline-dialog",{template:'<div class="inline-modal-wrapper modal-animation-frame" v-if="visible" :class="{show: open}" v-cloak>\n\t<div class="modal-window modal-animation-window" :class="{loaded: open}" :style="dlgStyle">\n\t\t<slot></slot>\n\t</div>\n</div>\n',props:{dialogId:String,dialogTitle:String,width:String,noClose:Boolean},data:()=>({visible:!1,open:!1}),computed:{dlgStyle(){if(this.width)return{width:this.width}}},methods:{__keyUp(event){if(!this.noClose&&27===event.which){if(event.stopPropagation(),event.preventDefault(),__inlineStack.length&&__inlineStack[0]!==this.dialogId)return;setTimeout(()=>{eventBus.$emit("inlineDialog",{cmd:"close",id:this.dialogId})},1)}},__inlineEvent(opts){if(opts&&opts.id===this.dialogId)switch(opts.cmd){case"close":if(window.__requestsCount__>0)return;__inlineStack.shift(),this.open=!1,this.visible=!1,document.removeEventListener("keyup",this.__keyUp);break;case"open":this.visible=!0,__inlineStack.unshift(this.dialogId),document.addEventListener("keyup",this.__keyUp),setTimeout(()=>{this.open=!0},50);break;default:console.error(`invalid inline command '${opts.cmd}'`)}}},created(){eventBus.$on("inlineDialog",this.__inlineEvent)},beforeDestroy(){eventBus.$off("inlineDialog",this.__inlineEvent)}})}(),Vue.component("a2-sheet",{template:'\n<table class="sheet">\n\t<slot name="columns"></slot>\n\t<thead>\n\t\t<slot name="header"></slot>\n\t</thead>\n\t<slot name="col-shadow"></slot>\n\t<slot name="body"></slot>\n\t<tfoot>\n\t\t<slot name="footer"></slot>\n\t</tfoot>\n</table>\n'}),Vue.component("a2-sheet-section",{template:"\n<tbody>\n\t<slot></slot>\n</tbody>\n"}),Vue.component("a2-sheet-section-tree",{functional:!0,name:"a2-sheet-section",props:{itemsSource:Object,propName:String},render(h,ctx){const prop=ctx.props.propName,source=ctx.props.itemsSource;if(!source)return;if(!prop)return;function toggle(){let clpsed=this.item.$collapsed||!1;Vue.set(this.item,"$collapsed",!clpsed)}function cssClass(){let cls="";return this.hasChildren()&&(cls+="has-children"),this.item.$collapsed&&(cls+=" collapsed"),cls+=" lev-"+this.item.$level,cls}function rowCssClass(){let cls="";return this.hasChildren()&&(cls+=" group"),this.item.$collapsed&&(cls+=" collapsed"),cls}function indentCssClass(){return"indent lev-"+this.item.$level}function hasChildren(){let chElems=this.item[prop];return chElems&&chElems.length>0}const slot=ctx.data.scopedSlots.default;let compArr=[];for(let v of function*traverse(item,prop,lev){if(prop in item){let arr=item[prop];for(let i=0;i<arr.length;i++){let elem=arr[i];elem.$level=lev,yield elem,elem.$collapsed||(yield*traverse(elem,prop,lev+1))}}}(source,prop,1)){let slotElem=slot({item:v,toggle,cssClass,hasChildren,rowCssClass,indentCssClass})[0];compArr.push(h(slotElem.tag,slotElem.data,slotElem.children))}return h("tbody",{},compArr)}}),function(){const store=component("std:store"),eventBus=(require("std:url"),require("std:eventBus"));Vue.component("a2-new-button",{template:'<div class="dropdown dir-down a2-new-btn separate" v-dropdown v-if="isVisible">\n\t<button class="btn btn-icon" :class="btnClass" toggle aria-label="New"><i class="ico" :class="iconClass"></i></button>\n\t<div class="dropdown-menu menu down-left">\n\t\t<div class="super-menu" :class="cssClass">\n\t\t\t<div v-for="(m, mx) in topMenu" :key="mx" class="menu-group">\n\t\t\t\t<div class="group-title" v-text="m.Name"></div>\n\t\t\t\t<template v-for="(itm, ix) in m.Menu">\n\t\t\t\t\t<div class="divider" v-if=isDivider(itm)></div>\n\t\t\t\t\t<a v-else @click.prevent=\'doCommand(itm.Url, itm.Params)\' \n\t\t\t\t\t\tclass="dropdown-item" tabindex="-1"><i class="ico" :class="\'ico-\' + itm.Icon"></i><span v-text="itm.Name"></span></a>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n',store,props:{menu:Array,icon:String,btnStyle:String},computed:{isVisible(){return!!this.menu},topMenu(){return this.menu?this.menu[0].Menu:null},iconClass(){return this.icon?"ico-"+this.icon:""},btnClass(){return this.btnStyle?"btn-"+this.btnStyle:""},columns(){let descr=this.menu?this.menu[0].Params:"";if(!descr)return 1;try{return+JSON.parse(descr).columns||1}catch(err){return 1}},cssClass(){return"cols-"+this.columns}},created(){},methods:{isDivider:itm=>"-"===itm.Name,doCommand(cmd,strOpts){let requeryAfter=!1;if(strOpts)try{requeryAfter=JSON.parse(strOpts).requeryAfter}catch(err){requeryAfter=!1}(cmd=cmd||"").startsWith("navigate:")?this.navigate(cmd.substring(9)):cmd.startsWith("dialog:")?this.dialog(cmd.substring(7),requeryAfter):alert("invalid command:"+cmd)},navigate(url){this.$store.commit("navigate",{url})},dialog(url,requeryAfter){const dlgData={promise:null};eventBus.$emit("modaldirect",url,dlgData),dlgData.promise.then((function(result){requeryAfter&&eventBus.$emit("requery",url,dlgData)}))}}})}(),Vue.component("a2-company-button",{template:'<div class="a2-company-btn"><div class="dropdown dir-down separate" v-dropdown v-if="isVisible">\n\t<button class="btn btn-companyname" toggle aria-label="Company">\n\t\t<i class="ico ico-home"></i>\n\t\t<span class="company-name" v-text=companyName></span>\n\t\t<span class="caret"/>\n\t</button>\n\t<div class="dropdown-menu menu down-left">\n\t\t<a v-for="comp in source" @click.prevent="selectCompany(comp)" href="" tabindex="-1" class="dropdown-item">\n\t\t\t<i class="ico" :class="icoClass(comp)"/><span class="company-menu-name" v-text="comp.Name"/>\n\t\t</a>\n\t\t<template v-if="hasLinks">\n\t\t\t<div class="divider"/>\n\t\t\t<a v-for="link in links" @click.prevent="gotoLink(link)" href="" tabindex="-1" class="dropdown-item">\n\t\t\t\t<i class="ico" :class="linkClass(link)"/><span v-text="link.Name" />\n\t\t\t</a>\n\t\t</template>\n\t</div>\n</div></div>\n',props:{source:Array,links:Array},computed:{isVisible(){return this.source.length>0},hasLinks(){return this.links&&this.links.length},companyName(){if(0===this.source.length)return"";let comp=this.source.find(x=>x.Current);return comp?comp.Name:"*** UNSELECTED ***"}},methods:{selectCompany(comp){const http=require("std:http"),urlTools=require("std:url"),rootUrl=window.$$rootUrl,data=JSON.stringify({company:comp.Id});http.post(urlTools.combine(rootUrl,"_application/switchtocompany"),data).then(x=>{window.location.assign(urlTools.combine(rootUrl,"/"))}).catch(err=>{alert(err)})},gotoLink(link){const store=component("std:store");store&&store.commit("navigate",{url:link.Url})},icoClass:cmp=>cmp.Current?"ico-check":"ico-none",linkClass:link=>"ico-"+(link.Icon||"none")}}),function(){let graphId=1237;Vue.component("a2-graphics",{template:'<div :id="id" class="a2-graphics" ref=canvas></div>',props:{render:Function,arg:[Object,String,Number,Array,Boolean,Date],watchmode:String},data:()=>({unwatch:null,id:(graphId+=1,"el-gr-"+graphId)}),computed:{controller(){return this.$root}},methods:{draw(){const domElem=this.$refs.canvas,chart=d3.select(domElem);chart.selectAll("*").remove(),this.render.call(this.controller.$data,chart,this.arg,domElem)}},mounted(){if(this.$nextTick(()=>this.draw()),"none"===this.watchmode)return;let deep="deep"===this.watchmode;this.unwatch=this.$watch("arg",()=>this.draw(),{deep})},beforeDestroy(){this.unwatch&&this.unwatch();d3.select("#"+this.id).selectAll("*").remove(),this.$el.remove()}})}(),function(){const http=require("std:http"),urlTools=require("std:url"),eventBus=require("std:eventBus"),locale=window.$$locale,isZero=require("std:utils").date.isZero,specKeys={$vm:null,$ctrl:null,$host:null,$root:null,$parent:null,$items:null};const traceItem={name:"a2-trace-item",template:'\n<div v-if="hasElem" class="trace-item-body">\n\t<span class="title" v-text="name"/><span class="badge" v-text="elem.length"/>\n\t<ul class="a2-debug-trace-item">\n\t\t<li v-for="itm in elem">\n\t\t\t<div class="rq-title"><span class="elapsed" v-text="itm.elapsed + \' ms\'"/> <span v-text="itm.text"/></div>\n\t\t</li>\n\t</ul>\n</div>',props:{name:String,elem:Array},computed:{hasElem(){return this.elem&&this.elem.length}}};Vue.component("a2-debug",{template:'\n<div class="debug-panel" v-if="paneVisible" :class="panelClass">\n\t<div class="debug-pane-header">\n\t\t<span class="debug-pane-title" v-text="title"></span>\n\t\t<a class="btn btn-close" @click.prevent="close">&#x2715</a>\n\t</div>\n\t<div class="toolbar">\n\t\t<button class="btn btn-tb" @click.prevent="refresh"><i class="ico ico-reload"></i> {{text(\'$Refresh\')}}</button>\n\t\t<div class="aligner"></div>\n\t\t<button class="btn btn-tb" @click.prevent="toggle"><i class="ico" :class="toggleIcon"></i></button>\n\t</div>\n\t<div class="debug-model debug-body" v-if="modelVisible">\n\t\t<pre class="a2-code" v-text="modelJson()"></pre>\n\t</div>\n\t<div class="debug-trace debug-body" v-if="traceVisible">\n\t\t<ul class="a2-debug-trace">\n\t\t\t<li v-for="r in trace">\n\t\t\t\t<div class="rq-title"><span class="elapsed" v-text="r.elapsed + \' ms\'"/> <span v-text="r.url" /></div>\n\t\t\t\t<a2-trace-item name="Sql" :elem="r.items.Sql"></a2-trace-item>\n\t\t\t\t<a2-trace-item name="Render" :elem="r.items.Render"></a2-trace-item>\n\t\t\t\t<a2-trace-item name="Report" :elem="r.items.Report"></a2-trace-item>\n\t\t\t\t<a2-trace-item name="Workflow" :elem="r.items.Workflow"></a2-trace-item>\n\t\t\t\t<a2-trace-item class="exception" name="Exceptions" :elem="r.items.Exception"></a2-trace-item>\n\t\t\t</li>\n\t\t</ul>\n\t</div>\n</div>\n',components:{"a2-trace-item":traceItem},props:{modelVisible:Boolean,traceVisible:Boolean,modelStack:Array,counter:Number,close:Function},data:()=>({trace:[],left:!1}),computed:{refreshCount(){return this.counter},paneVisible(){return this.modelVisible||this.traceVisible},title(){return this.modelVisible?locale.$DataModel:this.traceVisible?locale.$Profiling:""},traceView(){return this.traceVisible},toggleIcon(){return this.left?"ico-pane-right":"ico-pane-left"},panelClass(){return this.left?"left":"right"}},methods:{modelJson(){var data;if(this.modelVisible)return this.modelStack.length?(data=this.modelStack[0].$data,JSON.stringify(data,(function(key,value){return"$"===key[0]?key in specKeys?void 0:value:"_"!==key[0]?isZero(this[key])?null:value:void 0}),2)):""},refresh(){this.modelVisible?this.$forceUpdate():this.traceVisible&&this.loadTrace()},toggle(){this.left=!this.left},loadTrace(){const root=window.$$rootUrl,url=urlTools.combine(root,"_shell/trace"),that=this;http.post(url,null,null,!0).then((function(result){that.trace.splice(0,that.trace.length),result&&result.forEach(val=>{that.trace.push(val)})}))},text:key=>locale[key]},watch:{refreshCount(){this.$forceUpdate()},traceView(newVal){newVal&&this.loadTrace()}},created(){eventBus.$on("endRequest",url=>{-1===url.indexOf("/_shell/trace")&&this.traceVisible&&this.loadTrace()})}})}(),function(){const dataService=require("std:dataservice"),urlTools=require("std:url"),locale=window.$$locale,utils=require("std:utils");Vue.component("a2-feedback",{template:'\n<div class="feedback-panel" v-if="visible">\n    <div class="feedback-pane-header">\n        <span class="feedback-pane-title" v-text="source.title"></span>\n        <a class="btn btn-close" @click.prevent="close">&#x2715</a>\n    </div>\n    <div class="feedback-body">\n\t\t<template v-if="shown">\n\t\t\t<div v-html="source.promptText"></div>\n\t\t\t<div style="margin-bottom:20px" />\n\t\t\t<div class="control-group" style="">\n\t\t\t\t<label v-html="source.labelText" /> \n\t\t\t\t<div class="input-group">\n\t\t\t\t\t<textarea rows="5" maxlength="2048" v-model="value" style="height: 92px;max-height:400px" v-auto-size="true" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button class="btn btn-primary" :disabled="noValue" @click.prevent="submit" v-text="source.buttonText" />\n\t\t\t<include v-if="source.externalFragment" :src="source.externalFragment"/>\n\t\t\t\n\t\t</template>\n\t\t<template v-else>\n\t\t\t<div class="thanks" v-html="source.thanks" />\n\t\t\t<button class="btn btn-primary" @click.prevent="close" v-text="closeText" />\n\t\t</template>\n\t</div>\n</div>\n',components:{},props:{visible:Boolean,modelStack:Array,close:Function,source:Object},data:()=>({value:"",shown:!0}),computed:{noValue(){return!this.value},closeText:()=>locale.$Close},methods:{text:key=>locale[key],refresh(){},loadfeedbacks(){},submit(){const root=window.$$rootUrl,url=urlTools.combine(root,"_shell/savefeedback"),that=this;let jsonData=utils.toJson({text:this.value});dataService.post(url,jsonData).then((function(result){that.shown=!1,that.value=""})).catch((function(result){console.dir(result),that.$parent.$alert(that.source.alert),that.close()}))}},watch:{visible(val){val&&(this.shown=!0,this.value="",this.loadfeedbacks())}},created(){}})}(),function(){const documentTitle={render:()=>null,props:["page-title"],watch:{pageTitle(newValue){this.setTitle()}},methods:{setTitle(){this.pageTitle&&(document.title=this.pageTitle)}},created(){this.setTitle()}};app.components["std:doctitle"]=documentTitle}(),Vue.component("a2-span-sum",{props:{content:[String,Number],dir:Number},render(h,ctx){let children=[];children.push(h("span",{domProps:{innerText:this.content}}));let dcls="span-sum ";return this.dir>0?(children.push(h("i",{class:"ico ico-arrow-up-green"})),dcls+="in"):this.dir<0?(children.push(h("i",{class:"ico ico-arrow-down-red"})),dcls+="out"):0===this.dir&&(children.push(h("i",{class:"ico ico-arrow-sort"})),dcls+="inout"),h("span",{class:dcls},children)}}),function(){const utils=require("std:utils");Vue.component("mega-menu",{template:'<div class="dropdown-menu menu" role="menu">\n\t<div class="super-menu" :class="cssClass" :style="cssStyle">\n\t\t<div v-for="(m, mx) of topMenu" :key="mx" class="menu-group">\n\t\t\t<div class="group-title" v-text="m.Name"></div>\n\t\t\t<template v-for="(itm, ix) in m.menu">\n\t\t\t\t<div class="divider" v-if=isDivider(itm) ></div>\n\t\t\t\t<slot name="item" :menuItem="itm" v-else></slot>\n\t\t\t</template>\n\t\t</div>\n\t</div>\n</div>\n',props:{itemsSource:Array,groupBy:String,columns:Number,width:String},data:()=>({}),computed:{cssClass(){let cls="cols-"+(this.columns||1);return this.width&&(cls+=" with-width"),cls},cssStyle(){if(this.width)return{width:this.width}},topMenu(){return this.itemsSource?this.itemsSource.reduce((acc,itm)=>{let g=utils.simpleEval(itm,this.groupBy)||"",ma=acc[g];return ma?ma.menu.push(itm):acc[g]={Name:g,menu:[itm]},acc},{}):{}}},methods:{isDivider:itm=>"-"===itm.Name}})}(),function(){const eventBus=require("std:eventBus");Vue.component("a2-iframe-target",{template:'\n<div class="frame-stack" v-if="visible">\n\t<iframe width="100%" height="100%" :src="iFrameUrl" frameborder="0" />\n</div>\n',data:()=>({iFrameUrl:""}),computed:{visible(){return!!this.iFrameUrl}},created(){eventBus.$on("openframe",url=>{alert(url),this.iFrameUrl=url})}})}(),Vue.directive("autoSize",{bind(el,binding,vnode){binding.value&&(el.style.overflowY=!1,el._ops={initHeight:-1,extraSpace:0},el._autosize=function(){if(!el.offsetHeight)return;const ops=el._ops;-1===ops.initHeight&&(ops.initHeight=el.offsetHeight),el.style.height=ops.initHeight+"px";var needHeight=el.scrollHeight+ops.extraSpace;needHeight>ops.initHeight&&(el.style.height=needHeight+"px")},el.addEventListener("input",(function(){el._autosize()})),el.addEventListener("autosize",(function(){Vue.nextTick(()=>el._autosize())})))},inserted(el,binding){if(!binding.value)return;let style=window.getComputedStyle(el),es=parseFloat(style.borderTopWidth)+parseFloat(style.borderBottomWidth);el._ops.extraSpace=es,setTimeout(()=>el._autosize(),1)}}),Vue.directive("disable",{bind(el,binding,vnode){el.addEventListener("click",(function(event){if(this.getAttribute("disabled"))return event.preventDefault(),event.stopImmediatePropagation(),!1}),!0)}}),Vue.directive("dropdown",{bind(el,binding,vnode){const popup=require("std:popup");el._btn=el.querySelector("[toggle]"),el.setAttribute("dropdown-top",""),el._btn||console.error("DropDown does not have a toggle element"),popup.registerPopup(el),el._close=function(ev){el._hide&&el._hide(),el.classList.remove("show")},el.addEventListener("click",(function(event){let trg=event.target;if(!el._btn.disabled){for(;trg&&trg!==el._btn;){if(trg===el)return;trg=trg.parentElement}if(trg===el._btn){if(event.preventDefault(),event.stopPropagation(),el.classList.contains("show"))el._hide&&el._hide(),el.classList.remove("show");else{let outer=popup.closest(el,".popup-body");outer?popup.closeInside(outer):popup.closeAll(),el._show&&el._show(),el.classList.add("show")}}}}))},unbind(el){require("std:popup").unregisterPopup(el)}}),Vue.directive("focus",{bind(el,binding,vnode){function doSelect(t){t.select&&(t._selectDone||(t.select(),t._selectDone=!0))}el.addEventListener("focus",(function(event){if(event.target.parentElement.classList.add("focus"),el.__opts&&el.__opts.mask)return;let target=event.target;target._selectDone=!1,setTimeout(()=>{doSelect(target)},0)}),!1),el.addEventListener("blur",(function(event){let t=event.target;t._selectDone=!0,t.parentElement.classList.remove("focus")}),!1),el.addEventListener("click",(function(event){el.__opts&&el.__opts.mask||doSelect(event.target)}),!1)},inserted(el){el._selectDone=!1,1===el.tabIndex&&setTimeout(()=>{el.focus&&el.focus(),el.select&&el.select()},0)}}),Vue.directive("settabindex",{inserted(el){1===el.tabIndex&&setTimeout(()=>{el.focus&&el.focus()},0)}}),function(){function updateLazy(arr){arr&&arr.$loadLazy&&arr.$loadLazy()}Vue.directive("lazy",{componentUpdated(el,binding,vnode){updateLazy(binding.value)},inserted(el,binding,vnode){updateLazy(binding.value)}})}(),function(){const pageStyle=Symbol();let bindVal=null,elemStyle=null;function createStyleText(zoom){if(!bindVal)return null;let stv=`@media print {@page {size: ${bindVal.pageSize||"A4"} ${bindVal.orientation}; margin:${bindVal.margin};}`;return(zoom=zoom||bindVal.zoom)&&(stv+=`.sheet-page > .sheet { zoom: ${zoom}; width: 1px;} .print-target {zoom: ${zoom}}`),stv+="}",stv}function printEvent(ev){if(function(){let el=document.getElementsByClassName("with-wrapper");if(el&&el.length){el[0].scrollTo(0,0)}}(),!bindVal)return;if("auto"!=bindVal.zoom)return;let ecls=document.getElementsByClassName("sheet");if(!ecls||!ecls.length)return;let tbl=ecls[0],pageSize={w:210,h:297},margin_t=10,margin_r=10,margin_b=10,margin_l=10;"landscape"===bindVal.orientation&&([pageSize.w,pageSize.h]=[pageSize.h,pageSize.w]);let k=function(){let div=document.createElement("div");div.classList.add("mm-100-100"),document.body.appendChild(div);let rv={w:(div.clientWidth-5)/100,h:(div.clientHeight-5)/100};return document.body.removeChild(div),rv}(),wx=tbl.clientWidth/k.w,hy=tbl.clientHeight/k.h,zx=(pageSize.w-margin_l-margin_r-5)/wx,zy=(pageSize.h-margin_t-margin_b-5)/hy,z=Math.round(1e3*Math.min(zx,zy))/1e3;elemStyle.innerHTML=createStyleText(z)}Vue.directive("page-orientation",{bind(el,binding){bindVal=null,elemStyle=null;let style=document.createElement("style");style.innerHTML=`@page {size: A4 ${binding.value}; margin:1cm;}`,document.head.appendChild(style),el[pageStyle]=style},unbind(el){let style=el[pageStyle];style&&document.head.removeChild(style)}}),Vue.directive("print-page",{bind(el,binding){let val=binding.value;bindVal=val;let stv=createStyleText();if(stv){let style=document.createElement("style");style.innerHTML=stv,elemStyle=document.head.appendChild(style),el[pageStyle]=style}window.addEventListener("beforeprint",printEvent)},unbind(el){let style=el[pageStyle];style&&document.head.removeChild(style),window.removeEventListener("beforeprint",printEvent)}})}(),Vue.directive("resize",{unbind(el,binding,vnode){let p=el._parts;p.mouseDown&&el.removeEventListener("mousedown",p.mouseDown,!1)},update(el){if(!el._parts)return;let p=el._parts;if(p.init)return;p.init=!0;let dataMinWidth=el.getAttribute("data-min-width"),secondMinWidth=el.getAttribute("second-min-width"),firstPaneWidth=el.getAttribute("first-pane-width");p.minWidth=getPixelWidth(p.grid,dataMinWidth),p.minWidth2=getPixelWidth(p.grid,secondMinWidth),p.firstWidth=getPixelWidth(p.grid,firstPaneWidth);let p1w=Math.max(p.minWidth,p.firstWidth);function getPixelWidth(grid,w){if(-1!==(w=w||"").indexOf("px"))return Number.parseFloat(w);let temp=document.createElement("div");temp.style.width=w,temp.style.position="absolute",temp.style.visibility="hidden",document.body.appendChild(temp);let cw=temp.clientWidth;return temp.remove(),cw?isNaN(cw)?20:cw:20}p.grid.style.gridTemplateColumns=`${p1w}px ${p.handleWidth}px 1fr`,p.grid.style.visibility="visible"},inserted(el,binding,vnode){let grid=el.parentElement,parts={handleWidth:6,grid,handle:findHandle(grid),resizing:!1,firstWidth:0,minWidth:0,minWidth2:0,delta:0,mouseDown,init:!1,offsetX(event,useDx){let dx=this.delta,rc=this.grid.getBoundingClientRect();if(useDx){let rt=event.target.getBoundingClientRect();dx=event.clientX-rt.left,this.delta=dx}return event.clientX-rc.left-dx},fitX(x){x<this.minWidth&&(x=this.minWidth);let tcx=this.grid.clientWidth;return x+this.handleWidth+this.minWidth2>tcx&&(x=tcx-this.minWidth2-this.handleWidth),x}};function mouseUp(event){let p=el._parts;if(!p.resizing)return;event.preventDefault(),p.handle.style.display="none",p.grid.style.cursor="default";let x=p.offsetX(event,!1);x=p.fitX(x),p.grid.style.gridTemplateColumns=`${x}px ${p.handleWidth}px 1fr`,document.removeEventListener("mouseup",mouseUp),document.removeEventListener("mousemove",mouseMove),p.resizing=!1}function mouseMove(event){let p=el._parts;if(!p.resizing)return;event.preventDefault();let x=p.offsetX(event,!1);x=p.fitX(x),p.handle.style.left=x+"px"}function mouseDown(event){let p=el._parts;if(p.resizing)return;if(!p.handle)return;if(!event.target.classList.contains("spl-handle"))return void console.error("click out of splitter handle");event.preventDefault();let x=p.offsetX(event,!0);p.handle.style.left=x+"px",p.handle.style.display="block",p.grid.style.cursor="w-resize",document.addEventListener("mouseup",mouseUp,!1),document.addEventListener("mousemove",mouseMove,!1),p.resizing=!0}el._parts=parts,el.addEventListener("mousedown",mouseDown,!1)}}),function(){const eventBus=require("std:eventBus"),utils=require("std:utils"),dataservice=require("std:dataservice"),urltools=require("std:url"),log=require("std:log",!0),locale=window.$$locale,mask=require("std:mask"),modelInfo=require("std:modelInfo"),platform=require("std:platform"),htmlTools=require("std:html",!0),store=component("std:store"),documentTitle=component("std:doctitle",!0);let __updateStartTime=0,__createStartTime=0;function __runDialog(url,arg,query,cb){return new Promise((function(resolve,reject){const dlgData={promise:null,data:arg,query,rd:!0};eventBus.$emit("modal",url,dlgData),dlgData.promise.then((function(result){cb(result),resolve(result)}))}))}function makeErrors(errs){let ra=[];for(let x of errs)for(let y of x.e)ra.push(y.msg);return ra.length?ra:null}function isPermissionsDisabled(opts,arg){if(opts&&opts.checkPermission&&utils.isObjectExact(arg)&&arg.$permissions){let perm=arg.$permissions,prop=opts.checkPermission;if(prop in perm){if(!perm[prop])return!0}else console.error(`invalid permssion name: '${prop}'`)}return!1}const base=Vue.extend({store,components:{"a2-document-title":documentTitle},data:()=>({__init__:!0,__baseUrl__:"",__baseQuery__:{},__requestsCount__:0,__lockQuery__:!0,__testId__:null}),computed:{$baseUrl(){return this.$data.__baseUrl__},$baseQuery(){return this.$data.__baseQuery__},$indirectUrl(){return this.$data.__modelInfo.__indirectUrl__||""},$query(){return this.$data._query_},$jsonQuery(){return utils.toJson(this.$data.Query)},$isDirty(){return this.$data.$dirty},$isPristine(){return!this.$data.$dirty},$isLoading(){return this.$data.__requestsCount__>0},$modelInfo(){return this.$data.__modelInfo},$canSave(){return this.$isDirty&&!this.$isLoading}},watch:{$jsonQuery(newData,oldData){this.$nextTick(()=>this.$reload())}},methods:{$marker:()=>!0,$exec(cmd,arg,confirm,opts){if(this.$isReadOnly(opts))return;if(this.$isLoading)return;if(isPermissionsDisabled(opts,arg))return void this.$alert(locale.$PermissionDenied);return this.$data._exec_(cmd,arg,confirm,opts)},$toJson:data=>utils.toJson(data),$maxChars:(text,length)=>utils.text.maxChars(text,length),$isReadOnly(opts){return opts&&opts.checkReadOnly&&this.$data.$readOnly},$execSelected(cmd,arg,confirm){if(this.$isLoading)return;let root=this.$data;utils.isArray(arg)?confirm?this.$confirm(confirm).then(()=>root._exec_(cmd,arg.$selected)):root._exec_(cmd,arg.$selected):console.error("Invalid argument for $execSelected")},$canExecute(cmd,arg,opts){if(this.$isReadOnly(opts))return!1;return this.$data._canExec_(cmd,arg,opts)},$setCurrentUrl(url){this.inDialog&&(url=urltools.combine("_dialog",url)),this.$data.__baseUrl__=url,eventBus.$emit("modalSetBase",url)},$save(opts){if(this.$data.$readOnly)return;let self=this;let url=`${window.$$rootUrl}/${require("std:routing").dataUrl()}/save`,urlToSave=this.$indirectUrl||this.$baseUrl;const isCopy=this.$data.$isCopy;if(!!opts&&opts.options&&opts.options.validRequired&&this.$data.$invalid){let errs=makeErrors(this.$data.$forceValidate());return void this.$alert(locale.$MakeValidFirst,void 0,errs)}self.$data.$emit("Model.beforeSave",self.$data);let saveSels=self.$data._saveSelections();return new Promise((function(resolve,reject){let jsonData=utils.toJson({baseUrl:urlToSave,data:self.$data}),wasNew=urltools.isNewPath(self.$baseUrl);dataservice.post(url,jsonData).then((function(data){if(self.__destroyed__)return;let dataToResolve,newId;self.$data.$merge(data,!0,!0),self.$data.$emit("Model.saved",self.$data),self.$data.$setDirty(!1);for(let p in data)if(dataToResolve=data[p],newId=self.$data[p].$id,dataToResolve)break;wasNew&&newId?(self.inDialog||self.$store.commit("setnewid",{id:newId}),self.$data.__baseUrl__=urltools.replaceSegment(self.$data.__baseUrl__,newId)):isCopy&&(self.inDialog||self.$store.commit("setnewid",{id:newId,action:"edit"}),self.$data.__baseUrl__=urltools.replaceSegment(self.$data.__baseUrl__,newId,"edit")),self.$data._restoreSelections(saveSels),resolve(dataToResolve);let toast=opts&&opts.toast?opts.toast:null;toast&&self.$toast(toast),self.$notifyOwner(newId,toast)})).catch((function(msg){self.$alertUi(msg)}))}))},$notifyOwner(id,toast){if(!window.opener)return;if(!window.$$token)return;let rq=window.opener.require;if(!rq)return;const bus=rq("std:eventBus");if(!bus)return;let dat={token:window.$$token.token,update:window.$$token.update,toast:toast||null,id};bus.$emit("childrenSaved",dat)},$invoke(cmd,data,base,opts){let self=this;let url=`${window.$$rootUrl}/${require("std:routing").dataUrl()}/invoke`,baseUrl=self.$indirectUrl||self.$baseUrl;return base&&(baseUrl=urltools.combine("_page",base,"index",0)),new Promise((function(resolve,reject){var jsonData=utils.toJson({cmd,baseUrl,data});dataservice.post(url,jsonData).then((function(data){if(!self.__destroyed__)if(utils.isObject(data))resolve(data);else{if(!utils.isString(data))throw new Error("Invalid response type for $invoke");resolve(data)}})).catch((function(msg){opts&&opts.catchError?reject(msg):self.$alertUi(msg)}))}))},$asyncValid(cmd,data){const vm=this,cache=vm.__asyncCache__,djson=JSON.stringify(data);let val=cache[cmd];return val||(val={data:"",result:null},cache[cmd]=val),val.data===djson?val.result:(val.data=djson,new Promise((function(resolve,reject){vm.__destroyed__||Vue.nextTick(()=>{vm.$invoke(cmd,data).then(result=>{vm.__destroyed__||(val.result=result.Result.Value,resolve(val.result))})})})))},$reload(args){let self=this;if(utils.isArray(args)&&args.$isLazy()){let propIx=args._path_.lastIndexOf("."),prop=args._path_.substring(propIx+1);return args.$loaded=!1,self.$loadLazy(args.$parent,prop)}let url=`${window.$$rootUrl}/${require("std:routing").dataUrl()}/reload`,dat=self.$data,mi=args?modelInfo.get(args.$ModelInfo):null;if(!args&&!mi){let modInfo=this.$data._findRootModelInfo();modInfo&&(mi=modelInfo.get(modInfo))}let saveSels=dat._saveSelections();return new Promise((function(resolve,reject){let dataToQuery={baseUrl:urltools.replaceUrlQuery(self.$baseUrl,mi)};if(utils.isDefined(dat.Query)){dataToQuery.baseUrl=urltools.replaceUrlQuery(self.$baseUrl,dat.Query);let newUrl=urltools.replaceUrlQuery(null,dat.Query);window.history.replaceState(null,null,newUrl)}let jsonData=utils.toJson(dataToQuery);dataservice.post(url,jsonData).then((function(data){if(!self.__destroyed__){if(!utils.isObject(data))throw new Error("Invalid response type for $reload");dat.$merge(data,!0),modelInfo.reconcileAll(data.$ModelInfo),dat._setModelInfo_(void 0,data),dat._setRuntimeInfo_(data.$runtime),dat._fireLoad_(),dat._restoreSelections(saveSels),resolve(dat)}})).catch((function(msg){self.$alertUi(msg)}))}))},$requery(){this.inDialog?eventBus.$emit("modalRequery",this.$baseUrl):eventBus.$emit("requery")},$remove(item,confirm){this.$data.$readOnly||this.$isLoading||(confirm?this.$confirm(confirm).then(()=>item.$remove()):item.$remove())},$removeSelected(arr,confirm){if(utils.isArray(arr)||console.error("$removeSelected. The argument is not an array"),this.$data.$readOnly)return;let item=arr.$selected;item&&this.$remove(item,confirm)},$mailto(arg,subject){let href="mailto:"+arg;return subject&&(href+="?subject="+urltools.encodeUrl(subject)),href},$href:(url,data)=>urltools.createUrlForNavigate(url,data),$navigate(url,data,newWindow,update,opts){if(this.$isReadOnly(opts))return;eventBus.$emit("closeAllPopups");let urlToNavigate=urltools.createUrlForNavigate(url,data);if(!0===newWindow){let nwin=window.open(urlToNavigate,"_blank");nwin&&(nwin.$$token={token:this.__currentToken__,update})}else this.$store.commit("navigate",{url:urlToNavigate})},$navigateSimple(url,newWindow,update){if(!0===newWindow){let nwin=window.open(url,"_blank");nwin&&(nwin.$$token={token:this.__currentToken__,update})}else this.$store.commit("navigate",{url})},$navigateExternal(url,newWindow){!0===newWindow?window.open(url,"_blank"):window.location.assign(url)},$download(url){const root=window.$$rootUrl;url=urltools.combine("/file",url.replace(".","-")),window.location=root+url},$file(url,arg,opts){const root=window.$$rootUrl;let id=arg,token=void 0;arg&&utils.isObject(arg)&&(id=utils.getStringId(arg),arg._meta_&&arg._meta_.$token&&(token=arg[arg._meta_.$token]));let fileUrl=urltools.combine(root,"_file",url,id),qry={},action=(opts||{}).action;switch(token&&(qry.token=token),"download"==action&&(qry.export=1),fileUrl+=urltools.makeQueryString(qry),action){case"download":htmlTools.downloadUrl(fileUrl);break;case"print":htmlTools.printDirect(fileUrl);break;default:window.open(fileUrl,"_blank")}},$attachment(url,arg,opts){const root=window.$$rootUrl;let cmd=opts&&opts.export?"export":"show",id=arg,token=void 0;arg&&utils.isObject(arg)&&(id=utils.getStringId(arg),arg._meta_&&arg._meta_.$token&&(token=arg[arg._meta_.$token]));let attUrl=urltools.combine(root,"attachment",cmd,id),qry={base:url};token&&(qry.token=token),attUrl+=urltools.makeQueryString(qry),opts&&opts.newWindow?window.open(attUrl,"_blank"):window.location.assign(attUrl)},$eusign(baseurl,arg){window.$$rootUrl;var url;(url="/eusign/index",new Promise((function(resolve,reject){const dlgData={promise:null,data:arg,query:{base:baseurl},raw:!0};eventBus.$emit("modal",url,dlgData),dlgData.promise.then((function(result){cb(result),resolve(result)}))}))).then((function(resolve,reject){alert("promise resolved")}))},$dbRemove(elem,confirm,opts){if(!elem)return;if(isPermissionsDisabled(opts,elem))return void this.$alert(locale.$PermissionDenied);if(this.$isLoading)return;let id=elem.$id,lazy=!!elem.$parent.$isLazy&&elem.$parent.$isLazy(),root=window.$$rootUrl;const self=this;function dbRemove(){let postUrl=root+"/_data/dbRemove",jsonObj={baseUrl:self.$baseUrl,id};lazy&&(jsonObj.prop=function(path){let pos=path.lastIndexOf(".");if(-1!==pos)return path.substring(pos+1)}(elem.$parent._path_));let jsonData=utils.toJson(jsonObj);dataservice.post(postUrl,jsonData).then((function(data){self.__destroyed__||elem.$remove()})).catch((function(msg){self.$alertUi(msg)}))}confirm?this.$confirm(confirm).then((function(){dbRemove()})):dbRemove()},$dbRemoveSelected(arr,confirm,opts){if(this.$isLoading)return;let sel=arr.$selected;sel&&this.$dbRemove(sel,confirm,opts)},$openSelectedFrame(url,arr){url=url||"";let sel=arr.$selected;if(!sel)return;let urlToNavigate=urltools.createUrlForNavigate(url,sel.$id);eventBus.$emit("openframe",urlToNavigate)},$openSelected(url,arr,newwin,update){url=url||"";let sel=arr.$selected;if(sel){if(url.startsWith("{")){url=url.substring(1,url.length-1);let nUrl=utils.eval(sel,url);if(!nUrl)throw new Error(`Property '${url}' not found in ${sel.constructor.name} object`);url=nUrl}this.$navigate(url,sel.$id,newwin,update)}},$hasSelected(arr,opts){if(opts&&opts.validRequired){if(!this.$data.$valid)return!1}return arr&&!!arr.$selected},$hasChecked:arr=>arr&&arr.$checked&&arr.$checked.length,$sanitize:text=>utils.text.sanitize(text),$confirm(prms){utils.isString(prms)&&(prms={message:prms}),prms.style=prms.style||"confirm",prms.message=prms.message||prms.msg;let dlgData={promise:null,data:prms};return eventBus.$emit("confirm",dlgData),dlgData.promise},$focus(htmlid){let elem=document.querySelector("#"+htmlid);if(!elem)return;let ch=elem.querySelector("input, textarea, button, select");this.$defer(()=>{ch&&ch.focus?ch.focus():elem.focus&&elem.focus()})},$msg(msg,title,style){let prms={message:msg,title:title||locale.$Message,style:style||"info"};return this.$confirm(prms)},$alert(msg,title,list){if(utils.isObject(msg)&&!title&&!list){let prms=msg;msg=prms.message||prms.msg,title=prms.title,list=prms.list}let dlgData={promise:null,data:{message:msg,title,style:"alert",list}};return eventBus.$emit("confirm",dlgData),dlgData.promise},$alertUi(msg){msg instanceof Error?alert(msg.message):0===msg.indexOf("UI:")?this.$alert(msg.substring(3).replace("\\n","\n")):alert(msg)},$toast(toast,style){toast&&(utils.isString(toast)&&(toast={text:toast,style:style||"success"}),eventBus.$emit("toast",toast))},$showDialog(url,arg,query,opts){return this.$dialog("show",url,arg,query,opts)},$inlineOpen(id){eventBus.$emit("inlineDialog",{cmd:"open",id})},$inlineClose(id,result){eventBus.$emit("inlineDialog",{cmd:"close",id,result})},$dialog(command,url,arg,query,opts){if(this.$isReadOnly(opts))return;const that=this;function argIsNotAnArray(){if(!utils.isArray(arg))return console.error(`$dialog.${command}. The argument is not an array`),!0}function argIsNotAnObject(){if(!utils.isObjectExact(arg))return console.error(`$dialog.${command}. The argument is not an object`),!0}function doDialog(){if(isPermissionsDisabled(opts,arg))return void that.$alert(locale.$PermissionDenied);utils.isFunction(query)&&(query=query());let reloadAfter=opts&&opts.reloadAfter;switch(command){case"new":if(argIsNotAnArray())return;return __runDialog(url,0,query,result=>{let sel=arg.$selected;sel&&sel.$merge(result)});case"append":if(argIsNotAnArray())return;return __runDialog(url,0,query,result=>{arg.$append(result)});case"browse":return utils.isObject(arg)?__runDialog(url,arg,query,result=>{arg.$merge?arg.$merge(result):function(target,src){for(let p in target)target[p]=p in src?src[p]:void 0}(arg,result)}):void console.error(`$dialog.${command}. The argument is not an object`);case"edit-selected":if(argIsNotAnArray())return;if(!arg.$selected)return;return __runDialog(url,arg.$selected,query,result=>{arg.$selected.$merge(result),arg.__fireChange__("selected"),reloadAfter&&that.$reload()});case"show-selected":if(argIsNotAnArray())return;if(!arg.$selected)return;return __runDialog(url,arg.$selected,query,result=>{("reload"===result||reloadAfter)&&that.$reload()});case"edit":if(argIsNotAnObject())return;return __runDialog(url,arg,query,result=>{"reload"===result?that.$reload():arg.$merge&&utils.isObjectExact(result)&&(arg.$merge(result),reloadAfter&&that.$reload())});case"copy":if(argIsNotAnObject())return;let arr=arg.$parent;return __runDialog(url,arg,query,result=>{arr.$append(result),reloadAfter&&that.$reload()});default:return __runDialog(url,arg,query,r=>{reloadAfter&&that.$reload()})}}if(eventBus.$emit("closeAllPopups"),opts&&opts.validRequired&&root.$invalid)return void this.$alert(locale.$MakeValidFirst);let mo=this.$data.$mainObject;if(opts&&opts.saveRequired&&(this.$isDirty||mo&&mo.$isNew)){let dlgResult=null;return this.$save().then(()=>{dlgResult=doDialog()}),dlgResult}return doDialog()},$export(arg,url,dat,opts){if(this.$isLoading)return;const doExport=()=>{let id=arg||"0";arg&&utils.isObject(arg)&&(id=utils.getStringId(arg));const root=window.$$rootUrl;let newurl=url?urltools.combine("/_export",url,id):this.$baseUrl.replace("/_page/","/_export/");newurl=urltools.combine(root,newurl)+urltools.makeQueryString(dat),window.location=newurl};opts&&opts.saveRequired&&this.$isDirty?this.$save().then(()=>{doExport()}):doExport()},$exportTo(format,fileName){const root=window.$$rootUrl;let elem=this.$el.getElementsByClassName("sheet-page");if(!elem.length)return void console.error("element not found (.sheet-page)");var tbl=elem[0].getElementsByTagName("table");if(0==tbl.length)return void console.error("element not found (.sheet-page table)");if(tbl=tbl[0],htmlTools){htmlTools.getColumnsWidth(tbl);let padding=tbl.classList.contains("compact")?4:12;htmlTools.getRowHeight(tbl,padding)}let html="<table>"+tbl.innerHTML+"</table>",data={format,html,fileName,zoom:+window.devicePixelRatio.toFixed(2)};let url=`${root}/${require("std:routing").dataUrl()}/exportTo`;dataservice.post(url,utils.toJson(data),!0).then((function(blob){htmlTools&&htmlTools.downloadBlob(blob,fileName,format)})).catch((function(error){alert(error)}))},$report(rep,arg,opts,repBaseUrl,data){if(this.$isReadOnly(opts))return;if(this.$isLoading)return;let cmd="show",fmt="";opts&&(opts.export?(cmd="export",fmt=opts.format||""):opts.attach?cmd="attach":opts.print&&(cmd="print"));const doReport=()=>{let id=arg;arg&&utils.isObject(arg)&&(id=utils.getStringId(arg));let url=`${window.$$rootUrl}/report/${cmd}/${id}`,reportUrl=urltools.removeFirstSlash(repBaseUrl)||this.$indirectUrl||this.$baseUrl,baseUrl=urltools.makeBaseUrl(reportUrl),qry=Object.assign({},{base:baseUrl,rep},data);if(fmt&&(qry.format=fmt),url+=urltools.makeQueryString(qry),opts)if(opts.export)window.location=url;else if(opts.print)htmlTools.printDirect(url);else{if(opts.attach)return;window.open(url,"_blank")}else window.open(url,"_blank")};opts&&opts.validRequired&&root.$invalid?this.$alert(locale.$MakeValidFirst):opts&&opts.saveRequired&&this.$isDirty?this.$save().then(()=>{doReport()}):doReport()},$modalSaveAndClose(result,opts){if(this.$isDirty){const root=this.$data;if(opts&&opts.validRequired&&root.$invalid){let errs=makeErrors(root.$forceValidate());return void this.$alert(locale.$MakeValidFirst,void 0,errs)}this.$save().then(result=>eventBus.$emit("modalClose",result))}else eventBus.$emit("modalClose",result)},$modalClose(result){eventBus.$emit("modalClose",result)},$setFilter(obj,prop,val){eventBus.$emit("setFilter",{source:obj,prop,value:val})},$modalSelect(array,opts){if("$selected"in array){if(opts&&opts.validRequired){if(!this.$data.$valid)return}this.$modalClose(array.$selected)}else console.error("Invalid array for $modalSelect")},$modalSelectChecked(array){if(!("$checked"in array))return void console.error("invalid array for $modalSelectChecked");let chArray=array.$checked;chArray.length>0&&this.$modalClose(chArray)},$saveAndClose(opts){this.$isDirty?this.$save(opts).then(()=>this.$close()):this.$close()},$close(){this.$saveModified()&&this.$store.commit("close")},$showHelp(path){window.open(this.$helpHref(path),"_blank")},$helpHref:path=>urltools.helpHref(path),$searchChange(){let newUrl=this.$store.replaceUrlSearch(this.$baseUrl);this.$data.__baseUrl__=newUrl,this.$reload()},$saveModified(message,title){if(!this.$isDirty)return!0;let self=this,dlg={message:message||locale.$ElementWasChanged,title:title||locale.$ConfirmClose,buttons:[{text:locale.$Save,result:"save"},{text:locale.$NotSave,result:"close"},{text:locale.$Cancel,result:!1}]};function closeImpl(result){self.inDialog?eventBus.$emit("modalClose",result):self.$close()}return this.$confirm(dlg).then((function(result){"close"===result?(self.$data.$setDirty(!1),closeImpl(!1)):"save"===result&&self.$save().then((function(saveResult){closeImpl(saveResult)}))})),!1},$format:(value,opts)=>opts?(utils.isString(opts)&&(opts={dataType:opts}),opts.format||opts.dataType||opts.mask?opts.mask?value?mask.getMasked(opts.mask,value):value:opts.dataType?utils.format(value,opts.dataType,{hideZeros:opts.hideZeros,format:opts.format}):opts.format&&-1!==opts.format.indexOf("{0}")?opts.format.replace("{0}",value):utils.isDate(value)&&opts.format?utils.format(value,"DateTime",{format:opts.format}):value:value):value,$getNegativeRedClass:value=>utils.isNumber(value)&&value<0?"negative-red":"",$expand(elem,propName,expval){let self=this,url=window.$$rootUrl+"/_data/expand";return new Promise((function(resolve,reject){let arr=elem[propName];if(utils.isDefined(expval)){if(elem.$expanded==expval)return void resolve(arr);platform.set(elem,"$expanded",expval)}if(arr.$loaded)return void resolve(arr);if(!utils.isDefined(elem.$hasChildren))return void resolve(arr);if(!elem.$hasChildren)return arr.$loaded=!0,void resolve(arr);let jsonData=utils.toJson({baseUrl:self.$baseUrl,id:elem.$id});dataservice.post(url,jsonData).then((function(data){if(self.__destroyed__)return;let srcArray=data[propName];if(arr.$empty(),srcArray)for(let el of srcArray)arr.push(arr.$new(el));resolve(arr)})).catch((function(msg){self.$alertUi(msg),reject(arr)})),arr.$loaded=!0}))},$loadLazy(elem,propName){const routing=require("std:routing");let self=this,url=`${window.$$rootUrl}/${routing.dataUrl()}/loadlazy`,selfMi=elem[propName].$ModelInfo,mi=(elem.$parent.$ModelInfo,modelInfo.get(selfMi)),newUrl=urltools.parseUrlAndQuery(self.$baseUrl,mi).url+urltools.makeQueryString(mi),jsonData=utils.toJson({baseUrl:newUrl,id:elem.$id,prop:propName});return new Promise((function(resolve,reject){let arr=elem[propName];arr.$loaded?resolve(arr):(dataservice.post(url,jsonData).then((function(data){if(!self.__destroyed__){if(propName in data){arr.$empty();for(let el of data[propName])arr.push(arr.$new(el));let rcName=propName+".$RowCount";rcName in data&&(arr.$RowCount=data[rcName]),data.$ModelInfo&&modelInfo.reconcile(data.$ModelInfo[propName]),arr._root_._setModelInfo_(arr,data)}resolve(arr)}})).catch((function(msg){self.$alertUi(msg)})),arr.$loaded=!0)}))},$delegate(name){return this.$data._delegate_(name)},$defer:platform.defer,$print:platform.print,$hasError(path){let err=this[utils.text.splitPath(path).obj]._errors_;if(!err)return!1;let arr=err[path];return arr&&arr.length},$errorMessage(path){let err=this[utils.text.splitPath(path).obj]._errors_;if(!err)return"";let arr=err[path];return arr&&arr.length?arr[0].msg:""},$getErrors(severity){let errs=this.$data.$forceValidate();if(!errs||!errs.length)return null;severity&&!utils.isArray(severity)&&(severity=[severity]);let result=[];for(let x of errs)for(let ix=0;ix<x.e.length;ix++){let y=x.e[ix];sev=y.severity,severity&&-1===severity.indexOf(sev)||result.push({path:x,msg:y.msg,severity:y.severity,index:ix})}var sev;return result.length?result:null},__beginRequest(){this.$data.__requestsCount__+=1},__endRequest(){this.$data.__requestsCount__-=1},__cwChange(source){this.$reload(source)},__queryChange(search,source){utils.isObjectExact(search)||console.error("base.__queryChange. invalid argument type");let nq=Object.assign({},this.$baseQuery);for(let p in search)search[p]?nq[p]=search[p]:delete nq[p];let mi=source?source.$ModelInfo:this.$data._findRootModelInfo();modelInfo.copyfromQuery(mi,nq),this.$reload(source)},__doInit__(baseUrl){const root=this.$data;if(!root._modelLoad_)return;let caller=null;baseUrl&&(root.__baseUrl__=baseUrl),this.$caller&&(caller=this.$caller.$data),this.__createController__(),root._modelLoad_(caller),root._seal_(root)},__createController__(){let ctrl={$save:this.$save,$invoke:this.$invoke,$close:this.$close,$modalClose:this.$modalClose,$msg:this.$msg,$alert:this.$alert,$confirm:this.$confirm,$showDialog:this.$showDialog,$inlineOpen:this.$inlineOpen,$inlineClose:this.$inlineClose,$saveModified:this.$saveModified,$asyncValid:this.$asyncValid,$toast:this.$toast,$requery:this.$requery,$reload:this.$reload,$notifyOwner:this.$notifyOwner,$navigate:this.$navigate,$defer:platform.defer,$setFilter:this.$setFilter,$expand:this.$expand,$focus:this.$focus,$report:this.$report};return Object.defineProperty(ctrl,"$isDirty",{enumerable:!0,configurable:!0,get:()=>this.$isDirty}),Object.defineProperty(ctrl,"$isPristine",{enumerable:!0,configurable:!0,get:()=>this.$isPristine}),Object.seal(ctrl),ctrl},__notified(token){token&&this.__currentToken__===token.token&&(token.toast&&this.$toast(token.toast),this.$reload(token.update||null).then((function(array){if(!token.id)return;if(!utils.isArray(array))return;let el=array.find(itm=>itm.$id===token.id);el&&el.$select&&el.$select()})))},__parseControllerAttributes(attr){if(!attr)return null;let json=JSON.parse(attr.replace(/\'/g,'"')),result={};if(json.canClose){let ccd=this.$delegate(json.canClose);ccd&&(result.canClose=ccd.bind(this.$data))}return json.alwaysOk&&(result.alwaysOk=!0),result},__isModalRequery(){let arg={url:this.$baseUrl,result:!1};return eventBus.$emit("isModalRequery",arg),arg.result},__invoke__test__(args){if("controller"!==(args=args||{}).target)return;if(this.inDialog&&args.testId!==this.__testId__)return;const root=this.$data;switch(args.action){case"eval":args.result=utils.eval(root,args.path)}},__global_period_changed__(period){this.$data._fireGlobalPeriodChanged_(period)}},created(){let out={caller:null};eventBus.$emit("registerData",this,out),this.$caller=out.caller,this.__destroyed__=!1,eventBus.$on("beginRequest",this.__beginRequest),eventBus.$on("endRequest",this.__endRequest),eventBus.$on("queryChange",this.__queryChange),eventBus.$on("childrenSaved",this.__notified),eventBus.$on("invokeTest",this.__invoke__test__),eventBus.$on("globalPeriodChanged",this.__global_period_changed__),this.$on("cwChange",this.__cwChange),this.__asyncCache__={},this.__currentToken__=window.app.nextToken(),log&&log.time("create time:",__createStartTime,!1)},beforeDestroy(){this.$data._fireUnload_()},destroyed(){this.$caller=null,eventBus.$emit("registerData",null),eventBus.$off("beginRequest",this.__beginRequest),eventBus.$off("endRequest",this.__endRequest),eventBus.$off("queryChange",this.__queryChange),eventBus.$off("childrenSaved",this.__notified),eventBus.$off("invokeTest",this.__invoke__test__),eventBus.$off("globalPeriodChanged",this.__global_period_changed__),this.$off("cwChange",this.__cwChange),htmlTools.removePrintFrame(),this.$data.$destroy&&this.$data.$destroy(),this._data=null,this.__destroyed__=!0},beforeUpdate(){__updateStartTime=performance.now()},beforeCreate(){__createStartTime=performance.now()},mounted(){let testId=this.$el.getAttribute("test-id");testId&&(this.__testId__=testId)},updated(){log&&log.time("update time:",__updateStartTime,!1)}});app.components.baseController=base}(),function(){const platform=require("std:platform"),urlTools=require("std:url");function isSeparatePage(pages,seg){return!(!seg||!pages)&&-1!==pages.indexOf(seg+",")}function findMenu(menu,func,parentMenu){if(!menu)return null;for(let i=0;i<menu.length;i++){let itm=menu[i];if(func(itm))return itm;if(itm.Menu){parentMenu&&(parentMenu.Url=itm.Url);let found=findMenu(itm.Menu,func);if(found)return platform.set(itm,"$expanded",!0),found}}return null}app.components["std:navmenu"]={findMenu,makeMenuUrl:function(menu,url,opts){opts=opts||{};let sUrl=(url=urlTools.combine(url).toLowerCase()).split("/");if(sUrl.length>=4)return url;sUrl.length;let seg1=sUrl[1];if("app"===seg1)return url;if(opts&&isSeparatePage(opts.pages,seg1))return url;let am=null;if(seg1&&(am=menu.find(mi=>mi.Url===seg1)),am){if(am&&!am.Menu)return opts.title=am.Name,url}else{let parentMenu={Url:""};if(am=findMenu(menu,mi=>mi.Url&&!mi.Menu,parentMenu),am)return opts.title=am.Name,urlTools.combine(url,parentMenu.Url,am.Url)}url=urlTools.combine(seg1);let seg2=sUrl[2];return!seg2&&opts.seg2&&(seg2=opts.seg2),am=findMenu(am.Menu,seg2?mi=>mi.Url===seg2:mi=>mi.Url&&!mi.Menu),am?(opts.title=am.Name,urlTools.combine(url,am.Url)):url},isSeparatePage}}(),function(){const locale=window.$$locale,menuTools=component("std:navmenu"),eventBus=require("std:eventBus"),period=require("std:period"),store=component("std:store"),urlTools=require("std:url"),http=require("std:http"),a2NavBar={template:'\n<ul class="nav-bar">\n\t<li v-for="(item, index) in menu" :key="index" :class="{active : isActive(item)}">\n\t\t<a :href="itemHref(item)" tabindex="-1" v-text="item.Name" @click.prevent="navigate(item)"></a>\n\t</li>\n\t<li class="aligner"/>\n\t<div class="nav-global-period" v-if="hasPeriod">\n\t\t<a2-period-picker class="drop-bottom-right pp-hyperlink pp-navbar" \n\t\t\tdisplay="namedate" :callback="periodChanged" prop="period" :item="that"/>\n\t</div>\n\t<li v-if="hasHelp()" :title="locale.$Help"><a :href="helpHref()" class="btn-help" rel="help" aria-label="Help" @click.prevent="showHelp()"><i class="ico ico-help"></i></a></li>\n</ul>\n',props:{menu:Array,period:period.constructor,isNavbarMenu:Boolean},computed:{seg0:()=>store.getters.seg0,seg1:()=>store.getters.seg1,locale:()=>locale,hasPeriod(){return!!this.period},that(){return this}},methods:{isActive(item){return this.seg0===item.Url},isActive2(item){return this.seg1===item.Url},itemHref:item=>"/"+item.Url,navigate(item){if(this.isActive(item))return;let storageKey="menu:"+urlTools.combine(window.$$rootUrl,item.Url),savedUrl=localStorage.getItem(storageKey)||"";savedUrl&&!menuTools.findMenu(item.Menu,mi=>mi.Url===savedUrl)&&(savedUrl="");let opts={title:null,seg2:savedUrl},url=menuTools.makeMenuUrl(this.menu,item.Url,opts);this.$store.commit("navigate",{url,title:opts.title})},showHelp(){window.open(this.helpHref(),"_blank")},_findHelp(){if(!this.menu)return null;let am=this.menu.find(x=>this.isActive(x));if(am&&am.Menu){let am2=menuTools.findMenu(am.Menu,x=>this.isActive2(x));if(am2&&am2.Help)return am2.Help}return am?am.Help:null},helpHref(){let helpUrl=this._findHelp()||"";return urlTools.helpHref(helpUrl)},hasHelp(){return!!this._findHelp()},periodChanged(period){http.post("/_application/setperiod",period.toJson()).then(()=>{eventBus.$emit("globalPeriodChanged",period)}).catch(err=>{alert(err)})}}},a2NavBarPage={template:'\n<div class="menu-navbar-overlay" @click.stop=closeNavMenu>\n<div class="menu-navbar" :class="{show:visible}">\n<div class="menu-navbar-top">\n\t<a href=\'\' class=menu-navbar-back @click.stop.prevent=closeNavMenu><i class="ico ico-grid2"></i></a>\n\t<h2 v-text=title></h2>\n</div>\n<ul class=menu-navbar-list>\n\t<li v-for="(item, index) in menu" :key=index>\n\t\t<a class="menu-navbar-link" :href="itemHref(item)" @click.prevent="navigate(item)" :class="{active : isActive(item)}">\n\t\t\t<i class="ico" :class=icoClass(item)></i>\n\t\t\t<span v-text="item.Name"></span>\n\t\t</a>\n\t</li>\n</ul>\n<div class="aligner"/>\n<a class=powered-by-a2v10 href="https://a2v10.com" rel=noopener target=_blank><i class="ico ico-a2logo"></i> Powered by A2v10</a>\n</div></div>\n',props:{menu:Array,isNavbarMenu:Boolean,title:String},data:()=>({visible:!1}),computed:{seg0:()=>store.getters.seg0,seg1:()=>store.getters.seg1,locale:()=>locale,that(){return this}},methods:{isActive(item){return this.seg0===item.Url},isActive2(item){return this.seg1===item.Url},itemHref:item=>"/"+item.Url,icoClass:item=>item.Icon?"ico-"+item.Icon:"ico-empty",navigate(item){if(this.isActive(item))return;this.closeNavMenu();let storageKey="menu:"+urlTools.combine(window.$$rootUrl,item.Url),savedUrl=localStorage.getItem(storageKey)||"";savedUrl&&!menuTools.findMenu(item.Menu,mi=>mi.Url===savedUrl)&&(savedUrl="");let opts={title:null,seg2:savedUrl},url=menuTools.makeMenuUrl(this.menu,item.Url,opts);this.$store.commit("navigate",{url,title:opts.title})},closeNavMenu(){this.visible=!1,eventBus.$emit("clickNavMenu",!1)}},mounted(){setTimeout(()=>{this.visible=!0},5)}};app.components["std:navbar"]={standardNavBar:a2NavBar,pageNavBar:a2NavBarPage}}(),function(){const menu=component("std:navmenu"),store=component("std:store"),urlTools=require("std:url"),htmlTools=require("std:html"),sideBarBase={props:{menu:Array,mode:String},computed:{seg0:()=>store.getters.seg0,seg1:()=>store.getters.seg1,sideMenu(){let top=this.topMenu;return top?top.Menu:null},topMenu(){let seg0=this.seg0;return menu.findMenu(this.menu,mi=>mi.Url===seg0)}},methods:{isActive(item){let isActive=this.seg1===item.Url;return isActive&&htmlTools.updateDocTitle(item.Name),isActive},isGroup(item){if(!item.Params)return!1;try{return JSON.parse(item.Params).group||!1}catch(err){return!1}},navigate(item){if(this.isActive(item))return;if(!item.Url)return;let top=this.topMenu;if(top){let url=urlTools.combine(top.Url,item.Url);if(-1===item.Url.indexOf("/"))try{localStorage.setItem("menu:"+urlTools.combine(window.$$rootUrl,top.Url),item.Url)}catch(e){}this.$store.commit("navigate",{url,title:item.Name})}else console.error("no top menu found")},itemHref(item){let top=this.topMenu;if(top)return urlTools.combine(top.Url,item.Url)},toggle(){this.$parent.sideBarCollapsed=!this.$parent.sideBarCollapsed;try{localStorage.setItem("sideBarCollapsed",this.$parent.sideBarCollapsed)}catch(e){}}}},a2SideBar={template:'\n<div :class="cssClass">\n\t<a href role="button" class="ico collapse-handle" @click.prevent="toggle"></a>\n\t<div class="side-bar-body" v-if="bodyIsVisible">\n\t\t<tree-view :items="sideMenu" :is-active="isActive" :is-group="isGroup" :click="navigate" :get-href="itemHref"\n\t\t\t:options="{folderSelect: folderSelect, label: \'Name\', title: \'Description\',\n\t\t\tsubitems: \'Menu\', expandAll:true,\n\t\t\ticon:\'Icon\', wrapLabel: true, hasIcon: true}">\n\t\t</tree-view>\n\t</div>\n\t<div v-else class="side-bar-title" @click.prevent="toggle">\n\t\t<span class="side-bar-label" v-text="title"></span>\n\t</div>\n</div>\n',mixins:[sideBarBase],computed:{bodyIsVisible(){return!this.$parent.sideBarCollapsed||this.compact},compact(){return"Compact"===this.mode},title(){let sm=this.sideMenu;if(!sm)return"unknown title";let seg1=this.seg1,am=menu.findMenu(sm,mi=>mi.Url===seg1);return am&&am.Name||"unknown title"},cssClass(){let cls="side-bar";return this.compact&&(cls+="-compact"),cls+(this.$parent.sideBarCollapsed?" collapsed":" expanded")}},methods:{folderSelect:item=>!!item.Url}},a2TabSideBar={template:'\n<div class="side-bar-top">\n\t<div class="a2-tab-bar">\n\t\t<div v-for="mi in topMenu.Menu" class="a2-tab-bar-item">\n\t\t\t<a :href="itemHref(mi)" @click.stop.prevent="navigate(mi)" v-text=mi.Name class="a2-tab-button" :class="{active: isActive(mi)}"></a>\n\t\t</div>\n\t</div>\n</div>\n',mixins:[sideBarBase],computed:{},methods:{}};app.components["std:sidebar"]={standardSideBar:a2SideBar,compactSideBar:a2SideBar,tabSideBar:a2TabSideBar}}(),function(){const store=component("std:store"),eventBus=require("std:eventBus"),modal=component("std:modal"),toastr=component("std:toastr"),popup=require("std:popup"),urlTools=require("std:url"),period=require("std:period"),log=require("std:log"),utils=require("std:utils"),locale=window.$$locale,platform=require("std:platform"),navBar=component("std:navbar"),sideBar=component("std:sidebar"),menu=component("std:navmenu"),a2AppHeader={template:'\n<header class="header">\n\t<div class=h-menu v-if=isNavBarMenu @click.stop.prevent=clickMenu><i class="ico ico-grid2"></i></div>\n\t<div class=h-block v-if=\'!isNavBarMenu\'>\n\t\t\x3c!--<i class="ico-user"></i>--\x3e\n\t\t<a class=app-title href=\'/\' @click.prevent="root" v-text="title" tabindex="-1"></a>\n\t\t<span class=app-subtitle v-text="subtitle"></span>\n\t</div>\n\t<div v-if=isNavBarMenu class=h-menu-title v-text=seg0text></div>\n\t<div class="aligner"></div>\n\t<span class="title-notify" v-if="notifyText" v-text="notifyText" :title="notifyText" :class="notifyClass"></span>\n\t<div class="aligner"></div>\n\t<template v-if="!isSinglePage ">\n\t\t<a2-new-button :menu="newMenu" icon="plus" btn-style="success"></a2-new-button>\n\t\t<slot></slot>\n\t\t<a2-new-button :menu="settingsMenu" icon="gear-outline" :title="locale.$Settings"></a2-new-button>\n\t\t<a class="nav-admin middle" v-if="hasFeedback" tabindex="-1" @click.prevent="showFeedback" :title="locale.$Feedback" :class="{open: feedbackVisible}"><i class="ico ico-comment-outline"></i></a>\n\t\t<a class="nav-admin" v-if="userIsAdmin" href="/admin/" tabindex="-1"><i class="ico ico-gear-outline"></i></a>\n\t</template>\n\t<div class="dropdown dir-down separate" v-dropdown>\n\t\t<button class="btn user-name" toggle :title="personName"><i class="ico ico-user"></i> \n\t\t\t<span id="layout-person-name" class="person-name" v-text="personName"></span>\n\t\t\t<span id="layout-client-id" class="client-id" v-if="clientId"> [<span v-text="clientId" ></span>]</span>\n\t\t\t<span class="caret"></span>\n\t\t</button>\n\t\t<div class="dropdown-menu menu down-left">\n\t\t\t<a v-if="!isSinglePage " v-for="(itm, itmIndex) in profileItems" @click.prevent="doProfileMenu(itm)" class="dropdown-item" tabindex="-1"><i class="ico" :class="\'ico-\' + itm.icon"></i> <span v-text="itm.title" :key="itmIndex"></span></a>\n\t\t\t<a @click.prevent="changePassword" class="dropdown-item" tabindex="-1"><i class="ico ico-access"></i> <span v-text="locale.$ChangePassword"></span></a>\n\t\t\t<div class="divider"></div>\n\t\t\t<form id="logoutForm" method="post" action="/account/logoff">\n\t\t\t\t<a href="javascript:document.getElementById(\'logoutForm\').submit()" tabindex="-1" class="dropdown-item"><i class="ico ico-exit"></i> <span v-text="locale.$Quit"></span></a>\n\t\t\t</form>\n\t\t</div>\n\t</div>\n</header>\n',props:{title:String,subtitle:String,userState:Object,personName:String,clientId:String,userIsAdmin:Boolean,menu:Array,newMenu:Array,settingsMenu:Array,appData:Object,showFeedback:Function,feedbackVisible:Boolean,singlePage:String,changePassword:Function,navBarMode:String},computed:{isSinglePage(){return!!this.singlePage},locale:()=>locale,notifyText(){return this.getNotify(2)},notifyClass(){return this.getNotify(1).toLowerCase()},feedback(){return this.appData?this.appData.feedback:null},hasFeedback(){return this.appData&&this.appData.feedback},profileItems(){return this.appData?this.appData.profileMenu:null},isNavBarMenu(){return"Menu"===this.navBarMode},seg0text(){let seg0=this.$store.getters.seg0,mx=this.menu.find(x=>x.Url===seg0);return mx?mx.Name:""}},methods:{getNotify(ix){let n=this.userState?this.userState.Notify:null;if(!n)return"";let m=n.match(/\((.*)\)(.*)/);return m&&m.length>ix?m[ix]:""},root(){let opts={title:null},currentUrl=this.$store.getters.url,menuUrl=this.isSinglePage?"/"+this.singlePage:menu.makeMenuUrl(this.menu,"/",opts);currentUrl!==menuUrl&&this.$store.commit("navigate",{url:menuUrl,title:opts.title})},doProfileMenu(itm){store.commit("navigate",{url:itm.url})},clickMenu(){this.isNavBarMenu&&eventBus.$emit("clickNavMenu",!0)}}},contentView={render(h){return h("div",{attrs:{class:"content-view "+this.cssClass}},[h("include",{props:{src:this.currentView,needReload:this.needReload}})])},computed:{currentView(){let root=window.$$rootUrl,url=store.getters.url;if("/"===url)return;let len=store.getters.len;return 2!==len&&3!==len||(url+="/index/0"),urlTools.combine(root,"/_page",url)+store.getters.search},cssClass(){let route=this.$store.getters.route;return"app"===route.seg0||menu.isSeparatePage(this.pages,route.seg0)?"full-view":3===route.len?"partial-page":2===route.len?"full-page":"full-view"}},props:{pages:String},data:()=>({needReload:!1}),created(){var me=this;eventBus.$on("requery",(function(){me.needReload=!0,Vue.nextTick(()=>me.needReload=!1)}))}},a2MainView={store,template:'\n<div :class=cssClass class=main-view>\n\t<component :is=navBarComponent :title=title :menu=menu v-if=isNavBarVisible \n\t\t:period=period :is-navbar-menu=isNavBarMenu></component>\n\t<component :is=sideBarComponent v-if=sideBarVisible :menu=menu :mode=sideBarMode></component>\n\t<a2-content-view :pages=pages></a2-content-view>\n\t<div class=load-indicator v-show=pendingRequest></div>\n\t<div class=modal-stack v-if=hasModals>\n\t\t<div class="modal-wrapper modal-animation-frame" v-for="dlg in modals" :class="{show: dlg.wrap}">\n\t\t\t<a2-modal :dialog=dlg></a2-modal>\n\t\t</div>\n\t</div>\n\t<a2-toastr></a2-toastr>\n</div>',components:{"a2-nav-bar":navBar.standardNavBar,"a2-nav-bar-page":navBar.pageNavBar,"a2-side-bar":sideBar.standardSideBar,"a2-side-bar-compact":sideBar.compactSideBar,"a2-side-bar-tab":sideBar.tabSideBar,"a2-content-view":contentView,"a2-modal":modal,"a2-toastr":toastr},props:{menu:Array,sideBarMode:String,navBarMode:String,period:period.constructor,pages:String,title:String},data:()=>({sideBarCollapsed:!1,showNavBar:!0,requestsCount:0,modals:[],modalRequeryUrl:""}),computed:{navBarComponent(){return this.isNavBarMenu?"a2-nav-bar-page":"a2-nav-bar"},sideBarComponent(){return"Compact"===this.sideBarMode?"a2-side-bar-compact":"TabBar"===this.sideBarMode?"a2-side-bar-tab":"a2-side-bar"},isSideBarCompact(){return"Compact"===this.sideBarMode},route(){return this.$store.getters.route},sideBarInitialCollapsed:()=>"true"===localStorage.getItem("sideBarCollapsed")||!window.matchMedia("(min-width:1025px)").matches,isNavBarVisible(){if(!this.showNavBar)return!1;if(this.isNavBarMenu)return!0;let route=this.route;return!menu.isSeparatePage(this.pages,route.seg0)&&("app"!==route.seg0&&(2===route.len||3===route.len))},sideBarVisible(){let route=this.route;return"app"!==route.seg0&&3===route.len},isSideBarTop(){return"TabBar"===this.sideBarMode},cssClass(){let cls=(this.isNavBarMenu?"nav-bar-menu ":"")+"side-bar-position-"+(this.isSideBarTop?"top ":"left ");return this.isSideBarTop?cls+=this.sideBarVisible?"":"side-bar-hidden":cls+=this.sideBarCollapsed?"collapsed":"expanded",cls},pendingRequest(){return!this.hasModals&&this.requestsCount>0},hasModals(){return this.modals.length>0},isNavBarMenu(){return"Menu"===this.navBarMode}},methods:{setupWrapper(dlg){this.modalRequeryUrl="",setTimeout(()=>{dlg.wrap=!0},50)},showNavMenu(bShow){bShow&&eventBus.$emit("closeAllPopups"),this.showNavBar=bShow}},created(){let me=this;function findRealDialog(){for(let i=me.modals.length-1;i>=0;--i){let md=me.modals[i];if(md.rd)return md}return null}if(this.isNavBarMenu&&(this.showNavBar=!1),eventBus.$on("beginRequest",(function(){me.requestsCount+=1})),eventBus.$on("endRequest",(function(){me.requestsCount-=1})),this.isNavBarMenu&&eventBus.$on("clickNavMenu",this.showNavMenu),eventBus.$on("modal",(function(modal,prms){let id=utils.getStringId(prms?prms.data:null),raw=prms&&prms.raw,root=window.$$rootUrl,url=urlTools.combine(root,"/_dialog",modal,id);raw&&(url=urlTools.combine(root,modal,id)),url=store.replaceUrlQuery(url,prms.query);let dlg={title:"dialog",url,prms:prms.data,wrap:!1,rd:prms.rd};dlg.promise=new Promise((function(resolve,reject){dlg.resolve=resolve})),prms.promise=dlg.promise,me.modals.push(dlg),me.setupWrapper(dlg)})),eventBus.$on("modaldirect",(function(modal,prms){let root=window.$$rootUrl,dlg={title:"dialog",url:urlTools.combine(root,"/_dialog",modal),prms:prms.data,wrap:!1};dlg.promise=new Promise((function(resolve,reject){dlg.resolve=resolve})),prms.promise=dlg.promise,me.modals.push(dlg),me.setupWrapper(dlg)})),eventBus.$on("modalSetAttribites",(function(attr,instance){if(!attr||!instance)return;let dlg=findRealDialog();dlg&&(dlg.attrs=instance.__parseControllerAttributes(attr))})),eventBus.$on("modalCreated",(function(instance){let dlg=findRealDialog();dlg&&(dlg.instance=instance)})),eventBus.$on("isModalRequery",(function(arg){arg.url&&me.modalRequeryUrl&&me.modalRequeryUrl===arg.url&&(arg.result=!0)})),eventBus.$on("modalRequery",(function(baseUrl){let dlg=findRealDialog();if(!dlg)return;let inst=dlg.instance;inst&&inst.modalRequery&&(baseUrl&&(dlg.url=baseUrl),me.modalRequeryUrl=dlg.url,inst.modalRequery())})),eventBus.$on("modalSetBase",(function(baseUrl){let dlg=findRealDialog();dlg&&(dlg.url=baseUrl)})),eventBus.$on("modalClose",(function(result){if(!me.modals.length)return;if(me.requestsCount>0)return;const dlg=me.modals[me.modals.length-1];function closeImpl(closeResult){let dlg=me.modals.pop();closeResult&&dlg.resolve(closeResult)}if(dlg.attrs)if(dlg.attrs.alwaysOk&&(result=!0),dlg.attrs.canClose){let canResult=dlg.attrs.canClose();!0===canResult?closeImpl(result):canResult.then?result.then((function(innerResult){!0===innerResult?closeImpl(result):innerResult&&closeImpl(innerResult)})):canResult&&closeImpl(canResult)}else closeImpl(result);else closeImpl(result)})),eventBus.$on("modalCloseAll",(function(){for(;me.modals.length;){me.modals.pop().resolve(!1)}})),eventBus.$on("confirm",(function(prms){let dlg=prms.data;dlg.wrap=!1,dlg.promise=new Promise((function(resolve){dlg.resolve=resolve})),prms.promise=dlg.promise,me.modals.push(dlg),me.setupWrapper(dlg)})),!this.menu){let dlgData={promise:null,data:{message:locale.$AccessDenied,title:locale.$Error,style:"alert"}};return eventBus.$emit("confirm",dlgData),void dlgData.promise.then((function(){let root=window.$$rootUrl,url=urlTools.combine(root,"/account/login");window.location.assign(url)}))}this.sideBarCollapsed=this.sideBarInitialCollapsed;let opts={title:null,pages:this.pages},menuPath=urlTools.normalizeRoot(window.location.pathname);"/home"===menuPath&&this.menu&&!this.menu.find(v=>"home"===v.Url.toLowerCase())&&(menuPath="/");let newUrl=menu.makeMenuUrl(this.menu,menuPath,opts);newUrl+=window.location.search,this.$store.commit("setstate",{url:newUrl,title:opts.title});let firstUrl={url:"",title:""};firstUrl.url=menu.makeMenuUrl(this.menu,"/",opts),firstUrl.title=opts.title,urlTools.firstUrl=firstUrl,function expand(elems){if(elems)for(let el of elems)"Menu"in el&&(platform.set(el,"$expanded",!0),expand(el.Menu))}(this.menu)}},shell=Vue.extend({components:{"a2-main-view":a2MainView,"a2-app-header":a2AppHeader},store,data:()=>({requestsCount:0,loadsCount:0,debugShowTrace:!1,debugShowModel:!1,feedbackVisible:!1,globalPeriod:null,dataCounter:0,traceEnabled:log.traceEnabled()}),computed:{processing(){return!this.hasModals&&this.requestsCount>0},modelStack(){return this.__dataStack__},singlePage(){let seg0=this.$store.getters.seg0;if(menu.isSeparatePage(this.pages,seg0))return seg0}},watch:{traceEnabled(val){log.enableTrace(val)}},methods:{about(){this.$store.commit("navigate",{url:"/app/about"})},appLink(lnk){this.$store.commit("navigate",{url:lnk.url})},navigate(url){this.$store.commit("navigate",{url})},debugOptions(){alert("debug options")},debugTrace(){window.$$debug&&(this.debugShowModel=!1,this.feedbackVisible=!1,this.debugShowTrace=!this.debugShowTrace)},debugModel(){window.$$debug&&(this.debugShowTrace=!1,this.feedbackVisible=!1,this.debugShowModel=!this.debugShowModel)},debugClose(){this.debugShowModel=!1,this.debugShowTrace=!1,this.feedbackVisible=!1},showFeedback(){this.debugShowModel=!1,this.debugShowTrace=!1,this.feedbackVisible=!this.feedbackVisible},feedbackClose(){this.feedbackVisible=!1},profile(){alert("user profile")},changeUser(){alert("change user")},changePassword(){if(window.cefHost)return void this.$alert(locale.$DesktopNotSupported);const dlgData={promise:null,data:{Id:-1}};eventBus.$emit("modal","/app/changePassword",dlgData),dlgData.promise.then((function(result){!1!==result&&eventBus.$emit("toast",{text:locale.$ChangePasswordSuccess,style:"success"})}))},$alert(msg,title,list){let dlgData={promise:null,data:{message:msg,title,style:"alert",list}};return eventBus.$emit("confirm",dlgData),dlgData.promise}},created(){let me=this;this.initialPeriod&&(this.globalPeriod=new period.constructor(this.initialPeriod)),me.__dataStack__=[],window.addEventListener("popstate",(function(event,a,b){if(eventBus.$emit("modalCloseAll"),me.__dataStack__.length>0){let comp=me.__dataStack__[0],oldUrl=event.state;if(!comp.$saveModified())return oldUrl=comp.$data.__baseUrl__.replace("/_page",""),void window.history.pushState(oldUrl,null,oldUrl)}me.$store.commit("popstate")})),eventBus.$on("registerData",(function(component,out){me.dataCounter+=1,component?(me.__dataStack__.length>0&&(out.caller=me.__dataStack__[0]),me.__dataStack__.unshift(component)):me.__dataStack__.shift(component)})),popup.startService(),eventBus.$on("beginRequest",()=>{me.requestsCount+=1,window.__requestsCount__=me.requestsCount}),eventBus.$on("endRequest",()=>{me.requestsCount-=1,window.__requestsCount__=me.requestsCount}),eventBus.$on("beginLoad",()=>{void 0===window.__loadsCount__&&(window.__loadsCount__=0),me.loadsCount+=1,window.__loadsCount__=me.loadsCount}),eventBus.$on("endLoad",()=>{me.loadsCount-=1,window.__loadsCount__=me.loadsCount}),eventBus.$on("closeAllPopups",popup.closeAll)}});app.components["std:shellController"]=shell}(),function(){const store=component("std:store"),eventBus=require("std:eventBus");let __lastInvokeResult=void 0;window.__tests__={$navigate:function(url){store.commit("navigate",{url})},$isReady:function(){return"complete"===document.readyState&&window.__requestsCount__+window.__loadsCount__===0},$invoke:function(args){return"shell"===args.target?function(args){__lastInvokeResult=void 0;const http=require("std:http"),root=window.$$rootUrl,routing=require("std:routing"),url=`${root}/${routing.dataUrl()}/invoke`,data={cmd:args.cmd,baseUrl:`/_page${args.path}/index/${args.id}`,data:null};http.post(url,JSON.stringify(data)).then(r=>{args.result="success:"+r,__lastInvokeResult=args.result}).catch(err=>{args.result="error:"+err,__lastInvokeResult=args.result})}(args):eventBus.$emit("invokeTest",args),args.result},$lastResult:()=>__lastInvokeResult}}();